<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TrustDollar Exchange — Token Live</title>
  <style>
    :root{
      --bg:#f8fafc;--card:#fff;--muted:#64748b;
      --green:#16a34a;--red:#dc2626;--accent:#0ea5a4;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif;}
body{background:var(--bg);color:#0f172a;padding:12px;display:flex;justify-content:center;}
.card{width:100%;max-width:900px;background:var(--card);border-radius:16px;
box-shadow:0 6px 16px rgba(0,0,0,0.06);padding:18px;}

.logout{background:#0ea5a4;color:#fff;padding:10px 14px;border:none;border-radius:10px;
cursor:pointer;font-weight:700;font-size:14px;width:100%;margin-top:22px;}

.top{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;}
.left{display:flex;gap:10px;align-items:center;}
.symbol{width:54px;height:54px;border-radius:12px;
background:linear-gradient(135deg,#e0f2fe,#ecfdf5);
display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;}
.title{font-size:18px;font-weight:700;}
.priceBig{font-size:24px;font-weight:800;}
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.btn{padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:700;font-size:13px;}
.buy{background:var(--green);color:#fff;}
.sell{background:var(--red);color:#fff;}
.stake{background:var(--accent);color:#fff;}

.chart{margin-top:12px;height:160px;border-radius:10px;
background:linear-gradient(180deg,#ffffff,#f1f5f9);
display:flex;justify-content:center;align-items:center;color:var(--muted);font-weight:600;font-size:13px;}

.metaGrid{margin-top:14px;display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px;}
.meta{background:#f9fafb;padding:10px;border-radius:10px;text-align:center;}
.small{font-size:11px;color:#64748b;}

.wallet-box{margin-top:16px;background:#fff;border-radius:10px;
padding:12px;box-shadow:0 3px 10px rgba(0,0,0,0.05);}
.wallet-header{display:flex;justify-content:space-between;align-items:center;}
.wallet-total{font-size:1.1rem;font-weight:700;color:#0ea5a4;}
.trade-history{margin-top:16px;background:#fff;border-radius:10px;
box-shadow:0 3px 10px rgba(0,0,0,0.05);padding:10px;}
table{width:100%;border-collapse:collapse;margin-top:8px;}
th,td{padding:6px;text-align:left;font-size:0.78rem;border-bottom:1px solid #f1f5f9;}
th{color:#64748b;font-weight:600;}

/* Modal */
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);
display:none;justify-content:center;align-items:center;z-index:1000;}
.modal-content{background:#fff;border-radius:14px;width:90%;max-width:420px;
box-shadow:0 6px 25px rgba(0,0,0,0.3);overflow:hidden;}
.modal-header{background:linear-gradient(135deg,#0ea5a4,#06b6d4);color:#fff;
font-weight:700;font-size:1.1rem;padding:12px 16px;text-align:center;}
.modal-body{padding:18px;}
.modal-info{display:flex;justify-content:space-between;margin-bottom:12px;font-size:14px;}
.modal-input label{display:block;margin-bottom:6px;font-size:13px;color:#475569;text-align:left;}
.modal-input input{width:100%;padding:10px;border:1px solid #cbd5e1;border-radius:8px;
font-size:15px;font-weight:600;text-align:center;}
.modal-total{display:flex;justify-content:space-between;align-items:center;
background:#f9fafb;padding:10px 14px;border-radius:10px;margin-top:10px;font-size:14px;}
.modal-actions{display:flex;justify-content:space-between;padding:14px;background:#f8fafc;}
.confirm{background:#16a34a;color:#fff;padding:10px 16px;border:none;border-radius:8px;cursor:pointer;font-weight:700;width:48%;}
.cancel{background:#e2e8f0;color:#0f172a;padding:10px 16px;border:none;border-radius:8px;cursor:pointer;font-weight:700;width:48%;}
.error{margin-top:8px;color:#dc2626;font-weight:600;text-align:center;}

#alertBox{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
background:#fff;padding:18px 24px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.2);
font-weight:700;font-size:15px;color:#0f172a;display:none;z-index:2000;text-align:center;}
#alertBox.success{border-left:6px solid #16a34a;}
#alertBox.error{border-left:6px solid #dc2626;}

/* 🔹 Fullscreen Overlay */
#loadingScreen {
position: fixed;
top: 0; left: 0;
width: 100%; height: 100%;
background: linear-gradient(135deg, #f0fdf4, #ecfeff);
display: flex;
justify-content: center;
align-items: center;
z-index: 2000;
}

/* 🔹 Glassy Box */
.loader-box {
background: rgba(255, 255, 255, 0.8);
backdrop-filter: blur(12px);
border-radius: 16px;
padding: 30px 50px;
box-shadow: 0 8px 24px rgba(0,0,0,0.1);
text-align: center;
animation: fadeIn 0.6s ease-in-out;
}

/* 🔹 Smooth Spinner */
.spinner {
width: 50px;
height: 50px;
border: 5px solid #e2e8f0;
border-top: 5px solid #0ea5a4;
border-radius: 50%;
margin: 0 auto 18px;
animation: spin 1s linear infinite;
}

/* 🔹 Text Style */
.loader-box p {
font-size: 15px;
color: #0f172a;
font-weight: 600;
letter-spacing: 0.3px;
}

/* 🔹 Animations */
@keyframes spin {
from { transform: rotate(0deg); }
to { transform: rotate(360deg); }
}

@keyframes fadeIn {
from { opacity: 0; transform: scale(0.95); }
to { opacity: 1; transform: scale(1); }
}
/* you can buy max mini */
#modalTotal {
  color: #16a34a;
  transition: all 0.2s ease;
  font-weight: 700;
}

@media (max-height: 700px) {
  .modal-content {
    transform: translateY(-50px);
  }
}

 /*green red pop up butun color */

.confirm {
  position: relative;
  overflow: hidden;
}
.confirm::after {
  content: "";
  position: absolute;
  top: 0; left: -100%;
  width: 100%; height: 100%;
  background: rgba(255,255,255,0.2);
  transform: skewX(-20deg);
  transition: 0.4s;
}
.confirm:hover::after {
  left: 100%;
}
.modal-content {
  transition: transform 0.3s ease;
}


</style>
</head>
<body>

<div class="card" id="mainCard" style="display:none;">
<div class="top">
<div class="left">
<div class="symbol" id="symbol">--</div>
<div><div class="title" id="t_name">Token</div></div>
</div>
<div class="controls">
<div class="priceBig" id="t_price">$0.00</div>
<button class="btn buy" id="btnBuy">Buy</button>
<button class="btn sell" id="btnSell">Sell</button>
<button class="btn stake">Stake</button>
</div>
</div>


<div class="chart" id="chart">
<canvas id="earningChart" style="width:100%;height:180px;"></canvas>
</div>

<div class="metaGrid">
<div class="meta"><div class="small">Your Tokens</div><div id="userBalance">0.00</div></div>
<div class="meta"><div class="small">Staked</div><div id="userStaked">0.00</div></div>
</div>

<div class="wallet-box">
<div class="wallet-header">
<div><strong>💼 Wallet Balance:</strong></div>
<div class="wallet-total" id="walletTotal">$0.00</div>
</div>
</div>

<div class="trade-history">
<h3> Live Trade History</h3>
<table id="tradeTable">
<thead><tr><th>Time</th><th>Token</th><th>Action</th><th>Qty</th><th>Price</th></tr></thead>
<tbody></tbody>
</table>
</div>

<button id="logoutBtn" class="logout">Logout</button>
</div>

<div id="alertBox"></div>

<!-- Modal -->
<div class="modal" id="tradeModal">
<div class="modal-content">
<div class="modal-header" id="modalHeader">Trade</div>
<div class="modal-body">
<div class="modal-info">
<div><strong>Current Price:</strong> <span id="modalPrice">$0.00</span></div>
<div><strong>Available:</strong> <span id="modalWallet">$0.00</span></div>
</div>
<div class="modal-input">
<label for="modalQty">Enter Quantity</label>
<input type="number" id="modalQty" placeholder="0.00" min="0" />
</div>
<p id="maxBuyInfo" style="font-size:12px;color:#64748b;margin-top:4px;">
  You can buy 0 tokens max
</p>

<div class="modal-total"><span>Total:</span><strong id="modalTotal">$0.00</strong></div>
<div class="error" id="modalError"></div>
</div>
<div class="modal-actions">
<button class="confirm" id="confirmTrade">Confirm</button>
<button class="cancel" id="cancelTrade">Cancel</button>
</div>
</div>
</div>


<!-- ✅ Modern Professional Loader -->
<div id="loadingScreen">
<div class="loader-box">
<div class="spinner"></div>
<p>Verifying session... please wait</p>
</div>
</div>
<!-- Chart.js for smooth animated graph -->
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
import { 
  getFirestore, doc, getDoc, setDoc, updateDoc, addDoc, 
  collection, query, orderBy, onSnapshot, serverTimestamp 
} from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
  authDomain: "btcinvest-c0e25.firebaseapp.com",
  projectId: "btcinvest-c0e25",
  storageBucket: "btcinvest-c0e25.firebasestorage.app",
  messagingSenderId: "204937458487",
  appId: "1:204937458487:web:cc27ece1249999279f60b2",
  measurementId: "G-HG0Q8ZHT6G"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser, token, walletBalance = 0, currentPrice = 0;
const perMinuteRate = 0.015 / (24 * 60); // 1.5% daily

function showAlert(msg, type = "info") {
  const b = document.getElementById("alertBox");
  b.textContent = msg;
  b.className = type;
  b.style.display = "block";
  setTimeout(() => b.style.display = "none", 2000);
}

// 🔹 Auth
onAuthStateChanged(auth, async (u) => {
  if (!u) return (window.location.href = "login.html");
  currentUser = u;
  document.getElementById("loadingScreen").style.display = "none";
  document.getElementById("mainCard").style.display = "block";
  await loadUser();
});

async function loadUser() {
  const userRef = doc(db, "users", currentUser.uid);
  const userSnap = await getDoc(userRef);
  if (!userSnap.exists()) return;

  const data = userSnap.data();
  walletBalance = data.walletBalance ?? 0;
  document.getElementById("walletTotal").textContent = `$${walletBalance.toFixed(2)}`;

  const stored = localStorage.getItem("selectedToken");
  if (!stored) return;

  token = JSON.parse(stored);
  window.token = token; // 👈 for console debugging
  document.getElementById("symbol").textContent = token.name.slice(0, 4);
  document.getElementById("t_name").textContent = token.name;

  // 🩵 ADD THIS NEW FALLBACK:
  if (token.price) {
    currentPrice = parseFloat(token.price);
    document.getElementById("t_price").textContent = `$${currentPrice.toFixed(2)}`;
  }

  // Firebase live update (if available)
  const priceRef = doc(db, "prices", token.name);
  onSnapshot(priceRef, (snap) => {
    if (snap.exists()) {
      currentPrice = snap.data().price;
      document.getElementById("t_price").textContent = `$${currentPrice.toFixed(2)}`;
      updateMaxBuyInfo();
    }
  });

  await loadTokenData();
  loadTradeHistory();
}


function updateMaxBuyInfo() {
  const info = document.getElementById("maxBuyInfo");
  if (!info) return;

  // 🛑 Check wallet
  if (walletBalance <= 0) {
    info.textContent = "Insufficient balance to buy tokens";
    return;
  }

  // 🛑 Check price
  if (currentPrice <= 0 || isNaN(currentPrice)) {
    info.textContent = "Price not available yet";
    return;
  }

  // ✅ Calculate maximum tokens
  const maxTokens = (walletBalance / currentPrice).toFixed(2);
  info.textContent = `You can buy ${maxTokens} tokens max`;
}


// 🔹 Token-specific data
async function loadTokenData() {
  const ref = doc(db, "byTokens", currentUser.uid, "tokens", token.name);
  const snap = await getDoc(ref);
  if (!snap.exists()) await setDoc(ref, { totalOwned: 0, totalStaked: 0, totalProfit: 0 });

  const data = snap.data() || { totalOwned: 0, totalStaked: 0, totalProfit: 0 };
  document.getElementById("userBalance").textContent = data.totalOwned.toFixed(2);
  document.getElementById("userStaked").innerHTML = `
    ${data.totalStaked.toFixed(2)}
    <div id="stakeInfo" style="font-size:12px;color:#0ea5a4;margin-top:4px;">
      Live Profit: $${data.totalProfit.toFixed(4)}
    </div>
    <button id="releaseBtn" style="margin-top:5px;padding:4px 10px;font-size:12px;
      background:#16a34a;color:#fff;border:none;border-radius:6px;cursor:pointer;">
      Release
    </button>`;
  
  startProfitEngine(ref, data.totalStaked, data.totalProfit);
  document.getElementById("releaseBtn").onclick = () => releaseStake(ref);
}

// 🔹 Profit auto engine
function startProfitEngine(ref, staked, profit) {
  clearInterval(window.profitTimer);

  // 🟢 Chart ko start me update kar do
  updateEarningChart(profit);

  let counter = 0;

  window.profitTimer = setInterval(async () => {
    if (staked > 0) {
      profit += staked * perMinuteRate;
      counter++;

      // 🔹 Har minute UI me profit dikhaye
      const stakeInfo = document.getElementById("stakeInfo");
      if (stakeInfo) {
        stakeInfo.innerHTML = `Live Profit: $${profit.toFixed(4)}`;
      }

      // 🔹 Chart update karo
      updateEarningChart(profit);

      // 🔹 Har 5 minute me Firestore me save karo
      if (counter % 5 === 0) {
        try {
          await updateDoc(ref, { totalProfit: profit });
        } catch (err) {
          console.warn("Firestore sync skipped:", err);
        }
      }
    }
  }, 60000); // 60000 = 1 minute
}


// 🔹 Release with 3-level referral
async function releaseStake(ref) {
  const snap = await getDoc(ref);
  const data = snap.data();
  if (!data || data.totalStaked <= 0) return showAlert("Nothing to release!", "error");

  showAlert("Processing release...", "info");

  const profit = data.totalProfit;
  const staked = data.totalStaked;
  const totalReturn = staked * currentPrice + profit * 0.70;

  // user balance update
  walletBalance += totalReturn;
  await updateDoc(doc(db, "users", currentUser.uid), { walletBalance });

  // reset token fields
  await updateDoc(ref, { totalStaked: 0, totalProfit: 0 });

  // credit 3 upline levels
  const userSnap = await getDoc(doc(db, "users", currentUser.uid));
  const upline1 = userSnap.data()?.upline1 || null;
  const upline2 = userSnap.data()?.upline2 || null;
  const upline3 = userSnap.data()?.upline3 || null;

  async function creditUpline(uid, percent) {
    if (!uid) return;
    const uRef = doc(db, "users", uid);
    const s = await getDoc(uRef);
    if (!s.exists()) return;
    const data = s.data();
    const newBal = (data.walletBalance ?? 0) + profit * percent;
    await updateDoc(uRef, { walletBalance: newBal });
    await addDoc(collection(db, "transactions"), {
      from: currentUser.uid,
      to: uid,
      amount: profit * percent,
      levelPercent: percent * 100,
      type: "UPLINE_REWARD",
      timestamp: serverTimestamp()
    });
  }

  await creditUpline(upline1, 0.17);
  await creditUpline(upline2, 0.08);
  await creditUpline(upline3, 0.05);

  // add trade record
  await addDoc(collection(ref, "trades"), {
    action: "RELEASE",
    qty: staked,
    price: currentPrice,
    profit: profit,
    timestamp: serverTimestamp()
  });

  document.getElementById("walletTotal").textContent = `$${walletBalance.toFixed(2)}`;
  document.getElementById("userStaked").textContent = "0.00";
  showAlert("Released successfully!", "success");
  updateMaxBuyInfo(); // <== add yahan
}

// 🔹 Modal + Trade Actions
const modal = document.getElementById("tradeModal");
const header = document.getElementById("modalHeader");
const qtyInput = document.getElementById("modalQty");
const total = document.getElementById("modalTotal");
const err = document.getElementById("modalError");
let tradeType = null;

document.getElementById("btnBuy").onclick = () => openModal("BUY");
document.getElementById("btnSell").onclick = () => openModal("SELL");
document.querySelector(".stake").onclick = () => openModal("STAKE");
document.getElementById("cancelTrade").onclick = () => modal.style.display = "none";

//editing 
async function openModal(type) {
  tradeType = type;
  const ref = doc(db, "byTokens", currentUser.uid, "tokens", token.name);
  const snap = await getDoc(ref);
  const d = snap.data() || { totalOwned: 0 };
  if (type === "BUY" && walletBalance <= 0) return showAlert("No wallet balance", "error");
  if ((type === "SELL" || type === "STAKE") && d.totalOwned <= 0)
    return showAlert("No tokens available", "error");
  modal.style.display = "flex";
  header.textContent = `${type} ${token.name}`;
  qtyInput.value = "";
  total.textContent = "$0.00";
  
  // ✅ ensures "You can buy X tokens max" updates immediately (only for BUY)
if (type === "BUY") updateMaxBuyInfo();

// 💡 Dynamic color theme for modal based on action
const modalHeader = document.querySelector(".modal-header");
const confirmBtn = document.querySelector(".confirm");

if (type === "BUY") {
  modalHeader.style.background = "linear-gradient(135deg, #16a34a, #22c55e)";
  confirmBtn.style.background = "#16a34a";
} 
else if (type === "SELL") {
  modalHeader.style.background = "linear-gradient(135deg, #dc2626, #ef4444)";
  confirmBtn.style.background = "#dc2626";
} 
else if (type === "STAKE") {
  modalHeader.style.background = "linear-gradient(135deg, #0ea5a4, #06b6d4)";
  confirmBtn.style.background = "#0ea5a4";
}


 // ✅ NEW PART: Update current price + available balance
  document.getElementById("modalPrice").textContent = `$${currentPrice.toFixed(2)}`;

  if (type === "BUY") {
    document.getElementById("modalWallet").textContent = `$${walletBalance.toFixed(2)}`;
  } else {
    document.getElementById("modalWallet").textContent = `${d.totalOwned.toFixed(2)} Tokens`;
  }
}
qtyInput.oninput = () => {
  const q = parseFloat(qtyInput.value) || 0;
  total.textContent = `$${(q * currentPrice).toFixed(2)}`;
};

  document.getElementById("confirmTrade").onclick = async () => {
  const qty = parseFloat(qtyInput.value);
  if (!qty || qty <= 0) return (err.textContent = "Enter valid qty");
  const sum = qty * currentPrice;
  const userRef = doc(db, "users", currentUser.uid);
  const tokenRef = doc(db, "byTokens", currentUser.uid, "tokens", token.name);
  const tSnap = await getDoc(tokenRef);
  const tData = tSnap.data() || { totalOwned: 0, totalStaked: 0, totalProfit: 0 };

  try {
    if (tradeType === "BUY") {
      if (sum > walletBalance) return showAlert("Not enough balance", "error");
      walletBalance -= sum;
      tData.totalOwned += qty;
    }
    if (tradeType === "SELL") {
      if (qty > tData.totalOwned) return showAlert("Not enough tokens", "error");
      tData.totalOwned -= qty;
      walletBalance += sum;
    }
    if (tradeType === "STAKE") {
      if (qty > tData.totalOwned) return showAlert("Not enough tokens", "error");
      tData.totalOwned -= qty;
      tData.totalStaked += qty;
      tData.totalProfit = 0;
    }

    await updateDoc(userRef, { walletBalance });
    await setDoc(tokenRef, tData);
    await addDoc(collection(tokenRef, "trades"), {
      action: tradeType,
      qty,
      price: currentPrice,
      timestamp: serverTimestamp()
    });

    document.getElementById("walletTotal").textContent = `$${walletBalance.toFixed(2)}`;
    document.getElementById("userBalance").textContent = tData.totalOwned.toFixed(2);
    document.getElementById("userStaked").textContent = tData.totalStaked.toFixed(2);
    modal.style.display = "none";
    showAlert(`${tradeType} successful`, "success");
  } catch (e) {
    console.error(e);
    showAlert("Transaction failed", "error");
  }
};

// 🔹 Trade history
function loadTradeHistory() {
  const tradesRef = collection(db, "byTokens", currentUser.uid, "tokens", token.name, "trades");
  const q = query(tradesRef, orderBy("timestamp", "desc"));
  const tb = document.querySelector("#tradeTable tbody");
  onSnapshot(q, (s) => {
    tb.innerHTML = "";
    s.forEach(x => {
      const d = x.data();
      const t = d.timestamp?.toDate().toLocaleTimeString() || "--";
      tb.innerHTML += `
      <tr>
        <td>${t}</td>
        <td>${token.name}</td>
        <td style='color:${d.action=="BUY"?"#16a34a":d.action=="SELL"?"#dc2626":"#0ea5a4"};font-weight:700'>
          ${d.action}
        </td>
        <td>${d.qty}</td>
        <td>$${d.price.toFixed(2)}</td>
      </tr>`;
    });
  });
}

// 🔹 Chart Update
function updateEarningChart(profit) {
  const chart = window.earningChart;
  if (!chart) return;
  const time = new Date().toLocaleTimeString();
  chart.data.labels.push(time);
  chart.data.datasets[0].data.push(profit.toFixed(4));
  if (chart.data.labels.length > 10) {
    chart.data.labels.shift();
    chart.data.datasets[0].data.shift();
  }
  chart.update();
}

// 🔹 Logout
document.getElementById("logoutBtn").onclick = () => {
  signOut(auth).then(() => {
    localStorage.clear();
    window.location.href = "login.html";
  });
};

// 🔒 Disable right-click & inspect
document.addEventListener("contextmenu", e => e.preventDefault());
document.addEventListener("keydown", e => {
  if ((e.ctrlKey && ["c","x","v","u"].includes(e.key.toLowerCase())) || e.key === "F12")
    e.preventDefault();
});



// ❌ Disable text selection
document.addEventListener("selectstart", e => e.preventDefault());


// 🧹 Stop profit timer on reload or exit
window.addEventListener("beforeunload", () => clearInterval(window.profitTimer));

// 📱 Adjust modal when keyboard opens (mobile fix)
const modalInput = document.getElementById("modalQty");

// when input focused — popup goes up
modalInput.addEventListener("focus", () => {
  const modalContent = document.querySelector(".modal-content");
  modalContent.style.transition = "transform 0.3s ease";
  modalContent.style.transform = "translateY(-80px)";
});

// when input unfocused — popup comes back to center
modalInput.addEventListener("blur", () => {
  const modalContent = document.querySelector(".modal-content");
  modalContent.style.transform = "translateY(0)";
});


// 🔹 Initialize Chart.js
const ctx = document.getElementById("earningChart").getContext("2d");
window.earningChart = new Chart(ctx, {
  type: "line",
  data: {
    labels: [],
    datasets: [{
      label: "Live Profit ($)",
      data: [],
      borderWidth: 2,
      borderColor: "#0ea5a4",
      tension: 0.3,
      fill: true,
      backgroundColor: "rgba(14,165,164,0.08)",
      pointRadius: 0
    }]
  },
  options: {
    responsive: true,
    scales: {
      x: { display: false },
      y: { ticks: { color: "#64748b" }, beginAtZero: true }
    },
    plugins: { legend: { display: false } }
  }
});

// 🟢 Chart pre-fill data (last 5 mins zero profit)
for (let i = 0; i < 5; i++) {
  const time = new Date(Date.now() - (5 - i) * 60000).toLocaleTimeString();
  window.earningChart.data.labels.push(time);
  window.earningChart.data.datasets[0].data.push(0);
}
window.earningChart.update();


</script>
</body>
</html>

