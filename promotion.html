<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TrustDollar | Real-Time Referrals</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<style>
body {
  font-family: "Poppins", sans-serif;
  background: #f1f5f9;
  margin: 0;
  padding-top: 70px;
  padding-bottom: 100px;
  color: #333;
}
.container { max-width: 950px; margin: auto; padding: 20px; }
.card {
  background: #fff; padding: 20px; border-radius: 5px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08); margin-bottom: 20px;
  text-align: center;
}
.header {
  position: fixed; top: 0; left: 0; width: 100%;
  background: #ffffff00;
  color: #21d82b; text-align: center;
  padding: 10px; font-size: 18px; font-weight: bold;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  z-index: 1000;
}
.team-grid {
  display: grid; grid-template-columns: repeat(2,1fr);
  gap: 14px; margin-top: 15px;
}
.team-box {
  background: #f8fafc; border-radius: 1px;
  padding: 16px 0; box-shadow: 0 3px 8px rgba(0,0,0,0.08);
  text-align: center; transition: 0.3s;
}
.team-box:hover { transform: translateY(-3px); }
.team-box .label { font-size: 15px; color: #2563eb; font-weight: 600; margin-bottom: 6px; display:block; }
.team-box .value {
  font-size: 16px; font-weight: 700; color: #16a34a;
   border: 1px solid #a7f3d0;
  padding: 6px 12px; border-radius: 10px;
}
.team-box.total { background: #f8fafc; }
.team-box.total .value { background:#7299c0; color:#fff; }

.btn-row { display:flex; justify-content:center; gap:10px; margin-top:15px; }
.btn { padding:10px 18px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; color:#fff; transition:0.3s; }
.btn-copy { background:#00aaff; }
.btn-share { background:#ff9800; }
#qrcode-wrapper { display:flex; justify-content:center; margin:15px 0; }
#qrcode { padding:10px; border:2px solid #22c55e; border-radius:12px; }

.level-buttons { display:flex; justify-content:space-between; gap:8px; margin:15px 0; }
.level-btn {
  flex:1; padding:10px; border:none; border-radius:8px;
  font-weight:600; cursor:pointer; background:#e5e7eb; color:#333;
}
.level-btn.active { background:#2563eb; color:#fff; }

.level-content {
  display:none; border:1px solid #e5e7eb; border-radius:10px;
  padding:12px; background:#fff; margin-bottom:12px;
}
.level-content.active { display:block; }

.user-table { width:100%; border-collapse:collapse; margin-top:10px; font-size:14px; }
.user-table th, .user-table td { padding:10px; border-bottom:1px solid #eee; text-align:center; }
.status-active { color:green; font-weight:bold; }
.status-inactive { color:red; }

.popup {
  position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  background:#333; color:#fff; padding:12px 18px; border-radius:8px;
  display:none; z-index:999;
}

/* scroll & search */
.scrollable-list {
  max-height: 250px;
  overflow-y: auto;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 8px;
  margin-top: 10px;
  background: #fff;
}
.scrollable-list::-webkit-scrollbar { width: 6px; }
.scrollable-list::-webkit-scrollbar-thumb { background: #00c853; border-radius: 6px; }
.scrollable-list::-webkit-scrollbar-track { background: #f1f5f9; }

.search-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 10px 0 8px;
  gap: 6px;
}
.search-bar input {
  flex: 1;
  padding: 8px 10px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 13px;
}
.search-bar button {
  background: #00c853;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.2s;
}
.search-bar button:hover { background: #00994e; }


 /* ✅ Ultra Clear Bottom Nav (No Blur, High Contrast) */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 94%;
  max-width: 480px;
  background: #ffffff; /* solid white */
  border: 1px solid #e0e0e0;
  border-radius: 18px;
  box-shadow: 0 -6px 20px rgba(0, 0, 0, 0.08);
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 10px 0;
  z-index: 1000;
  animation: slideUp 0.6s ease;
}

/* Slide animation */
@keyframes slideUp {
  from { transform: translate(-50%, 60px); opacity: 0; }
  to { transform: translate(-50%, 0); opacity: 1; }
}

/* Nav Items */
.nav-item {
  flex: 1;
  text-align: center;
  color: #888;
  font-size: 12px;
  text-decoration: none;
  transition: all 0.25s ease;
  position: relative;
  padding: 4px 0;
}

/* Icons */
.nav-item i {
  font-size: 22px;
  display: block;
  margin-bottom: 3px;
  color: #666;
  transition: all 0.25s ease;
  filter: none; /* remove soft edges */
}

/* Hover & Active */
.nav-item:hover i,
.nav-item.active i {
  color: #00c853;
  transform: translateY(-3px) scale(1.15);
  text-shadow: 0 0 8px rgba(0, 200, 83, 0.4);
}

.nav-item:hover span,
.nav-item.active span {
  color: #00c853;
  font-weight: 600;
}

/* Glow dot under active item */
.nav-item.active::after {
  content: "";
  position: absolute;
  bottom: -3px;
  left: 50%;
  transform: translateX(-50%);
  width: 6px;
  height: 6px;
  background: #00c853;
  border-radius: 50%;
  box-shadow: 0 0 8px rgba(0, 200, 83, 0.4);
}

/* Responsive fix */
@media(max-width:600px){
  .bottom-nav {
    border-radius: 10px;
    padding: 8px 0;
  }
  .nav-item i {
    font-size: 20px;
  }
}

#qrcode img {
  border-radius: 10px;
  box-shadow: 0 3px 12px rgba(0,0,0,0.15);
}


/* 🌟 TrustDollar Popup Notification */
.td-popup {
  position: fixed;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%);
  background: #00c853;
  color: #fff;
  font-weight: 600;
  padding: 10px 20px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
  opacity: 0;
  pointer-events: none;
  transition: all 0.4s ease;
  z-index: 9999;
}
.td-popup.show {
  opacity: 1;
  bottom: 110px;
}




/* 🌟 Top Fixed Level Navigation (like Smart Mining) */
.top-level-nav {
  position: fixed;
  top: 48px; /* Just below your header */
  left: 0;
  width: 100%;
  background: #ffffff;
  display: flex;
  justify-content: center;
  gap: 10px;
  padding: 10px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  z-index: 999;
}

.level-tab {
  background: #f1f5f9;
  border: 1px solid #d1d5db;
  border-radius: 5px;
  padding: 8px 16px;
  font-weight: 600;
  color: #2563eb;
  cursor: pointer;
  transition: all 0.3s ease;
}

.level-tab.active {
  background: #22c55e;
  color: white;
  border-color: #22c55e;
  box-shadow: 0 3px 8px rgba(34,197,94,0.4);
}

.level-tab:hover {
  background: #dcfce7;
}

/* ✅ Adjust padding so content doesn't hide under top nav */
body {
  padding-top: 120px !important;
}


.referral-link {
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: normal;
  max-width: 100%;
  display: inline-block;
  color: #2563eb;
  font-weight: 500;
  text-align: center;
  font-size: 14px;
  background: #f0fdf4;
  border: 1px solid #86efac;
  border-radius: 8px;
  padding: 6px 8px;
  word-break: break-all;
}

</style>
</head>
<body>
<div class="header">My Referrals</div>


<div class="container">
  <div class="card">
    <h2>My Team</h2>
    <div class="team-grid">
      <div class="team-box"><span class="label">Level 1</span><span id="teamLv1" class="value">0</span></div>
      <div class="team-box"><span class="label">Level 2</span><span id="teamLv2" class="value">0</span></div>
      <div class="team-box"><span class="label">Level 3</span><span id="teamLv3" class="value">0</span></div>
      <div class="team-box total"><span class="label">Total</span><span id="teamTotal" class="value">0</span></div>
    </div>
  </div>
<!-- ✅ Popup Notification -->
<div id="tdPopup" class="td-popup"></div>

  <div class="card referral-card">
    <b>Your link:</b>
    <div id="refLink" class="referral-link">Loading referral link...</div>
    <div id="qrcode-wrapper"><div id="qrcode"></div></div>
    <div class="btn-row">
      <button class="btn btn-copy" onclick="copyReferral()">Copy Link</button>
      <button class="btn btn-share" onclick="shareReferral()">Share Link</button>
    </div>
  </div>

<!-- 🌟 Top Level Navigation -->
<div class="top-level-nav">
  <button class="level-tab active" onclick="showLevel(1)">Level 1</button>
  <button class="level-tab" onclick="showLevel(2)">Level 2</button>
  <button class="level-tab" onclick="showLevel(3)">Level 3</button>
</div>

  <div id="level1" class="level-content active">
    <h3>Earning: <b id="level1Earning">$0</b></h3>
    <div class="search-bar">
      <input type="text" id="searchLv1" placeholder="Search member by name...">
      <button onclick="searchLevel(1)">Search</button>
    </div>
    <div id="level1List" class="scrollable-list"></div>
  </div>

  <div id="level2" class="level-content">
    <h3>Earning: <b id="level2Earning">$0</b></h3>
    <div class="search-bar">
      <input type="text" id="searchLv2" placeholder="Search member by name...">
      <button onclick="searchLevel(2)">Search</button>
    </div>
    <div id="level2List" class="scrollable-list"></div>
  </div>

  <div id="level3" class="level-content">
    <h3>Earning: <b id="level3Earning">$0</b></h3>
    <div class="search-bar">
      <input type="text" id="searchLv3" placeholder="Search member by name...">
      <button onclick="searchLevel(3)">Search</button>
    </div>
    <div id="level3List" class="scrollable-list"></div>
  </div>
</div>

<div class="bottom-nav">
  <a href="Dashboard.html" class="nav-item active"><i class='bx bxs-dashboard'></i><span>Home</span></a>
  <a href="mining.html" class="nav-item"><i class='bx bxs-coin-stack'></i><span>Invest</span></a>
  <a href="promotion.html" class="nav-item"><i class='bx bxs-user-plus'></i><span>Refer</span></a>
  <a href="account.html" class="nav-item"><i class='bx bxs-user-circle'></i><span>Account</span></a>
</div>
<script>
  // 🔥 Bottom nav auto-active highlight logic
  const navLinks = document.querySelectorAll(".bottom-nav a");

  // current page ka URL filename nikalta hai (e.g., mining.html)
  const currentPage = window.location.pathname.split("/").pop();

  navLinks.forEach(link => {
    const linkPage = link.getAttribute("href");

    if (linkPage === currentPage) {
      link.classList.add("active"); // ✅ Active highlight add karega
    } else {
      link.classList.remove("active");
    }

    // Optional: click par bhi active ho turant
    link.addEventListener("click", () => {
      navLinks.forEach(nav => nav.classList.remove("active"));
      link.classList.add("active");
    });
  });
</script>
<div id="popup" class="popup"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, query, where, onSnapshot, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
  authDomain: "btcinvest-c0e25.firebaseapp.com",
  projectId: "btcinvest-c0e25",
  storageBucket: "btcinvest-c0e25.firebasestorage.app",
  messagingSenderId: "204937458487",
  appId: "1:204937458487:web:cc27ece1249999279f60b2",
  measurementId: "G-HG0Q8ZHT6G"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// 🔄 Switch Level Tabs (top nav buttons)
window.showLevel = function(level) {
  document.querySelectorAll(".level-tab").forEach(btn => btn.classList.remove("active"));
  document.querySelector(`.level-tab:nth-child(${level})`).classList.add("active");

  document.querySelectorAll(".level-content").forEach(c => c.classList.remove("active"));
  document.getElementById(`level${level}`).classList.add("active");
};

window.searchLevel = function(level){
  const val=document.getElementById(`searchLv${level}`).value.toLowerCase();
  const table=document.querySelector(`#level${level}List table`);
  if(!table)return;
  const rows=table.getElementsByTagName("tr");
  for(let i=1;i<rows.length;i++){
    const td=rows[i].getElementsByTagName("td")[0];
    if(td){
      const name=td.textContent||td.innerText;
      rows[i].style.display=name.toLowerCase().includes(val)?"":"none";
    }
  }
};

// hybrid + team counts
function hybridLevelSystem(currentUser, level){
  const membersMap={};
  let q;
  if(level===1) q=query(collection(db,"users"),where("referredBy","==",currentUser.referralCode));
  else if(level===2) q=query(collection(db,"users"),where("upline2","==",currentUser.uid));
  else if(level===3) q=query(collection(db,"users"),where("upline3","==",currentUser.uid));

  onSnapshot(q,s=>{
    s.forEach(docSnap=>{
      const d=docSnap.data();
      membersMap[d.uid||docSnap.id]={name:d.name||"Unnamed",lifetimeDeposit:(d.totalInvested||d.lifetimeDeposit||0),totalInvested:d.totalInvested||0};
    });
    renderHybrid(level,membersMap);
  });

  const cq=query(collection(db,"users",currentUser.uid,"commissions"),where("level","==",level));
  onSnapshot(cq,async snap=>{
    for(const docSnap of snap.docs){
      const c=docSnap.data();let name="Unknown",active=false;
      try{
        const downSnap=await getDoc(doc(db,"users",c.fromUser));
        if(downSnap.exists()){
          const d=downSnap.data();name=d.name||"Unnamed";active=(d.totalInvested||d.lifetimeDeposit||0)>0;
        }
      }catch{}
      membersMap[c.fromUser]={name,lifetimeDeposit:active?1:0,totalInvested:(membersMap[c.fromUser]?.totalInvested||0)+parseFloat(c.amount||0)};
    }
    renderHybrid(level,membersMap);
  });
}

function renderHybrid(level,map){
  const members=Object.values(map);
  const c=document.getElementById(`level${level}List`);
  if(!members.length){c.innerHTML="<em>No users found</em>";return;}
  let total=0;members.forEach(m=>total+=m.totalInvested);
  document.getElementById(`level${level}Earning`).textContent="$"+total.toFixed(2);
  c.innerHTML=`<table class="user-table"><thead><tr><th>Name</th><th>Status</th><th>Received</th></tr></thead><tbody>${
    members.map(u=>`<tr><td>${u.name}</td><td>${u.lifetimeDeposit>0?"<span class='status-active'>Active</span>":"<span class='status-inactive'>Inactive</span>"}</td><td>$${(u.totalInvested||0).toFixed(2)}</td></tr>`).join("")
  }</tbody></table>`;
}


// QR CODE KA HAI YE 

onAuthStateChanged(auth, async user => {
  if (!user) return (window.location.href = "login.html");
  const snap = await getDoc(doc(db, "users", user.uid));
  if (!snap.exists()) return;
  const currentUser = { ...snap.data(), uid: user.uid };

  // ✅ Generate Referral Link + QR Code (add this)
const refCode = currentUser.referralCode || user.uid;
const finalRefLink = `https://smartfundad.com/index.html?ref=${refCode}`;
document.getElementById("refLink").textContent = finalRefLink;

// QR code
document.getElementById("qrcode").innerHTML = "";
new QRCode(document.getElementById("qrcode"), {
  text: finalRefLink,
  width: 120,
  height: 120,
  colorDark: "#000000",
  colorLight: "#ffffff",
  correctLevel: QRCode.CorrectLevel.H
});


  // ✅ team query and level system continue as before
  const ref1 = query(collection(db, "users"), where("referredBy", "==", currentUser.referralCode));
  const ref2 = query(collection(db, "users"), where("upline2", "==", user.uid));
  const ref3 = query(collection(db, "users"), where("upline3", "==", user.uid));
  let lv1 = 0, lv2 = 0, lv3 = 0;
  const updateCounts = () => {
    document.getElementById("teamLv1").textContent = lv1;
    document.getElementById("teamLv2").textContent = lv2;
    document.getElementById("teamLv3").textContent = lv3;
    document.getElementById("teamTotal").textContent = lv1 + lv2 + lv3;
  };
  onSnapshot(ref1, s => { lv1 = s.size; updateCounts(); });
  onSnapshot(ref2, s => { lv2 = s.size; updateCounts(); });
  onSnapshot(ref3, s => { lv3 = s.size; updateCounts(); });

  ["1", "2", "3"].forEach(lv => hybridLevelSystem(currentUser, parseInt(lv)));
});

// ✅ Copy & Share Referral Functions
window.copyReferral = function () {
  const refLink = document.getElementById("refLink").innerText;
  if (!refLink || refLink.includes("Loading")) {
    showPopup("Referral link not ready yet!");
    return;
  }
  navigator.clipboard.writeText(refLink);
  showPopup("Referral link copied!");
};

window.shareReferral = function () {
  const refLink = document.getElementById("refLink").innerText;
  if (!refLink || refLink.includes("Loading")) {
    showPopup("Referral link not ready yet!");
    return;
  }

  if (navigator.share) {
    navigator.share({
      title: "TrustDollar Invite",
      text: "Join TrustDollar and earn secure rewards!",
      url: refLink,
    });
  } else {
    alert("Sharing not supported on this device.");
  }
};

// puip up ke liey hai 
// 🌿 TrustDollar Popup Function
function showPopup(message, color = "#00c853") {
  const popup = document.getElementById("tdPopup");
  popup.style.background = color;
  popup.innerText = message;
  popup.classList.add("show");
  setTimeout(() => popup.classList.remove("show"), 2000);
}

</script>
<script>
  // 🚫 Disable right click, select, drag
  document.addEventListener("contextmenu", e => e.preventDefault());
  document.addEventListener("selectstart", e => e.preventDefault());
  document.addEventListener("dragstart", e => e.preventDefault());

  // 🚫 Disable keyboard shortcuts (copy, paste, inspect, etc.)
  document.addEventListener("keydown", e => {
    if (
      e.key === "F12" ||
      (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
      (e.ctrlKey && (e.key === "U" || e.key === "C" || e.key === "X" || e.key === "V" || e.key === "S"))
    ) {
      e.preventDefault();
      return false;
    }
  });

  // 🔒 Silent DevTools detection (no popup)
  (function() {
    const devtools = /./;
    devtools.toString = function() {
      return ""; // no alert or console log
    };
    console.log("%c", devtools);
  })();

  // 🔐 Detect DevTools using resize trick (no popup)
  setInterval(() => {
    const threshold = 160;
    const widthDiff = window.outerWidth - window.innerWidth > threshold;
    const heightDiff = window.outerHeight - window.innerHeight > threshold;
    if (widthDiff || heightDiff) {
      // Optional: silently redirect or blank the page
      document.body.innerHTML = "";
    }
  }, 1000);

  // 🧱 Disable copy/paste/cut
  ["copy", "paste", "cut"].forEach(evt =>
    document.addEventListener(evt, e => e.preventDefault())
  );

  // 🔁 Freeze console methods silently
  Object.freeze(console);
  Object.freeze(window.console);
</script>
</body>
</html>s
