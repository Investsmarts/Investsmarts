<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" 
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TrustDollar | Real-Time Referrals</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<!-- âœ… BTCInvest Auto Smart Bottom Navbar -->
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet">
<style>
body {
  font-family: "Poppins", sans-serif;
  background: #f1f5f9;
  margin: 0;
  padding-top: 70px;
  padding-bottom: 100px;
  color: #333;
}
.container { max-width: 950px; margin: auto; padding: 10px; }
.card {
  background: #fff; padding: 20px; border-radius: 5px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08); margin-bottom: 20px;
  text-align: center;
}
.header {
  position: fixed; top: 0; left: 0; width: 100%;
  background: #ffffff00;
  color: #21d82b; text-align: center;
  padding: 10px; font-size: 18px; font-weight: bold;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  z-index: 1000;
}
.team-grid {
  display: grid; grid-template-columns: repeat(2,1fr);
  gap: 14px; margin-top: 15px;
}
.team-box {
  background: #f8fafc; border-radius: 1px;
  padding: 16px 0; box-shadow: 0 3px 8px rgba(0,0,0,0.08);
  text-align: center; transition: 0.3s;
}
.team-box:hover { transform: translateY(-3px); }
.team-box .label { font-size: 15px; color: #2563eb; font-weight: 600; margin-bottom: 6px; display:block; }
.team-box .value {
  font-size: 16px; font-weight: 700; color: #16a34a;
   border: 1px solid #a7f3d0;
  padding: 6px 12px; border-radius: 5px;
}
.team-box.total { background: #f8fafc; }
.team-box.total .value { background:#7299c0; color:#fff; }

.btn-row { display:flex; justify-content:center; gap:40px; margin-top:15px; }
.btn { padding:10px 18px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; color:#fff; transition:0.3s; }
.btn-copy { background:#00aaff; }
.btn-share { background:#ff9800; }
#qrcode-wrapper { display:flex; justify-content:center; margin:15px 0; }
#qrcode { padding:10px; border:2px solid #22c55e; border-radius:5px; }

.level-buttons { display:flex; justify-content:space-between; gap:8px; margin:15px 0; }
.level-btn {
  flex:1; padding:10px; border:none; border-radius:8px;
  font-weight:600; cursor:pointer; background:#e5e7eb; color:#333;
}
.level-btn.active { background:#2563eb; color:#fff; }

.level-content {
  display:none; border:1px solid #e5e7eb; border-radius:5px;
  padding:12px; background:#fff; margin-bottom:12px;
}
.level-content.active { display:block; }

.user-table { width:100%; border-collapse:collapse; margin-top:10px; font-size:14px; }
.user-table th, .user-table td { padding:10px; border-bottom:1px solid #eee; text-align:center; }
.status-active { color:green; font-weight:bold; }
.status-inactive { color:red; }

.popup {
  position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  background:#333; color:#fff; padding:12px 18px; border-radius:5px;
  display:none; z-index:999;
}

/* scroll & search */
.scrollable-list {
  max-height: 250px;
  overflow-y: auto;
  border: 1px solid #e5e7eb;
  border-radius: 5px;
  padding: 8px;
  margin-top: 10px;
  background: #fff;
}
.scrollable-list::-webkit-scrollbar { width: 6px; }
.scrollable-list::-webkit-scrollbar-thumb { background: #00c853; border-radius: 6px; }
.scrollable-list::-webkit-scrollbar-track { background: #f1f5f9; }

.search-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 10px 0 8px;
  gap: 6px;
}
.search-bar input {
  flex: 1;
  padding: 8px 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
  font-size: 13px;
}
.search-bar button {
  background: #00c853;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.2s;
}
.search-bar button:hover { background: #00994e; }



#qrcode img {
  border-radius: 10px;
  box-shadow: 0 3px 12px rgba(0,0,0,0.15);
}


/* ðŸŒŸ TrustDollar Popup Notification */
.td-popup {
  position: fixed;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%);
  background: #00c853;
  color: #fff;
  font-weight: 600;
  padding: 10px 20px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
  opacity: 0;
  pointer-events: none;
  transition: all 0.4s ease;
  z-index: 9999;
}
.td-popup.show {
  opacity: 1;
  bottom: 110px;
}




/* ðŸŒŸ Top Fixed Level Navigation (like Smart Mining) */
.top-level-nav {
  position: fixed;
  top: 48px; /* Just below your header */
  left: 0;
  width: 100%;
  background: #ffffff;
  display: flex;
  justify-content: center;
  gap: 27px;
  padding: 9px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  z-index: 999;
}

.level-tab {
  background: #f1f5f9;
  border: 1px solid #d1d5db;
  border-radius: 5px;
  padding: 8px 16px;
  font-weight: 600;
  color: #2563eb;
  cursor: pointer;
  transition: all 0.3s ease;
}

.level-tab.active {
  background: #22c55e;
  color: white;
  border-color: #22c55e;
  box-shadow: 0 3px 8px rgba(34,197,94,0.4);
}

.level-tab:hover {
  background: #dcfce7;
}

/* âœ… Adjust padding so content doesn't hide under top nav */
body {
  padding-top: 100px !important;
}


.referral-link {
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: normal;
  max-width: 100%;
  display: inline-block;
  color: #2563eb;
  font-weight: 500;
  text-align: center;
  font-size: 14px;
  background: #f0fdf4;
  border: 1px solid #86efac;
  border-radius: 8px;
  padding: 6px 8px;
  word-break: break-all;
}


/* ðŸŒˆ Animated border for Level 1 */
.team-box:nth-child(1) {
  position: relative;
  border-radius: 10px;
  overflow: hidden;
  background: #f8fafc;
}

.team-box:nth-child(1)::before {
  content: "";
  position: absolute;
  inset: -3px;
  border-radius: 5px;
  background: conic-gradient(
    from 0deg,
    #ff0000,
    #ff9900,
    #00ff00,
    #00ffff,
    #0000ff,
    #ff00ff,
    #ff0000
  );
  animation: rotateBorder 4s linear infinite;
  z-index: 0;
}

.team-box:nth-child(1)::after {
  content: "";
  position: absolute;
  inset: 2px;
  border-radius: 5px;
  background: #f8fafc;
  z-index: 1;
}

.team-box:nth-child(1) * {
  position: relative;
  z-index: 2;
}

@keyframes rotateBorder {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}


/* ðŸ”¥ Smooth hide/show animation */
.header,
.top-level-nav {
  transition: transform 0.4s ease, opacity 0.3s ease;
}

.header.hide,
.top-level-nav.hide {
  transform: translateY(-100%);
  opacity: 0;
}

/* ðŸŒˆ Animated rotating border for ALL team boxes */
.team-box {
  position: relative;
  border-radius: 5px;
  overflow: hidden;
  background: #f8fafc;
  transition: transform 0.3s ease, opacity 0.3s ease;
  cursor: pointer;
}

.team-box::before {
  content: "";
  position: absolute;
  inset: -3px;
  border-radius: 12px;
  background: conic-gradient(
    from 0deg,
    #ff0000,
    #ff9900,
    #00ff00,
    #00ffff,
    #0000ff,
    #ff00ff,
    #ff0000
  );
  animation: rotateBorder 4s linear infinite;
  z-index: 0;
}

.team-box::after {
  content: "";
  position: absolute;
  inset: 2px;
  border-radius: 5px;
  background: #f8fafc;
  z-index: 1;
}

.team-box * {
  position: relative;
  z-index: 2;
}

@keyframes rotateBorder {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* ðŸ‘‡ Optional: Hover effect thoda upar uthta hai */
.team-box:hover {
  transform: translateY(-4px);
}

/* ðŸŒ€ Hide animation (already working with your JS) */
.team-box.hide {
  transform: scale(0.9);
  opacity: 0;
  pointer-events: none;
}



:root {
  --nav-bg: #fff;
  --nav-text: #444;
  --nav-border: rgba(0, 0, 0, 0.08);
}

[data-theme="dark"] {
  --nav-bg: #0f0f0f;
  --nav-text: #ccc;
  --nav-border: rgba(255, 255, 255, 0.1);
}

/* ðŸ”¹ Navbar Base (height reduced) */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: var(--nav-bg);
  border-top: 1px solid var(--nav-border);
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 10px 0; /* ðŸ‘ˆ thinner padding */
  z-index: 9999;
  box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.05);
}

/* ðŸ”¹ Nav items (slimmer text + less spacing) */
.bottom-nav .nav-item {
  flex: 1;
  text-align: center;
  color: var(--nav-text);
  text-decoration: none;
  font-size: 10px; /* ðŸ‘ˆ smaller text */
  position: relative;
  padding: 4px 0; /* ðŸ‘ˆ less padding */
  transition: all 0.3s ease;
}

/* ðŸ”¹ Icon (reduced size + gap) */
.bottom-nav .nav-item i {
  font-size: 18px; /* ðŸ‘ˆ smaller icons (was 22px) */
  display: block;
  opacity: 0.75;
  margin-bottom: 2px; /* ðŸ‘ˆ smaller gap */
  transition: all 0.3s ease;
}

/* ðŸ”¹ Text */
.bottom-nav .nav-item span {
  opacity: 0.7;
  transition: all 0.3s ease;
}

/* ðŸ”¹ Divider lines */
.bottom-nav .nav-item:not(:last-child)::after {
  content: "";
  position: absolute;
  right: 0;
  top: 25%;
  width: 1px;
  height: 50%;
  background: var(--nav-border);
}

/* ðŸ”¹ Active State (icons glow thoda soft) */
.bottom-nav .nav-item.active i {
  transform: scale(1.1);
  opacity: 1;
  animation: bulbGlow 1.6s ease-in-out infinite alternate;
}
.bottom-nav .nav-item.active span {
  opacity: 1;
  font-weight: 600;
}

/* Active colors */
.bottom-nav .nav-item:nth-child(1).active i { color: #00c853; }
.bottom-nav .nav-item:nth-child(2).active i { color: #ffc107; }
.bottom-nav .nav-item:nth-child(3).active i { color: #ff3b30; }
.bottom-nav .nav-item:nth-child(4).active i { color: #00bcd4; }

@keyframes bulbGlow {
  from { filter: brightness(1); }
  to { filter: brightness(1.6); }
}

/* ðŸ”¹ Ripple (same) */
.ripple {
  position: absolute;
  border-radius: 50%;
  transform: scale(0);
  animation: ripple 0.6s linear;
  background: rgba(0, 200, 83, 0.15);
}
@keyframes ripple {
  to { transform: scale(3); opacity: 0; }
}

/* ðŸ”¹ Responsive tuning */
@media (max-width: 480px) {
  .bottom-nav .nav-item i {
    font-size: 17px;
  }
  .bottom-nav .nav-item span {
    font-size: 9.5px;
  }
}
/* ðŸ”„ Share button animation */
.btn-share {
  position: relative;
  overflow: hidden;
}

.btn-share.loading {
  pointer-events: none;
  opacity: 0.8;
}

.btn-share.loading::after {
  content: "Sharing...";
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.6);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

</style>
</head>
<body>
<div class="header">My Referrals</div>


<div class="container">
  <div class="card">
    
    <div class="team-grid">
      <div class="team-box"><span class="label">Level 1</span><span id="teamLv1" class="value">0</span></div>
      <div class="team-box"><span class="label">Level 2</span><span id="teamLv2" class="value">0</span></div>
      <div class="team-box"><span class="label">Level 3</span><span id="teamLv3" class="value">0</span></div>
      <div class="team-box total"><span class="label">Total</span><span id="teamTotal" class="value">0</span></div>
    </div>
  </div>
<!-- âœ… Popup Notification -->
<div id="tdPopup" class="td-popup"></div>

  <div class="card referral-card">
    <b>Your link:</b>
    <div id="refLink" class="referral-link">Loading referral link...</div>
    <div id="qrcode-wrapper"><div id="qrcode"></div></div>
    <div class="btn-row">
      <button class="btn btn-copy" onclick="copyReferral()">Copy Link</button>
      <button class="btn btn-share" onclick="shareReferral()">Share Link</button>
    </div>
  </div>

<!-- ðŸŒŸ Top Level Navigation -->
<div class="top-level-nav">
  <button class="level-tab active" onclick="showLevel(1)">Level 1</button>
  <button class="level-tab" onclick="showLevel(2)">Level 2</button>
  <button class="level-tab" onclick="showLevel(3)">Level 3</button>
</div>

  <div id="level1" class="level-content active">
    <h3>Earning: <b id="level1Earning">$0</b></h3>
    <div class="search-bar">
      <input type="text" id="searchLv1" placeholder="Search member by name...">
      <button onclick="searchLevel(1)">Search</button>
    </div>
    <div id="level1List" class="scrollable-list"></div>
  </div>

  <div id="level2" class="level-content">
    <h3>Earning: <b id="level2Earning">$0</b></h3>
    <div class="search-bar">
      <input type="text" id="searchLv2" placeholder="Search member by name...">
      <button onclick="searchLevel(2)">Search</button>
    </div>
    <div id="level2List" class="scrollable-list"></div>
  </div>

  <div id="level3" class="level-content">
    <h3>Earning: <b id="level3Earning">$0</b></h3>
    <div class="search-bar">
      <input type="text" id="searchLv3" placeholder="Search member by name...">
      <button onclick="searchLevel(3)">Search</button>
    </div>
    <div id="level3List" class="scrollable-list"></div>
  </div>
</div>






<!-- âœ… HTML Navbar -->
<div class="bottom-nav" id="mainNav">
  <a href="Dashboard.html" class="nav-item">
    <i class="ri-home-5-fill"></i>
    <span>Home</span>
  </a>

  <a href="mining.html" class="nav-item">
    <i class="ri-bar-chart-2-fill"></i>
    <span>Mining</span>
  </a>

  <a href="promotion.html" class="nav-item">
    <i class="ri-gift-fill"></i>
    <span>Promotion</span>
  </a>

  <a href="account.html" class="nav-item">
    <i class="ri-user-3-fill"></i>
    <span>Account</span>
  </a>
</div>




<div id="popup" class="popup"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
  getFirestore, collection, query, where, onSnapshot, 
  doc, getDoc, getDocs 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

import { 
  getAuth, onAuthStateChanged 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

// âš¡ SMART CACHE SYSTEM
function saveCache(key, data) {
  localStorage.setItem(key, JSON.stringify({
    data,
    time: Date.now()
  }));
}

function loadCache(key, expiryMinutes = 10) {
  let cached = localStorage.getItem(key);
  if (!cached) return null;

  cached = JSON.parse(cached);
  const age = (Date.now() - cached.time) / (1000 * 60);

  if (age > expiryMinutes) return null;

  return cached.data;
}

const firebaseConfig = {
  apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
  authDomain: "btcinvest-c0e25.firebaseapp.com",
  projectId: "btcinvest-c0e25",
  storageBucket: "btcinvest-c0e25.firebasestorage.app",
  messagingSenderId: "204937458487",
  appId: "1:204937458487:web:cc27ece1249999279f60b2",
  measurementId: "G-HG0Q8ZHT6G"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// ðŸ”„ Switch Level Tabs (top nav buttons)
window.showLevel = function(level) {
  document.querySelectorAll(".level-tab").forEach(btn => btn.classList.remove("active"));
  document.querySelector(`.level-tab:nth-child(${level})`).classList.add("active");

  document.querySelectorAll(".level-content").forEach(c => c.classList.remove("active"));
  document.getElementById(`level${level}`).classList.add("active");
};

window.searchLevel = function(level){
  const val=document.getElementById(`searchLv${level}`).value.toLowerCase();
  const table=document.querySelector(`#level${level}List table`);
  if(!table)return;
  const rows=table.getElementsByTagName("tr");
  for(let i=1;i<rows.length;i++){
    const td=rows[i].getElementsByTagName("td")[0];
    if(td){
      const name=td.textContent||td.innerText;
      rows[i].style.display=name.toLowerCase().includes(val)?"":"none";
    }
  }
};

// hybrid + team counts
function hybridLevelSystem(currentUser, level){
  const membersMap={};
  let q;
  if(level===1) q=query(collection(db,"users"),where("referredBy","==",currentUser.referralCode));
  else if(level===2) q=query(collection(db,"users"),where("upline2","==",currentUser.uid));
  else if(level===3) q=query(collection(db,"users"),where("upline3","==",currentUser.uid));

  onSnapshot(q,s=>{
    s.forEach(docSnap=>{
      const d=docSnap.data();
      membersMap[d.uid||docSnap.id]={name:d.name||"Unnamed",lifetimeDeposit:(d.totalInvested||d.lifetimeDeposit||0),totalInvested:d.totalInvested||0};
    });
    renderHybrid(level,membersMap);
  });

  const cq=query(collection(db,"users",currentUser.uid,"commissions"),where("level","==",level));
  onSnapshot(cq,async snap=>{
    for(const docSnap of snap.docs){
      const c=docSnap.data();let name="Unknown",active=false;
      try{
        const downSnap=await getDoc(doc(db,"users",c.fromUser));
        if(downSnap.exists()){
          const d=downSnap.data();name=d.name||"Unnamed";active=(d.totalInvested||d.lifetimeDeposit||0)>0;
        }
      }catch{}
      membersMap[c.fromUser]={name,lifetimeDeposit:active?1:0,totalInvested:(membersMap[c.fromUser]?.totalInvested||0)+parseFloat(c.amount||0)};
    }
    renderHybrid(level,membersMap);
  });
}

function renderHybrid(level,map){
  const members=Object.values(map);
  const c=document.getElementById(`level${level}List`);
  if(!members.length){c.innerHTML="<em>No users found</em>";return;}
  let total=0;members.forEach(m=>total+=m.totalInvested);
  document.getElementById(`level${level}Earning`).textContent="$"+total.toFixed(2);
  c.innerHTML=`<table class="user-table"><thead><tr><th>Name</th><th>Status</th><th>Received</th></tr></thead><tbody>${
    members.map(u=>`<tr><td>${u.name}</td><td>${u.lifetimeDeposit>0?"<span class='status-active'>Active</span>":"<span class='status-inactive'>Inactive</span>"}</td><td>$${(u.totalInvested||0).toFixed(2)}</td></tr>`).join("")
  }</tbody></table>`;
}


// QR CODE KA HAI YE 
// âš¡ FAST + CACHED AUTH SYSTEM
onAuthStateChanged(auth, async user => {
  if (!user) return (window.location.href = "login.html");

  // STEP 1 â†’ Cache Try
  let cachedUser = loadCache("USER_" + user.uid);
  if (cachedUser) {
    loadUserUI(cachedUser, user.uid);  // UI instantly load
  }

  // STEP 2 â†’ Fresh DB Fetch
  const snap = await getDoc(doc(db, "users", user.uid));
  if (!snap.exists()) return;

  const currentUser = { ...snap.data(), uid: user.uid };

  // STEP 3 â†’ Save Cache
  saveCache("USER_" + user.uid, currentUser);

  // STEP 4 â†’ Update UI
  loadUserUI(currentUser, user.uid);

  // â¬‡ï¸â¬‡ï¸â¬‡ï¸ MOVE YOUR TEAM REFERRAL CODE **INSIDE HERE** â¬‡ï¸â¬‡ï¸â¬‡ï¸

  const ref1 = query(collection(db, "users"), where("referredBy", "==", currentUser.referralCode));
  const ref2 = query(collection(db, "users"), where("upline2", "==", user.uid));
  const ref3 = query(collection(db, "users"), where("upline3", "==", user.uid));

  let lv1 = 0, lv2 = 0, lv3 = 0;

  const updateCounts = () => {
    document.getElementById("teamLv1").textContent = lv1;
    document.getElementById("teamLv2").textContent = lv2;
    document.getElementById("teamLv3").textContent = lv3;
    document.getElementById("teamTotal").textContent = lv1 + lv2 + lv3;
  };

  onSnapshot(ref1, s => { lv1 = s.size; updateCounts(); });
  onSnapshot(ref2, s => { lv2 = s.size; updateCounts(); });
  onSnapshot(ref3, s => { lv3 = s.size; updateCounts(); });

  ["1", "2", "3"].forEach(lv => hybridLevelSystem(currentUser, parseInt(lv)));

});

// âœ… Copy & Share Referral Functions

function getInviteMessage(refLink) {
  return `ðŸ” TrusTDollar

The worldâ€™s first secure, reliable, and fully transparent TrusTDollar Mining platform ðŸŒâš¡

Earn up to 1%-2% daily income through TrusTDollar mining with a 100% secure and fully automated system.

ðŸ’¼ Key Features:
âœ… Stable daily returns âœ…
âœ… All wallet withdrawals âœ…
âœ… Minimum withdrawal from $20 max 40k âœ…
âœ… Fully secure  system âœ…

 Register today and start earning!

ðŸ‘‰ Register Now:ðŸ‘‡
${refLink}`;
}

// ðŸ“‹ COPY (Text + Link)
window.copyReferral = function () {
  const refLink = document.getElementById("refLink").innerText;

  if (!refLink || refLink.includes("Loading")) {
    showPopup("Referral link not ready yet!", "#ff3b30");
    return;
  }

  const fullMessage = getInviteMessage(refLink);

  navigator.clipboard.writeText(fullMessage).then(() => {
    // ðŸ“³ haptic feedback (mobile only)
    if (navigator.vibrate) navigator.vibrate(30);
    showPopup("Invite message copied successfully!");
  }).catch(() => {
    showPopup("Copy failed!", "#ff3b30");
  });


// ðŸ“¤ SHARE (Text + Link)
window.shareReferral = function () {
  const refLink = document.getElementById("refLink").innerText;
  const btn = document.querySelector(".btn-share");

  if (!refLink || refLink.includes("Loading")) {
    showPopup("Referral link not ready yet!", "#ff3b30");
    return;
  }

  const fullMessage = getInviteMessage(refLink);
  // ðŸ”„ animation start
  btn.classList.add("loading");

  if (navigator.share) {
    navigator.share({
      title: "TrustDollar Invite",
      text: fullMessage
    }).then(() => {
      if (navigator.vibrate) navigator.vibrate(40);
      showPopup("Invite ready to share!");
    }).catch(() => {
      showPopup("Share cancelled", "#ffc107");
    }).finally(() => {
      btn.classList.remove("loading");
    });
  } else {
    btn.classList.remove("loading");
    showPopup("Sharing not supported", "#ff3b30");
  }
};

  // ðŸ”„ animation start
  btn.classList.add("loading");

  shareInvite(refLink);

  // â±ï¸ animation end
  setTimeout(() => {
    btn.classList.remove("loading");
  }, 1500);
};


function shareInvite(refLink) {
  const fullMessage = `ðŸ” TrusTDollar

The worldâ€™s first secure, reliable, and fully transparent TrusTDollar Mining platform ðŸŒâš¡

Earn up to 1%-2% daily income through TrusTDollar mining with a 100% secure and fully automated system.

ðŸ’¼ Key Features:
âœ… Stable daily returns
âœ… All wallet withdrawals
âœ… Minimum withdrawal from $20 max 40k
âœ… Fully secure  system

ðŸš€ Register today and start earning!

ðŸ‘‰ Register Now:ðŸ‘‡
${refLink}`;

  if (navigator.share) {
    navigator.share({
      title: "TrustDollar Invite",
      text: fullMessage
    }).catch(() => {
      showPopup("Share cancelled", "#ffc107");
    });
  } else {
    showPopup("Sharing not supported", "#ff3b30");
  }
}




// puip up ke liey hai 
// ðŸŒ¿ TrustDollar Popup Function
function showPopup(message, color = "#00c853") {
  const popup = document.getElementById("tdPopup");
  popup.style.background = color;
  popup.innerText = message;
  popup.classList.add("show");
  setTimeout(() => popup.classList.remove("show"), 2000);
}

</script>
<script>
let lastScroll = 0;
const header = document.querySelector(".header");
const topNav = document.querySelector(".top-level-nav");

window.addEventListener("scroll", () => {
  const currentScroll = window.pageYOffset;

  if (currentScroll > lastScroll && currentScroll > 100) {
    // ðŸ‘‡ Scroll down â†’ hide
    header.classList.add("hide");
    topNav.classList.add("hide");
  } else {
    // ðŸ‘† Scroll up â†’ show
    header.classList.remove("hide");
    topNav.classList.remove("hide");
  }

  lastScroll = currentScroll;
});
</script>
<script>
// ðŸ§© Team box click â†’ hide
document.querySelectorAll(".team-box").forEach(box => {
  box.addEventListener("click", () => {
    box.classList.add("hide");
    setTimeout(() => {
      box.style.display = "none";
    }, 300); // animation ke baad hide karna
  });
});
</script>

<script>
// â³ Auto Logout After 5 Hours Inactivity

const AUTO_LOGOUT_TIME = 5 * 60 * 60 * 1000; // 5 hours

let lastActivity = Date.now();

// User activity detect
function updateActivity() {
  lastActivity = Date.now();
}
document.addEventListener("click", updateActivity);
document.addEventListener("mousemove", updateActivity);
document.addEventListener("keydown", updateActivity);

// Check inactivity every 20 seconds
setInterval(() => {
  if (Date.now() - lastActivity > AUTO_LOGOUT_TIME) {
    localStorage.setItem("logoutReason", "expired");
    window.location.href = "index.html"; // redirect
  }
}, 20000);
</script>

<script>
/* ðŸŒ— Auto theme detect */
function detectTheme() {
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  document.documentElement.setAttribute("data-theme", prefersDark ? "dark" : "light");
}
detectTheme();
window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", detectTheme);

/* ðŸ’¡ Auto highlight based on page URL */
const currentPage = window.location.pathname.split("/").pop().toLowerCase();
document.querySelectorAll(".bottom-nav .nav-item").forEach(item => {
  const href = item.getAttribute("href")?.toLowerCase();
  if (currentPage === href) item.classList.add("active");
});

/* ðŸŒŠ Ripple effect + manual highlight */
document.querySelectorAll(".bottom-nav .nav-item").forEach((item) => {
  item.addEventListener("click", (e) => {
    // highlight
    document.querySelector(".bottom-nav .nav-item.active")?.classList.remove("active");
    item.classList.add("active");

    // ripple
    const ripple = document.createElement("span");
    ripple.classList.add("ripple");
    const rect = item.getBoundingClientRect();
    ripple.style.left = `${e.clientX - rect.left}px`;
    ripple.style.top = `${e.clientY - rect.top}px`;
    item.appendChild(ripple);
    setTimeout(() => ripple.remove(), 500);
  });
});



// -------------------------------
// ðŸ”¥ REWARD COMPETITION BOX SYSTEM
// -------------------------------
async function loadRewardCompetitions(userUID) {
const rewardRef = collection(db, "users", userUID, "RewardCompetition");

    const rewardSnap = await getDocs(rewardRef);

    if (rewardSnap.empty) {
        console.log("No reward competitions.");
        return;
    }

    rewardSnap.forEach(async (pkg) => {
        const data = pkg.data();

        let packageSize = parseInt(data.package);
        let income = parseFloat(data.income.replace("$", ""));
        let totalDays = parseInt(data.day);
        let createdAt = new Date(data.createdAt);
        let today = new Date();

        let daysPassed = Math.floor((today - createdAt) / (1000 * 60 * 60 * 24));
        if (daysPassed < 0) daysPassed = 0;

        let daysRemaining = totalDays - daysPassed;
        if (daysRemaining < 0) daysRemaining = 0;

        // ðŸ”¢ FORMULAS
        let perMember = income / packageSize;
        let activeCredit = perMember * 0.66; // 66% like your example

        // MEMBERS JO CREATED DATE KE BAAD AAYE
        const membersRef = query(
            collection(db, "users"),
            where("referredBy", "==", data.email)
        );

        const membersSnap = await getDocs(membersRef);

        let memberList = [];
        let activeMembers = 0;

        membersSnap.forEach((m) => {
            const md = m.data();
            let joinedDate = new Date(md.createdAt || md.joinedAt || today);

            if (joinedDate >= createdAt) {
                let isActive = (md.totalInvested || 0) > 0;

                if (isActive) activeMembers++;

                memberList.push({
                    name: md.name,
                    active: isActive,
                    credit: isActive ? activeCredit : 0
                });
            }
        });

        let earned = activeMembers * activeCredit;
        let pending = income - earned;
        if (pending < 0) pending = 0;

        let progressPercent = (daysPassed / totalDays) * 100;
        if (progressPercent > 100) progressPercent = 100;

        // -------------------------------
        // ðŸ”¥ UI BOX CREATE
        // -------------------------------
        const container = document.querySelector(".container");

        let box = document.createElement("div");
        box.className = "card";
        box.style.padding = "15px";
        box.style.marginTop = "15px";

        box.innerHTML = `
            <div style="font-weight:700;font-size:18px;margin-bottom:6px;">
                ${packageSize} Users Package 
                <span style="color:${activeMembers > 0 ? 'green':'red'};font-size:14px;">
                    ${activeMembers > 0 ? "Active" : "Inactive"}
                </span>
            </div>

            <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                <div>Fee: ${data.fee}</div>
                <div>Commission: ${data.commission}</div>
            </div>

            <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
                <div>Income: ${data.income}</div>
                <div>Days: ${data.day}</div>
            </div>

            <hr style="margin:8px 0;">

            <div><b>Members joined after (${createdAt.toDateString()}):</b></div>

            <div style="margin-top:6px;">
                ${memberList.length === 0 ? "<i>No members yet</i>":""}
                ${memberList.map(m=>`
                    <div style="margin:3px 0;">
                        - ${m.name} â†’ 
                        <span style="color:${m.active?'green':'red'}">
                            ${m.active ? 'Active' : 'Inactive'}
                        </span>
                        ${m.active ? `â†’ $${m.credit.toFixed(2)}` : ""}
                    </div>
                `).join("")}
            </div>

            <hr style="margin:8px 0;">

            <div style="font-size:15px;">
                Earned: <b>$${earned.toFixed(2)}</b> <br>
                Pending: <b>$${pending.toFixed(2)}</b>
            </div>

            <div style="margin-top:10px;">${daysRemaining} days remaining</div>

            <div style="
                width:100%; 
                height:10px; 
                background:#ddd; 
                border-radius:5px;
                margin-top:5px;
            ">
                <div style="
                    width:${progressPercent}%; 
                    height:100%; 
                    background:#22c55e; 
                    border-radius:5px;
                "></div>
            </div>

            <hr style="margin-top:10px;">
        `;

        container.appendChild(box);
    });
}


function loadUserUI(data, uid) {
  const refCode = data.referralCode || uid;
  const finalRefLink = `https://smartfundad.com/index.html?ref=${refCode}`;

  document.getElementById("refLink").textContent = finalRefLink;

  // QR reset
  document.getElementById("qrcode").innerHTML = "";
  new QRCode(document.getElementById("qrcode"), {
      text: finalRefLink,
      width: 120,
      height: 120,
      colorDark: "#000000",
      colorLight: "#ffffff",
      correctLevel: QRCode.CorrectLevel.H
  });
}


</script>


</body>
</html>
