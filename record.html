<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Record â€” TrustDollar</title>
  <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #f9fafb;
      margin: 0;
      padding: 16px;
      color: #0f172a;
    }
    .card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 18px;
      margin-bottom: 18px;
      width: 100%;
      max-width: 900px;
      margin-inline: auto;
      box-sizing: border-box;
    }
    h2 {
      color: #065f46;
      margin-bottom: 10px;
      border-bottom: 2px solid #bbf7d0;
      display: inline-block;
      padding-bottom: 4px;
      font-size: 1.1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.9rem;
    }
    th, td {
      padding: 8px 6px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
    }
    th {
      background: #d1fae5;
      color: #065f46;
      font-weight: 600;
    }
    .highlight {
      color: #16a34a;
      font-weight: 600;
    }
    .totals {
      background: #ecfdf5;
      border: 1px solid #bbf7d0;
      border-radius: 10px;
      padding: 8px;
      margin-top: 8px;
      font-weight: 600;
    }
    /* User Overview Card Layout */
.user-info-row {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
  border-bottom: 1px solid #e5e7eb;
}

.user-info-row:last-child {
  border-bottom: none;
}

.user-info-label {
  font-weight: 600;
  color: #0f172a;
}

.user-info-value {
  font-weight: 600;
  color: #16a34a;
  text-align: right;
}

.user-title-center {
  text-align: center;
  width: 100%;
  border-bottom: 2px solid #bbf7d0;
  padding-bottom: 5px;
  margin-bottom: 12px;
}

  </style>
</head>

<body>
<!-- ðŸ“¢ Announcement Section -->
<div class="announcement-section">
  <h3 class="section-title">
    <i class='bx bxs-megaphone'></i> Latest Announcement
  </h3>
  <div id="announcementBox" class="announcement-box">
    <p style="text-align:center; color:#666;">Loading announcement...</p>
  </div>
</div>

<style>
/* ðŸ“¢ Clean Announcement Section */
.announcement-section {
  margin: 25px 0;
  padding: 10px;
  border-radius: 12px;
}

.section-title {
  color: #065f46;
  font-weight: 700;
  font-size: 18px;
  display: flex;
  align-items: center;
  gap: 8px;
  border-bottom: 2px solid #16a34a;
  padding-bottom: 6px;
  margin-bottom: 10px;
}

.announcement-box {
  border: 1.8px solid #16a34a; /* âœ… only border */
  border-radius: 12px;
  padding: 14px 16px;
  color: #064e3b;
  background: white;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

.announcement-title {
  font-weight: 700;
  font-size: 16px;
  color: #065f46;
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 6px;
}

.announcement-message {
  font-size: 14px;
  line-height: 1.6;
  color: #083344;
  margin-bottom: 8px;
  word-break: break-word;
}

.announcement-footer {
  font-size: 13px;
  color: #047857;
  text-align: right;
  border-top: 1px dashed #86efac;
  padding-top: 5px;
}

/* ðŸ“± Mobile Responsive */
@media (max-width: 600px) {
  .section-title {
    font-size: 16px;
  }
  .announcement-box {
    padding: 12px;
  }
  .announcement-title {
    font-size: 15px;
  }
  .announcement-message {
    font-size: 13.5px;
  }
}


</style>

<div class="card">
  <h2 class="user-title-center">User Overview</h2>

  <div class="user-info-row">
    <span class="user-info-label">Username:</span>
    <span class="user-info-value" id="username">Loading...</span>
  </div>

  <div class="user-info-row">
    <span class="user-info-label">Email:</span>
    <span class="user-info-value" id="email">Loading...</span>
  </div>

  <div class="user-info-row">
    <span class="user-info-label">Wallet Balance:</span>
    <span class="user-info-value" id="walletBalance">$0.00</span>
  </div>

  <div class="user-info-row">
    <span class="user-info-label">Locked Balance:</span>
    <span class="user-info-value" id="lockedBalance">$0.00</span>
  </div>

  <div class="user-info-row">
    <span class="user-info-label">Total Earned:</span>
    <span class="user-info-value" id="totalIncome">$0.00</span>
  </div>

  <div class="user-info-row">
    <span class="user-info-label">Total Referral Income:</span>
    <span class="user-info-value" id="referralIncome">$0.00</span>
  </div>

  <div class="user-info-row">
    <span class="user-info-label">Mining Amount:</span>
    <span class="user-info-value" id="miningAmount">$0.00</span>
  </div>
</div>


  <!-- âœ… Investments -->
  <div class="card">
    <h2>Investments</h2>
    <div id="investmentTable">Loading investments...</div>
    <div class="totals">Total Invested: <span id="totalInvested">$0.00</span></div>
  </div>

  <!-- âœ… Referral -->
  <div class="card">
    <h2>Referral History</h2>
    <div id="referralHistory">Loading referral records...</div>
  </div>

  <!-- âœ… Deposits -->
  <div class="card">
    <h2>Deposits</h2>
    <div id="depositHistory">Loading deposits...</div>
    <div class="totals">Total Deposits: <span id="depositTotal">$0.00</span></div>
  </div>

  <!-- âœ… Withdrawals -->
  <div class="card">
    <h2>Withdrawals</h2>
    <div id="withdrawHistory">Loading withdrawals...</div>
    <div class="totals">Total Withdrawals: <span id="withdrawTotal">$0.00</span></div>
  </div>


  <!-- âœ… BTCInvest Auto Smart Bottom Navbar -->
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet">

<style>
:root {
  --nav-bg: #fff;
  --nav-text: #444;
  --nav-border: rgba(0, 0, 0, 0.08);
}

[data-theme="dark"] {
  --nav-bg: #0f0f0f;
  --nav-text: #ccc;
  --nav-border: rgba(255, 255, 255, 0.1);
}

/* ðŸ”¹ Navbar Base (height reduced) */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: var(--nav-bg);
  border-top: 1px solid var(--nav-border);
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 10px 0; /* ðŸ‘ˆ thinner padding */
  z-index: 9999;
  box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.05);
}

/* ðŸ”¹ Nav items (slimmer text + less spacing) */
.bottom-nav .nav-item {
  flex: 1;
  text-align: center;
  color: var(--nav-text);
  text-decoration: none;
  font-size: 10px; /* ðŸ‘ˆ smaller text */
  position: relative;
  padding: 4px 0; /* ðŸ‘ˆ less padding */
  transition: all 0.3s ease;
}

/* ðŸ”¹ Icon (reduced size + gap) */
.bottom-nav .nav-item i {
  font-size: 18px; /* ðŸ‘ˆ smaller icons (was 22px) */
  display: block;
  opacity: 0.75;
  margin-bottom: 2px; /* ðŸ‘ˆ smaller gap */
  transition: all 0.3s ease;
}

/* ðŸ”¹ Text */
.bottom-nav .nav-item span {
  opacity: 0.7;
  transition: all 0.3s ease;
}

/* ðŸ”¹ Divider lines */
.bottom-nav .nav-item:not(:last-child)::after {
  content: "";
  position: absolute;
  right: 0;
  top: 25%;
  width: 1px;
  height: 50%;
  background: var(--nav-border);
}

/* ðŸ”¹ Active State (icons glow thoda soft) */
.bottom-nav .nav-item.active i {
  transform: scale(1.1);
  opacity: 1;
  animation: bulbGlow 1.6s ease-in-out infinite alternate;
}
.bottom-nav .nav-item.active span {
  opacity: 1;
  font-weight: 600;
}

/* Active colors */
.bottom-nav .nav-item:nth-child(1).active i { color: #00c853; }
.bottom-nav .nav-item:nth-child(2).active i { color: #ffc107; }
.bottom-nav .nav-item:nth-child(3).active i { color: #ff3b30; }
.bottom-nav .nav-item:nth-child(4).active i { color: #00bcd4; }

@keyframes bulbGlow {
  from { filter: brightness(1); }
  to { filter: brightness(1.6); }
}

/* ðŸ”¹ Ripple (same) */
.ripple {
  position: absolute;
  border-radius: 50%;
  transform: scale(0);
  animation: ripple 0.6s linear;
  background: rgba(0, 200, 83, 0.15);
}
@keyframes ripple {
  to { transform: scale(3); opacity: 0; }
}

/* ðŸ”¹ Responsive tuning */
@media (max-width: 480px) {
  .bottom-nav .nav-item i {
    font-size: 17px;
  }
  .bottom-nav .nav-item span {
    font-size: 9.5px;
  }
}
</style>

<!-- âœ… HTML Navbar -->
<div class="bottom-nav" id="mainNav">
  <a href="Dashboard.html" class="nav-item">
    <i class="ri-home-5-fill"></i>
    <span>Home</span>
  </a>

  <a href="mining.html" class="nav-item">
    <i class="ri-bar-chart-2-fill"></i>
    <span>Mining</span>
  </a>

  <a href="promotion.html" class="nav-item">
    <i class="ri-gift-fill"></i>
    <span>Promotion</span>
  </a>

  <a href="account.html" class="nav-item">
    <i class="ri-user-3-fill"></i>
    <span>Account</span>
  </a>
</div>

<script>
/* ðŸŒ— Auto theme detect */
function detectTheme() {
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  document.documentElement.setAttribute("data-theme", prefersDark ? "dark" : "light");
}
detectTheme();
window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", detectTheme);

/* ðŸ’¡ Auto highlight based on page URL */
const currentPage = window.location.pathname.split("/").pop().toLowerCase();
document.querySelectorAll(".bottom-nav .nav-item").forEach(item => {
  const href = item.getAttribute("href")?.toLowerCase();
  if (currentPage === href) item.classList.add("active");
});

/* ðŸŒŠ Ripple effect + manual highlight */
document.querySelectorAll(".bottom-nav .nav-item").forEach((item) => {
  item.addEventListener("click", (e) => {
    // highlight
    document.querySelector(".bottom-nav .nav-item.active")?.classList.remove("active");
    item.classList.add("active");

    // ripple
    const ripple = document.createElement("span");
    ripple.classList.add("ripple");
    const rect = item.getBoundingClientRect();
    ripple.style.left = `${e.clientX - rect.left}px`;
    ripple.style.top = `${e.clientY - rect.top}px`;
    item.appendChild(ripple);
    setTimeout(() => ripple.remove(), 500);
  });
});
</script>



  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import {
      getFirestore, doc, getDoc, collection, query, getDocs, orderBy, limit, onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";

    // ðŸ”¥ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
      authDomain: "btcinvest-c0e25.firebaseapp.com",
      projectId: "btcinvest-c0e25",
      storageBucket: "btcinvest-c0e25.firebasestorage.app",
      messagingSenderId: "204937458487",
      appId: "1:204937458487:web:cc27ece1249999279f60b2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        alert("Please login first!");
        window.location.href = "login.html";
        return;
      }

      const userRef = doc(db, "users", user.uid);
      const userSnap = await getDoc(userRef);
      if (!userSnap.exists()) return alert("User not found!");

      const u = userSnap.data();
      document.getElementById("username").textContent = u.username || "Unknown";
      document.getElementById("email").textContent = user.email;
      document.getElementById("walletBalance").textContent = `$${(u.walletBalance || 0).toFixed(2)}`;
      document.getElementById("lockedBalance").textContent = `$${(u.lockedBalance || 0).toFixed(2)}`;
      document.getElementById("totalIncome").textContent = `$${(u.totalIncome || 0).toFixed(2)}`;
      document.getElementById("miningAmount").textContent = `$${(u.miningAmount || 0).toFixed(2)}`;

      loadInvestments(user.uid);
      loadReferralHistory(user.uid);
      loadDeposits(user.uid);
      loadWithdrawals(user.uid);
      calculateReferralTotal(user.uid);
      loadAnnouncement(); // âœ… call announcement loader
    });

   async function loadAnnouncement() {
  const box = document.getElementById("announcementBox");
  const q = query(collection(db, "announcements"), orderBy("timestamp", "desc"), limit(1));
  const res = await getDocs(q);

  if (res.empty) {
    box.innerHTML = `<p style="text-align:center;color:#666;">No announcements yet.</p>`;
    return;
  }

  res.forEach(docSnap => {
    const d = docSnap.data();
    const date = d.timestamp?.toDate?.()?.toLocaleString() || "N/A";
    box.innerHTML = `
      <div class="announcement-title">
        <i class='bx bxs-megaphone'></i> ${d.title}
      </div>
      <div class="announcement-message">
        ${d.message}
      </div>
      <div class="announcement-footer">
        â€” ${d.adminName || "Admin"} | ${date}
      </div>
    `;
  });
}

// ðŸ”„ Auto call announcement loader
loadAnnouncement(); // âœ… correct


    // ðŸ§¾ Investments
    async function loadInvestments(uid) {
      const q = query(collection(db, "buyhashrate"), orderBy("startTime", "desc"));
      const snapshot = await getDocs(q);
      let html = "", totalInvested = 0;
      snapshot.forEach(docSnap => {
        const d = docSnap.data();
        if (d.userId === uid) {
          totalInvested += d.planCost || 0;
          html += `<tr><td>${d.planName}</td><td>$${d.planCost}</td><td>${d.dailyProfitPercent}%</td><td>${d.status}</td><td>$${(d.earnedProfit || 0).toFixed(2)}</td></tr>`;
        }
      });
      if (!html) html = `<tr><td colspan="5">No investments found.</td></tr>`;
      document.getElementById("investmentTable").innerHTML = `
        <table><thead><tr><th>Plan</th><th>Cost</th><th>Daily %</th><th>Status</th><th>Earned</th></tr></thead><tbody>${html}</tbody></table>`;
      document.getElementById("totalInvested").textContent = `$${totalInvested.toFixed(2)}`;
    }

    // ðŸ‘¥ Referral Subcollection
    async function loadReferralHistory(uid) {
      const q = query(collection(db, "users", uid, "buyhashrefarl"), orderBy("timestamp", "desc"));
      const snapshot = await getDocs(q);
      if (snapshot.empty) {
        document.getElementById("referralHistory").innerHTML = "<p>No referral history.</p>";
        return;
      }
      let html = "";
      snapshot.forEach(docSnap => {
        const d = docSnap.data();
        html += `<tr><td>${d.fromUser}</td><td>${d.level}</td><td>$${(d.amount || 0).toFixed(2)}</td><td>${d.timestamp?.toDate().toLocaleDateString() || "N/A"}</td></tr>`;
      });
      document.getElementById("referralHistory").innerHTML = `
        <table><thead><tr><th>From</th><th>Level</th><th>Amount</th><th>Date</th></tr></thead><tbody>${html}</tbody></table>`;
    }

    // ðŸ’° Referral Total
    async function calculateReferralTotal(uid) {
      const q = query(collection(db, "users", uid, "buyhashrefarl"));
      const snapshot = await getDocs(q);
      let total = 0;
      snapshot.forEach(docSnap => total += docSnap.data().amount || 0);
      document.getElementById("referralIncome").textContent = `$${total.toFixed(2)}`;
    }

    // ðŸ’µ Deposits â€” Lifetime Deposit From User Document
async function loadDeposits(uid) {
  const userRef = doc(db, "users", uid);
  const userSnap = await getDoc(userRef);

  if (!userSnap.exists()) {
    document.getElementById("depositHistory").innerHTML = "<p>No deposits found.</p>";
    document.getElementById("depositTotal").textContent = "$0.00";
    return;
  }

  const u = userSnap.data();

  // Automatic field detection
  const totalLifeDeposit =
    u.lifeTimeDeposit ??
    u.lifetimeDeposit ??
    u.lifeTimedeposit ??
    u.totalDeposit ??
    u.totalDeposits ??
    u.depositTotal ??
    0;

  console.log("Detected Deposit:", totalLifeDeposit);

  document.getElementById("depositHistory").innerHTML = `
    <p style="color:#065f46;font-weight:600">Lifetime Deposit Record Found</p>
  `;

  document.getElementById("depositTotal").textContent =
    `$${Number(totalLifeDeposit).toFixed(2)}`;
}


    // ðŸ’¸ Withdrawals (Subcollection)
    async function loadWithdrawals(uid) {
      const q = query(collection(db, "users", uid, "withdrawals"), orderBy("timestamp", "desc"));
      const snapshot = await getDocs(q);
      if (snapshot.empty) {
        document.getElementById("withdrawHistory").innerHTML = "<p>No withdrawals yet.</p>";
        document.getElementById("withdrawTotal").textContent = "$0.00";
        return;
      }
      let html = "", total = 0;
      snapshot.forEach(docSnap => {
        const d = docSnap.data();
        total += d.amount || 0;
        html += `<tr><td>$${d.amount}</td><td>${d.status || "Pending"}</td><td>${d.timestamp?.toDate().toLocaleDateString() || "N/A"}</td></tr>`;
      });
      document.getElementById("withdrawHistory").innerHTML = `
        <table><thead><tr><th>Amount</th><th>Status</th><th>Date</th></tr></thead><tbody>${html}</tbody></table>`;
      document.getElementById("withdrawTotal").textContent = `$${total.toFixed(2)}`;
    }
  </script>

</body>
</html>
