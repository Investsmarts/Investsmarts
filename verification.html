<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Withdrawal Verification</title>

<style>
*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:#f1f5f9;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:15px;
}

/* Card */
.card{
  width:100%;
  max-width:420px;
  background:white;
  border-radius:16px;
  padding:22px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}

.title{
  text-align:center;
  font-size:18px;
  font-weight:600;
  margin-bottom:18px;
  color:#111827;
}

/* rows */
.info{
  background:#f9fafb;
  border:1px solid #e5e7eb;
  padding:10px 12px;
  border-radius:10px;
  margin-bottom:10px;
}

.label{
  font-size:12px;
  color:#6b7280;
}

.value{
  font-size:14px;
  margin-top:2px;
  word-break:break-all;
  color:#111827;
}

.green{
  color:#16a34a;
  font-weight:600;
}

/* button */
button{
  width:100%;
  margin-top:14px;
  padding:14px;
  border:none;
  border-radius:10px;
  background:#16a34a;
  color:white;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
}

button:active{
  transform:scale(.99);
}

.success{
  display:none;
  text-align:center;
  margin-top:12px;
  color:#16a34a;
  font-weight:600;
}
.success{
  display:none;
  margin-top:12px;
  color:#16a34a;
  font-weight:600;
  text-align:center;
}

</style>
</head>
<script>
function generateLongHash(length = 64) {
    const chars = "EFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    let result = "";

    for (let i = 0; i < length; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
    }

    window.location.hash = result;
}

// Example use
generateLongHash(80); // 80 character hash
</script>

<body>

<div class="card" id="box">

<div class="title">Confirm Withdrawal</div>

<div class="info">
<div class="label">Name</div>
<div class="value" id="name"></div>
</div>

<div class="info">
<div class="label">Email</div>
<div class="value" id="email"></div>
</div>

<div class="info">
<div class="label">Wallet Address</div>
<div class="value green" id="wallet"></div>
</div>

<div class="info">
<div class="label">Amount</div>
<div class="value green">$<span id="amount"></span></div>
</div>

<div class="info">
<div class="label">Order ID</div>
<div class="value" id="orderId"></div>
</div>

<form id="confirmForm"
action="https://formsubmit.co/trustdollarteam@gmail.com"
method="POST">

<input type="hidden" name="name" id="f_name">
<input type="hidden" name="email" id="f_email">
<input type="hidden" name="wallet" id="f_wallet">
<input type="hidden" name="amount" id="f_amount">
<input type="hidden" name="orderId" id="f_order">
<input type="hidden" name="status" value="User Verified Withdrawal">
<input type="hidden" name="_captcha" value="false">

<button type="submit">
Yes, all details are correct
</button>
</form>

<div class="success" id="success">
✔ Verification Sent Successfully
</div>

</div>

<script type="module">
import { initializeApp }
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";

import { getAuth, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

import {
  getFirestore,
  doc,
  getDoc,
  collection,
  query,
  where,
  orderBy,
  limit,
  getDocs
} from
"https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
  authDomain: "btcinvest-c0e25.firebaseapp.com",
  projectId: "btcinvest-c0e25",
  storageBucket: "btcinvest-c0e25.firebasestorage.app",
  messagingSenderId: "204937458487",
  appId: "1:204937458487:web:cc27ece1249999279f60b2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async (user) => {

if(!user){
  document.body.innerHTML =
    "<p style='text-align:center;font-size:18px;font-weight:600;padding:20px;'>Please login first to verify withdrawal.</p>";
  return;
}

const box = document.getElementById("box");
const nameEl = document.getElementById("name");
const emailEl = document.getElementById("email");
const walletEl = document.getElementById("wallet");
const amountEl = document.getElementById("amount");
const orderEl = document.getElementById("orderId");

const f_name = document.getElementById("f_name");
const f_email = document.getElementById("f_email");
const f_wallet = document.getElementById("f_wallet");
const f_amount = document.getElementById("f_amount");
const f_order = document.getElementById("f_order");

/* User profile */
const userDoc = await getDoc(doc(db,"users",user.uid));
const u = userDoc.data() || {};

/* Withdrawal fetch */
const q = query(
  collection(db,"users",user.uid,"withdrawals"),
  where("status","in",["Pending","Processing"]),
  orderBy("date","desc"),
  limit(1)
);

const snap = await getDocs(q);

if(snap.empty){
  box.innerHTML = "<div class='title'>No withdrawal in processing</div>";
  return;
}

const wd = snap.docs[0].data();

/* Fill UI */
nameEl.textContent = u.name || "-";
emailEl.textContent = u.email || "-";
walletEl.textContent = wd.address || "-";
amountEl.textContent = wd.amount || "0";
orderEl.textContent = wd.orderId || "-";

/* Fill form */
f_name.value = u.name || "";
f_email.value = u.email || "";
f_wallet.value = wd.address || "";
f_amount.value = wd.amount || "";
f_order.value = wd.orderId || "";

});

/* Submit handling */
const confirmForm = document.getElementById("confirmForm");
const success = document.getElementById("success");

confirmForm.addEventListener("submit", e=>{
  e.preventDefault();

  success.innerHTML = "✔ Your withdrawal verification successful";
success.style.display = "block";
success.style.textAlign = "center";

/* Hide after 2 sec */
setTimeout(()=>{
  success.style.display = "none";
},2000);

/* Redirect after hide */
setTimeout(()=>{
  window.location.href = "https://smartfundad.com";
},2100);

</script>


</body>
</html>
