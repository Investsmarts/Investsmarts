<!-- ‚úÖ Add Wallet Address Section -->
<div class="popup-multiple">
  <h2>Add Wallet Address</h2>
  <div class="info-box">
    You can add up to <b>20 wallet addresses</b> here to avoid delays during withdrawals.
  </div>

  <label>Wallet App</label>
  <div class="dropdown-container">
    <div class="dropdown-btn">Select Wallet</div>
    <div class="dropdown-list" id="dropdownList">
      <div class="dropdown-top">
        <input type="text" id="walletSearch" placeholder="Search wallet...">
        <button id="searchBtn">üîç</button>
      </div>
      <ul id="walletOptions">
        <li>MetaMask</li><li>Trust Wallet</li><li>Binance Wallet</li>
        <li>OKX Wallet</li><li>Coinbase Wallet</li><li>Phantom Wallet</li>
        <li>Kraken Wallet</li><li>Gemini Wallet</li><li>Ledger Live</li>
        <li>Trezor Wallet</li><li>Exodus Wallet</li><li>Atomic Wallet</li>
        <li>BitGo Wallet</li><li>Math Wallet</li><li>TokenPocket</li>
        <li>Zerion Wallet</li><li>Rainbow Wallet</li><li>SafePal</li>
        <li>Ellipal Wallet</li><li>Other</li>
      </ul>
    </div>
  </div>

  <label>BEP20 Wallet Address</label>
  <input type="text" id="walletAddress" placeholder="Paste BEP20 address here">

  <div class="action-buttons">
    <button id="addBtn">‚ûï Add Address</button>
  </div>
</div>

<div id="message"></div>

<script type="module">
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const auth = getAuth();
  const db = getFirestore();

  let currentUserId = null;
  let selectedWallet = "";
  const msg = document.getElementById("message");
  const dropdownBtn = document.querySelector(".dropdown-btn");
  const dropdownList = document.getElementById("dropdownList");
  const searchInput = document.getElementById("walletSearch");
  const searchBtn = document.getElementById("searchBtn");
  const addBtn = document.getElementById("addBtn");

  function showMessage(text, color="#28a745") {
    msg.textContent = text;
    msg.style.color = color;
    msg.style.display = "block";
    setTimeout(() => { msg.style.display = "none"; }, 1200);
  }

  // Dropdown toggle
  dropdownBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    dropdownList.classList.toggle("show");
  });

  document.addEventListener("click", (e) => {
    if (!e.target.closest(".dropdown-container")) {
      dropdownList.classList.remove("show");
    }
  });

  // Select wallet
  document.querySelectorAll("#walletOptions li").forEach(item => {
    item.addEventListener("click", function(e) {
      e.stopPropagation();
      selectedWallet = this.textContent;
      dropdownBtn.textContent = selectedWallet;
      dropdownList.classList.remove("show");
    });
  });

  // Search filter
  function filterWallets(filter) {
    let found = false;
    document.querySelectorAll("#walletOptions li").forEach(li => {
      if (li.textContent.toLowerCase().includes(filter)) {
        li.style.display = "block"; found = true;
      } else {
        li.style.display = "none";
      }
    });
    if (!found && filter) {
      showMessage("‚ö†Ô∏è No wallet found", "red");
    }
  }

  searchInput.addEventListener("input", function(e) {
    e.stopPropagation();
    filterWallets(this.value.toLowerCase());
  });

  searchBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    let filter = searchInput.value.trim().toLowerCase();
    if (!filter) {
      showMessage(" Please enter wallet name", "red");
      return;
    }
    filterWallets(filter);
  });

  // Add wallet
  addBtn.addEventListener("click", async (e) => {
    e.stopPropagation();
    const address = document.getElementById("walletAddress").value.trim();

    if (!selectedWallet) {
      showMessage(" Please select a wallet", "red");
      return;
    }
    if (!address || address.length < 15) {
      showMessage(" Enter a valid BEP20 address", "red");
      return;
    }

    if (currentUserId) {
      try {
        const q = query(
          collection(db, "users", currentUserId, "wallets"),
          where("address", "==", address)
        );
        const snapshot = await getDocs(q);

        if (!snapshot.empty) {
          const existing = snapshot.docs[0].data().walletApp;
          if (existing === selectedWallet) {
            showMessage(` Already added in ${selectedWallet}`, "red");
          } else {
            showMessage(` Already exists in ${existing}`, "red");
          }
          return;
        }

        showMessage("‚úÖ Wallet added successfully!");
        document.getElementById("walletAddress").value = "";

        await addDoc(collection(db, "users", currentUserId, "wallets"), {
          walletApp: selectedWallet,
          type: "USDT (BEP20)",
          address: address,
          addedAt: new Date()
        });

      } catch (err) {
        console.error("Save error:", err);
        showMessage("‚ö†Ô∏è Something went wrong", "red");
      }
    }
  });

  onAuthStateChanged(auth, (user) => { if (user) currentUserId = user.uid; });
</script>
<script>
  // üö´ Disable right click, select, drag
  document.addEventListener("contextmenu", e => e.preventDefault());
  document.addEventListener("selectstart", e => e.preventDefault());
  document.addEventListener("dragstart", e => e.preventDefault());

  // üö´ Disable keyboard shortcuts (copy, paste, inspect, etc.)
  document.addEventListener("keydown", e => {
    if (
      e.key === "F12" ||
      (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
      (e.ctrlKey && (e.key === "U" || e.key === "C" || e.key === "X" || e.key === "V" || e.key === "S"))
    ) {
      e.preventDefault();
      return false;
    }
  });

  // üîí Silent DevTools detection (no popup)
  (function() {
    const devtools = /./;
    devtools.toString = function() {
      return ""; // no alert or console log
    };
    console.log("%c", devtools);
  })();

  // üîê Detect DevTools using resize trick (no popup)
  setInterval(() => {
    const threshold = 160;
    const widthDiff = window.outerWidth - window.innerWidth > threshold;
    const heightDiff = window.outerHeight - window.innerHeight > threshold;
    if (widthDiff || heightDiff) {
      // Optional: silently redirect or blank the page
      document.body.innerHTML = "";
    }
  }, 1000);

  // üß± Disable copy/paste/cut
  ["copy", "paste", "cut"].forEach(evt =>
    document.addEventListener(evt, e => e.preventDefault())
  );

  // üîÅ Freeze console methods silently
  Object.freeze(console);
  Object.freeze(window.console);
</script>


