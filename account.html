<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" 
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Account â€” TrustDollar</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<!-- âœ… BTCInvest Auto Smart Bottom Navbar -->
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet">


<style>
:root {
  --green: #00c853;
  --light-green: #b9f6ca;
  --bg: #f9fafb;
  --muted: #777;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: var(--bg);
  
  padding-bottom: 100px; /* 
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
}

/* RIGHT SIDE INFO (no internal boxes) */
.profile-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 6px;
  padding-left: 10px;
}

/* Each Info Line (Simple Row - No Box) */
.info-box {
  display: flex;
  align-items: center;
  font-size: 15px;
  color: #333;
  line-height: 1.4;
  background: transparent;
  border: none;
  padding: 0;
  
}

/* âœ… Tick before text */
.info-box::before {
  content: "âœ”";
  color: #00c853;
  font-size: 14px;
  margin-right: 8px;
  animation: tickBlink 1.5s infinite ease-in-out;
}

/* Tick Animation */
@keyframes tickBlink {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.4; transform: scale(1.15); }
}



/* ACTION GRID */
.action-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
  gap: 12px;
  padding: 0 18px;
}
.action-item {
  background: #fff;
  border-radius: 5px;
  padding: 12px 6px;
  text-align: center;
  
  cursor: pointer;
  transition: transform 0.2s ease;
}
.action-item:hover {
  transform: translateY(-3px);
}
.action-item i {
  
  font-size: 22px;
  margin-bottom: 4px;
}
.action-item span {
  font-size: 12px;
  font-weight: 500;
  color: #333;
  display: block;
}

/* SECTION BOXES */
.section {
  background: #fff;
  border-radius: 5px;
  margin: 14px 18px;
  padding: 12px;
 
}
.section-title {
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 6px;
}
.section-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 6px;
  border-radius: 5px;
  cursor: pointer;
  transition: background 0.2s ease;
}
.section-row:hover {
  background: #f6fff8;
}
.section-row i {
  font-size: 18px;
  
  margin-right: 10px;
}
.section-row span {
  font-size: 14px;
  color: #222;
}

/* SERVICE CENTER GRID */
.service-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 10px;
  text-align: center;
  margin-top: 10px;
}
.service-grid div {
  background: #f6fff8;
  border-radius: 5px;
  padding: 12px 0;
  color: #00c853;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}
.service-grid div:hover {
  background: #e8f5e9;
}

/* LOGOUT BUTTON */
.logout-btn {
  display: block;
  margin: 25px auto;
  background: #ef4444;
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 10px 20px;
  width: 90%;
  max-width: 450px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  transition: all 0.2s ease;
}
.logout-btn:hover {
  background: #dc2626;
}



:root {
  --nav-bg: #fff;
  --nav-text: #444;
  --nav-border: rgba(0, 0, 0, 0.08);
}

[data-theme="dark"] {
  --nav-bg: #0f0f0f;
  --nav-text: #ccc;
  --nav-border: rgba(255, 255, 255, 0.1);
}

/* ðŸ”¹ Navbar Base (height reduced) */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: var(--nav-bg);
  border-top: 1px solid var(--nav-border);
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 10px 0; /* ðŸ‘ˆ thinner padding */
  z-index: 9999;
}

/* ðŸ”¹ Nav items (slimmer text + less spacing) */
.bottom-nav .nav-item {
  flex: 1;
  text-align: center;
  color: var(--nav-text);
  text-decoration: none;
  font-size: 10px; /* ðŸ‘ˆ smaller text */
  position: relative;
  padding: 4px 0; /* ðŸ‘ˆ less padding */
  transition: all 0.3s ease;
}

/* ðŸ”¹ Icon (reduced size + gap) */
.bottom-nav .nav-item i {
  font-size: 18px; /* ðŸ‘ˆ smaller icons (was 22px) */
  display: block;
  opacity: 0.75;
  margin-bottom: 2px; /* ðŸ‘ˆ smaller gap */
  transition: all 0.3s ease;
}

/* ðŸ”¹ Text */
.bottom-nav .nav-item span {
  opacity: 0.7;
  transition: all 0.3s ease;
}

/* ðŸ”¹ Divider lines */
.bottom-nav .nav-item:not(:last-child)::after {
  content: "";
  position: absolute;
  right: 0;
  top: 25%;
  width: 1px;
  height: 50%;
  background: var(--nav-border);
}

/* ðŸ”¹ Active State (icons glow thoda soft) */
.bottom-nav .nav-item.active i {
  transform: scale(1.1);
  opacity: 1;
  animation: bulbGlow 1.6s ease-in-out infinite alternate;
}
.bottom-nav .nav-item.active span {
  opacity: 1;
  font-weight: 600;
}

/* Active colors */
.bottom-nav .nav-item:nth-child(1).active i { color: #00c853; }
.bottom-nav .nav-item:nth-child(2).active i { color: #ffc107; }
.bottom-nav .nav-item:nth-child(3).active i { color: #ff3b30; }
.bottom-nav .nav-item:nth-child(4).active i { color: #00bcd4; }

@keyframes bulbGlow {
  from { filter: brightness(1); }
  to { filter: brightness(1.6); }
}

/* ðŸ”¹ Ripple (same) */
.ripple {
  position: absolute;
  border-radius: 50%;
  transform: scale(0);
  animation: ripple 0.6s linear;
  background: rgba(0, 200, 83, 0.15);
}
@keyframes ripple {
  to { transform: scale(3); opacity: 0; }
}

/* ðŸ”¹ Responsive tuning */
@media (max-width: 480px) {
  .bottom-nav .nav-item i {
    font-size: 17px;
  }
  .bottom-nav .nav-item span {
    font-size: 9.5px;
  }
}




/* ðŸ”´ Notification red dot beside bell */
#notifyLink {
  position: relative;
}
#notifyDot {
  position: absolute;
  top: 8px;
  left: 28px; /* perfect beside bell */
  width: 10px;
  height: 10px;
  background: red;
  border-radius: 5px;
  display: none;
  box-shadow: 0 0 8px rgba(255, 0, 0, 0.6);
  animation: blinkDot 1s infinite ease-in-out;
}

/* ðŸ”” Blink animation for red dot */
@keyframes blinkDot {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.3; transform: scale(1.2); }
}

/* ðŸŸ¢ Center popup alert */
.center-alert {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.9);
  background: linear-gradient(135deg, #00c853, #00bfa5);
  color: #fff;
  padding: 14px 26px;
  border-radius: 5px;
  font-weight: 600;
  font-size: 15px;
  text-align: center;
  
  z-index: 2000;
  opacity: 0;
  transition: all 0.4s ease;
}
.center-alert.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
}

/* ===== PREMIUM FB STYLE HEADER ===== */

.fb-profile-header {
  background: #fff;
  border-radius: 16px;
  margin: 14px;
  overflow: hidden;
 
}

/* Cover */
.fb-cover {
  height: 110px;
  background: linear-gradient(
    135deg,
    #16a34a,
    #22c55e,
    #86efac
  );
}

/* Profile Row */
.fb-profile-row {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 0 18px 18px;
  margin-top: -40px;
}

/* Avatar */
.fb-avatar {
  position: relative;
  width: 90px;
  height: 90px;
  background: #fff;
  padding: 4px;
  border-radius: 50%;
  
}

.fb-avatar img {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
}

/* Live dot */
.avatar-live {
  position: absolute;
  bottom: 6px;
  right: 6px;
  width: 14px;
  height: 14px;
  background: #16a34a;
  border-radius: 50%;
  border: 3px solid #fff;
 
}

/* ===== FB USER INFO (SAME DATA, PREMIUM LOOK) ===== */

.fb-user-info {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* Name */
.fb-user-info .info-line.name {
  font-size: 17px;
  font-weight: 600;
  color: #0f172a;
}

/* Normal text */
.fb-user-info .info-line {
  font-size: 13px;
  color: #334155;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* Muted (last login) */
.fb-user-info .info-line.muted {
  font-size: 12px;
  color: #64748b;
}

/* Soft premium dot */
.fb-user-info .info-line::before {
  content: "â€¢";
  color: #22c55e;
  font-size: 18px;
  line-height: 1;
}

/* Cover */
.fb-cover {
  position: relative;
  height: 120px;
  overflow: hidden;
  cursor: pointer;
}

.cover-img {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0;
  transition: opacity 1s ease;
}

.cover-img.active {
  opacity: 1;
}

/* Profile Avatar */
.fb-avatar {
  width: 90px;
  height: 90px;
  background: #fff;
  padding: 4px;
  border-radius: 50%;
 
  cursor: pointer;
}

/* Fullscreen Viewer */
.image-viewer {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.85);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 99999;
  opacity: 0;
  pointer-events: none;
  transition: opacity .3s ease;
}

.image-viewer img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 12px;
}

.image-viewer.show {
  opacity: 1;
  pointer-events: auto;
}


/* ===== USER INFO ATTACHED BOX (FINAL FIX) ===== */

.user-info-box {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 14px;

  margin: -12px 14px 14px;   /* header se chipka */
  padding: 16px 18px;

  background: #ffffff;
  border: 1px solid rgba(15, 23, 42, 0.08);
  border-top: none;
  border-radius: 0 0 16px 16px;

 
}

/* Left info */
.user-info-left {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

/* Name + badges row */
.name-row {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.name-row .name {
  font-size: 16px;
  font-weight: 600;
  color: #0f172a;
}

/* Info lines */
.user-info-box .info-line {
  font-size: 13px;
  color: #334155;
  display: flex;
  align-items: center;
  gap: 8px;
}

.user-info-box .info-line.muted {
  font-size: 12px;
  color: #64748b;
}

.user-info-box .info-line::before {
  content: "â€¢";
  color: #22c55e;
  font-size: 18px;
  line-height: 1;
}

/* ===== LIVE STATUS (RIGHT SIDE) ===== */

.account-live {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  border-radius: 5px;

  background: rgba(22, 163, 74, 0.12);
  border: 1px solid rgba(22, 163, 74, 0.3);
  color: #16a34a;

  font-size: 13px;
  font-weight: 600;
  white-space: nowrap;
}

.account-live .live-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #16a34a;
 
  animation: pulseLive 1.2s infinite ease-in-out;
}

@keyframes pulseLive {
  0%,100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.4); opacity: 0.5; }
}

/* Mobile */
@media (max-width: 520px) {
  .user-info-box {
    flex-direction: column;
    align-items: flex-start;
  }

  .account-live {
    margin-top: 6px;
  }
}



/* ===== LOGOUT MODAL OVERLAY ===== */
.logout-modal {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.55);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 99999;

  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
}

.logout-modal.show {
  opacity: 1;
  pointer-events: auto;
}

/* ===== LOGOUT MODAL OVERLAY ===== */
.logout-modal {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.55);

  display: flex;
  align-items: center;
  justify-content: center;

  z-index: 100000;

  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
}

.logout-modal.show {
  opacity: 1;
  pointer-events: auto;
}

/* ===== LOGOUT CARD ===== */
.logout-box {
  width: 92%;
  max-width: 380px;

  background: #ffffff;
  border-radius: 14px;

  box-shadow: 0 30px 70px rgba(0,0,0,0.28);

  display: flex;
  flex-direction: column;
  overflow: hidden;

  animation: scaleIn 0.25s ease;
}

/* ===== HEADER (alag clearly) ===== */
.logout-box h3 {
  margin: 0;
  padding: 16px 18px;

  font-size: 17px;
  font-weight: 600;
  color: #0f172a;

  background: #f8fafc;
  border-bottom: 1px solid #e5e7eb;

  text-align: center;
}

/* ===== BODY TEXT ===== */
.logout-box p {
  margin: 0;
  padding: 18px 20px;

  font-size: 14px;
  color: #475569;
  line-height: 1.55;
  text-align: center;
}

/* ===== BUTTON ROW ===== */
.logout-actions {
  display: flex;
  border-top: 1px solid #e5e7eb;
}

/* COMMON BUTTON */
.logout-actions button {
  flex: 1;
  padding: 13px 0;

  font-size: 14px;
  font-weight: 600;

  border: none;
  background: none;
  cursor: pointer;

  transition: background 0.2s ease;
}

/* NO */
.btn-no {
  background: #f8fafc;
  color: #334155;
}

.btn-no:hover {
  background: #f1f5f9;
}

/* YES */
.btn-yes {
  color: #ef4444;
  border-left: 1px solid #e5e7eb;
}

.btn-yes:hover {
  background: rgba(239,68,68,0.08);
}

/* ===== ANIMATION ===== */
@keyframes scaleIn {
  from {
    transform: translateY(6px) scale(0.96);
    opacity: 0;
  }
  to {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
}
/* ===== ACCOUNT WARNING BOX ===== */
.account-warning-box {
  margin: 6px 14px 14px;
  padding: 14px 16px;

 
  border: 1px solid #fde68a;
  border-radius: 5px;


}

/* Title */
.warning-title {
  display: flex;
  align-items: center;
  gap: 6px;

  font-size: 14px;
  font-weight: 600;
  color: #92400e;
  margin-bottom: 8px;
}

.warning-title i {
  font-size: 18px;
}

/* List */
.warning-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

/* Each warning */
.warning-list li {
  position: relative;
  padding-left: 16px;
  margin-bottom: 6px;

  font-size: 13px;
  color: #78350f;
  line-height: 1.45;
}

/* Bullet dot */
.warning-list li::before {
  content: "â€¢";
  position: absolute;
  left: 0;
  top: 0;
  color: #f59e0b;
  font-size: 18px;
  line-height: 1;
}

/* Last item spacing fix */
.warning-list li:last-child {
  margin-bottom: 0;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;              /* ðŸ‘ˆ gap kam */
  padding: 0 16px;
  margin: 14px 0 22px;   /* ðŸ‘ˆ vertical space kam */
}

.stat-box {
  background: #ffffff;
  border-radius: 5px;
  padding: 10px 6px;     /* ðŸ‘ˆ sabse important: padding kam */
  text-align: center;
}

/* icon thoda chota */
.stat-box i {
  font-size: 18px;       /* ðŸ‘ˆ 22 â†’ 18 */
  color: #00c853;
  margin-bottom: 4px;
  display: block;
}

/* label compact */
.stat-label {
  font-size: 11px;       /* ðŸ‘ˆ 12 â†’ 11 */
  color: #64748b;
  line-height: 1.2;
}

/* value compact */
.stat-value {
  display: block;
  margin-top: 2px;
  font-size: 13px;       /* ðŸ‘ˆ 15 â†’ 13 */
  font-weight: 600;
  color: #0f172a;
}

/* VIP box */
.stat-box.vip {
  background: linear-gradient(135deg, #fff7ed, #fffbeb);
  border: 1px solid #fde68a;
}

.stat-box.vip i {
  color: #f59e0b;
}

/* Mobile */
@media (max-width: 520px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}


</style>

</head>
<body>

  <div class="page-wrap">
<!-- ðŸ”· Premium Profile Header -->
<div class="fb-profile-header">

  <!-- Cover Slider -->
  <div class="fb-cover" id="coverSlider">
    <img src="https://picsum.photos/900/400?1" class="cover-img active">
    <img src="https://picsum.photos/900/400?2" class="cover-img">
    <img src="https://picsum.photos/900/400?3" class="cover-img">
  </div>

  <!-- Profile Row -->
  <div class="fb-profile-row">
    <div class="fb-avatar" id="profileAvatar">
      <img id="profileImage" src="https://i.pravatar.cc/300">
    </div>

   
  </div>
</div>

<!-- Fullscreen Image Viewer -->
<div class="image-viewer" id="imageViewer">
  <img id="viewerImg">
</div>


<div id="newNotifAlert" class="center-alert">ðŸ”” You have a new notification!</div>

<div class="user-info-box">

  <!-- LEFT: User Information -->
  <div class="user-info-left">

    <!-- Name + Badges -->
    <div class="name-row">
      <span class="name" id="userName">Loading...</span>

</div>
    <div class="info-line" id="joinDate">Joined: --</div>
    <div class="info-line" id="userUID">Email: --</div>
    <div class="info-line muted" id="lastLogin">Last login: --</div>
  </div>

  <!-- RIGHT: Live Status -->
  <div class="account-live" id="accountLive">
    <span class="live-dot"></span>
    <span class="live-text">Account Live</span>
  </div>

</div>

<!-- ðŸ”¹ ACCOUNT STATS -->
<div class="stats-grid">

  <div class="stat-box">
    <i class='bx bx-download'></i>
    <span class="stat-label">Total Deposit</span>
    <strong class="stat-value" id="totalDeposit">0</strong>
  </div>

  <div class="stat-box">
    <i class='bx bx-upload'></i>
    <span class="stat-label">Total Withdrawal</span>
    <strong class="stat-value" id="totalWithdraw">0</strong>
  </div>

  <div class="stat-box">
    <i class='bx bx-wallet'></i>
    <span class="stat-label">Available Balance</span>
    <strong class="stat-value" id="availableBalance">0</strong>
  </div>

  <div class="stat-box vip">
    <i class='bx bx-crown'></i>
    <span class="stat-label"> Level</span>
    <strong class="stat-value" id="accountLevel">VIP</strong>
  </div>

</div>

<div class="action-grid">
  <div class="action-item"><i class='bx bx-wallet'></i><span>Paytm</span></div>
  <div class="action-item"><i class='bx bx-download'></i><span>Deposit</span></div>
  <div class="action-item"><i class='bx bx-upload'></i><span>Withdraw</span></div>
  <div class="action-item"><i class='bx bx-crown'></i><span>VIP</span></div>
</div>

<!-- ðŸ”¹ HISTORY SECTION -->
<div class="section">
  <div class="section-title">History</div>
  <div class="section-row" id="txnLink"><i class='bx bx-history'></i><span>Transaction History</span></div>
  <div class="section-row" id="depHist"><i class='bx bx-file'></i><span>Deposit History</span></div>
  <div class="section-row" id="withHist"><i class='bx bx-up-arrow-circle'></i><span>Withdraw History</span></div>
</div>

<!-- ðŸ”¹ MORE SECTION -->
<div class="section">
  <div class="section-title">More</div>
  <div class="section-row" id="notifyLink"><i class='bx bx-bell'></i><div id="notifyDot"></div><span>Notifications</span></div>
    <div class="section-row" id="giftLink"><i class='bx bx-gift'></i><span>Gifts</span></div>
  <div class="section-row" id="langLink"><i class='bx bx-globe'></i><span>English </span></div>
</div>

<!-- ðŸ”¹ SERVICE CENTER SECTION -->
<div class="section">
  <div class="section-title">Service Center</div>
  <div class="service-grid">
    <div id="settingsLink"><i class='bx bx-cog'></i><br>Settings</div>
    <div id="feedbackLink"><i class='bx bx-message-dots'></i><br>Feedback</div>
    <div id="announceLink"><i class='bx bx-megaphone'></i><br>Announcement</div>
    <div id="supportLink"><i class='bx bx-support'></i><br>Live Support</div>
    <div id="guideLink"><i class='bx bx-book'></i><br>Guide</div>
    <div id="aboutLink"><i class='bx bx-info-circle'></i><br>About</div>
  </div>
</div>




<!-- âœ… HTML Navbar -->
<div class="bottom-nav" id="mainNav">
  <a href="Dashboard.html" class="nav-item">
    <i class="ri-home-5-fill"></i>
    <span>Home</span>
  </a>

  <a href="mining.html" class="nav-item">
    <i class="ri-bar-chart-2-fill"></i>
    <span>Mining</span>
  </a>

  <a href="promotion.html" class="nav-item">
    <i class="ri-gift-fill"></i>
    <span>Promotion</span>
  </a>

  <a href="account.html" class="nav-item">
    <i class="ri-user-3-fill"></i>
    <span>Account</span>
  </a>
</div>



<!-- ðŸ”´ Logout Confirmation Modal -->
<div class="logout-modal" id="logoutModal">
  <div class="logout-box">
    <h3>Confirm Logout</h3>
    <p>Are you sure you want to log out from your account?</p>

    <div class="logout-actions">
      <button class="btn-no" id="cancelLogout">No</button>
      <button class="btn-yes" id="confirmLogout">Yes, Logout</button>
    </div>
  </div>
</div>

<!-- âš ï¸ Account Warnings -->
<div class="account-warning-box">
  <div class="warning-title">
    <i class='bx bx-error-circle'></i>
    Important Account Notices
  </div>

  <ul class="warning-list">
    <li>Do not share your login credentials with anyone.</li>
    <li>Withdrawals and deposits may not be processed on weekends.</li>
    <li>Always verify your account details before making transactions.</li>
    <li>Suspicious activity may lead to temporary account suspension.</li>
    <li>Ensure your registered email is active and accessible.</li>
    <li>Logging in from multiple devices may affect account security.</li>
  </ul>
</div>

<button class="logout-btn">Log Out</button>

</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
  getFirestore, doc, getDoc, collection, getDocs, addDoc, serverTimestamp, updateDoc, onSnapshot 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

// ðŸ”¥ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
  authDomain: "btcinvest-c0e25.firebaseapp.com",
  projectId: "btcinvest-c0e25",
  storageBucket: "btcinvest-c0e25.firebasestorage.app",
  messagingSenderId: "204937458487",
  appId: "1:204937458487:web:cc27ece1249999279f60b2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// ðŸ”— Elements
const userNameEl = document.getElementById("userName");
const userUIDEl = document.getElementById("userUID");
const lastLoginEl = document.getElementById("lastLogin");
const userBalanceEl = document.getElementById("userBalance");
const profileImage = document.getElementById("profileImage");
const joinDateEl = document.getElementById("joinDate");
const notifyDot = document.getElementById("notifyDot");
const newNotifAlert = document.getElementById("newNotifAlert");

profileImage.src = `https://i.pravatar.cc/150?img=${Math.floor(Math.random() * 70) + 1}`;

onAuthStateChanged(auth, async (user) => {


  // âœ… Create Notifications Subcollection Automatically
  try {
    const notifRef = collection(db, "users", user.uid, "notifications");
    const notifSnap = await getDocs(notifRef);
    if (notifSnap.empty) {
      await addDoc(notifRef, {
        message: "âš¡Welcome to something powerful â€” together, we move towards success!",
        seen: false,
        createdAt: serverTimestamp(),
        type: "info"
      });
    }
  } catch (err) {
    console.error("âš ï¸ Notification subcollection creation failed:", err);
  }

  // âœ… Fetch user details
  const createdAt = new Date(user.metadata.creationTime);
  joinDateEl.textContent = "Joined: " + createdAt.toLocaleDateString();

  try {
    const userRef = doc(db, "users", user.uid);
    const snap = await getDoc(userRef);
    if (snap.exists()) {
      const data = snap.data();
      userNameEl.textContent = data.name || user.displayName || "User";
      userUIDEl.textContent = `Email: ${user.email}`;
      lastLoginEl.textContent = "Last login: " + new Date().toLocaleString();
      const balanceValue = data.walletBalance ?? data.balance ?? data.wallet ?? data.amount ?? 0;
      
      profileImage.src = user.photoURL || profileImage.src;
    }
  } catch (error) {
    console.error("ðŸ”¥ Firestore fetch error:", error);
  }

  // âœ… Real-time Notification Listener (no refresh needed)
  const notifRef = collection(db, "users", user.uid, "notifications");
  onSnapshot(notifRef, (snapshot) => {
    let unseenCount = 0;
    snapshot.forEach(docSnap => {
      if (docSnap.data().seen === false) unseenCount++;
    });

    if (unseenCount > 0) {
      notifyDot.style.display = "flex";
      notifyDot.textContent = unseenCount; // ðŸ”´ Show count number inside dot
      newNotifAlert.classList.add("show");
      setTimeout(() => newNotifAlert.classList.remove("show"), 2500);
    } else {
      notifyDot.style.display = "none";
    }
  });

  // âœ… Mark all notifications as seen when opened
  document.getElementById("notifyLink").addEventListener("click", async () => {
    const notifSnap = await getDocs(notifRef);
    notifSnap.forEach(async (docSnap) => {
      if (!docSnap.data().seen) {
        await updateDoc(doc(db, "users", user.uid, "notifications", docSnap.id), { seen: true });
      }
    });
    notifyDot.style.display = "none";
  });




  // âœ… All page navigations
  const pageLinks = {
    txnLink: "",
    depHist: "deposithistry.html",
    withHist: "withdrawalhistory.html",
    notifyLink: "notifications.html",
    giftLink: "gifts.html",
    langLink: "account.html",
    settingsLink: "settings.html",
    feedbackLink: "feedback.html",
    announceLink: "announcement.html",
    supportLink: "https://tawk.to/chat/68ff08d946288f19552eb908/1j8i3l4ro",
    guideLink: "guide.html",
    aboutLink: "about.html",
  };

  Object.entries(pageLinks).forEach(([id, url]) => {
    const el = document.getElementById(id);
    if (el) el.addEventListener("click", () => (window.location.href = url));
  });
});


// âœ… LOGOUT POPUP â€“ FINAL & WORKING
window.addEventListener("DOMContentLoaded", () => {
  const logoutBtn = document.querySelector(".logout-btn");
  const logoutModal = document.getElementById("logoutModal");
  const cancelLogout = document.getElementById("cancelLogout");
  const confirmLogout = document.getElementById("confirmLogout");

  if (!logoutBtn || !logoutModal) {
    console.error("Logout elements missing");
    return;
  }

  // ðŸ” Refresh ke baad bhi popup rahe
  if (localStorage.getItem("logout_pending") === "true") {
    logoutModal.classList.add("show");
  }

  // ðŸ”´ Logout click
  logoutBtn.addEventListener("click", () => {
    localStorage.setItem("logout_pending", "true");
    logoutModal.classList.add("show");
  });

  // âŒ NO
  cancelLogout.addEventListener("click", () => {
    localStorage.removeItem("logout_pending");
    logoutModal.classList.remove("show");
  });

  // âœ… YES
  confirmLogout.addEventListener("click", async () => {
    localStorage.removeItem("logout_pending");
    await signOut(auth);
    location.href = "login.html";
  });
});

</script>

<script>
// â³ Auto Logout After 5 Hours Inactivity

const AUTO_LOGOUT_TIME = 5 * 60 * 60 * 1000; // 5 hours

let lastActivity = Date.now();

// User activity detect
function updateActivity() {
  lastActivity = Date.now();
}
document.addEventListener("click", updateActivity);
document.addEventListener("mousemove", updateActivity);
document.addEventListener("keydown", updateActivity);

// Check inactivity every 20 seconds
setInterval(() => {
  if (Date.now() - lastActivity > AUTO_LOGOUT_TIME) {
    localStorage.setItem("logoutReason", "expired");
    window.location.href = "index.html"; // redirect
  }
}, 20000);
</script>
<script>
  // Disable double-tap zoom
  let lastTouchEnd = 0;
  document.addEventListener('touchend', function(event) {
    const now = Date.now();
    if (now - lastTouchEnd <= 300) {
      event.preventDefault();
    }
    lastTouchEnd = now;
  }, false);

  // Disable pinch zoom
  document.addEventListener('touchmove', function(event) {
    if (event.scale !== undefined && event.scale !== 1) {
      event.preventDefault();
    }
  }, { passive: false });
</script>
<script>
/* ðŸ” Cover Auto Slider */
const covers = document.querySelectorAll(".cover-img");
let current = 0;

setInterval(() => {
  covers[current].classList.remove("active");
  current = (current + 1) % covers.length;
  covers[current].classList.add("active");
}, 4000);

/* ðŸ–¼ Fullscreen Viewer */
const viewer = document.getElementById("imageViewer");
const viewerImg = document.getElementById("viewerImg");

/* Cover click */
document.getElementById("coverSlider").addEventListener("click", () => {
  viewerImg.src = covers[current].src;
  viewer.classList.add("show");
});

/* Profile click */
document.getElementById("profileAvatar").addEventListener("click", () => {
  viewerImg.src = document.getElementById("profileImage").src;
  viewer.classList.add("show");
});

/* Close on click */
viewer.addEventListener("click", () => {
  viewer.classList.remove("show");
});
</script>
<script>
/* ðŸŒ— Auto theme detect */
function detectTheme() {
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  document.documentElement.setAttribute("data-theme", prefersDark ? "dark" : "light");
}
detectTheme();
window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", detectTheme);

/* ðŸ’¡ Auto highlight based on page URL */
const currentPage = window.location.pathname.split("/").pop().toLowerCase();
document.querySelectorAll(".bottom-nav .nav-item").forEach(item => {
  const href = item.getAttribute("href")?.toLowerCase();
  if (currentPage === href) item.classList.add("active");
});

/* ðŸŒŠ Ripple effect + manual highlight */
document.querySelectorAll(".bottom-nav .nav-item").forEach((item) => {
  item.addEventListener("click", (e) => {
    // highlight
    document.querySelector(".bottom-nav .nav-item.active")?.classList.remove("active");
    item.classList.add("active");

    // ripple
    const ripple = document.createElement("span");
    ripple.classList.add("ripple");
    const rect = item.getBoundingClientRect();
    ripple.style.left = `${e.clientX - rect.left}px`;
    ripple.style.top = `${e.clientY - rect.top}px`;
    item.appendChild(ripple);
    setTimeout(() => ripple.remove(), 500);
  });
});
</script>

<script>
// ðŸ”¥ TEMP DEMO STATE (Pending Mode)
function loadAccountStatsDemo() {

  const pendingText = "Pending";

  document.getElementById("totalDeposit").textContent =
    "$ " + pendingText;

  document.getElementById("totalWithdraw").textContent =
    "$ " + pendingText;

  document.getElementById("availableBalance").textContent =
    "$ " + pendingText;

  document.getElementById("accountLevel").textContent =
    pendingText;
}

// page load pe run
document.addEventListener("DOMContentLoaded", loadAccountStatsDemo);
</script>

</body>
</html>
