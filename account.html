<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Account</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f9fafb;
      margin: 0;
      padding-bottom: 120px;
      color: #333;
    }
    .container { max-width: 950px; margin: auto; padding: 20px; }
    h1 { text-align: center; margin-bottom: 20px; color: #1e293b; }

    /* Card */
    .card {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      margin-bottom: 25px;
      transition: 0.3s;
    }
    .card h2 {
      margin: 0 0 15px;
      font-size: 18px;
      color: #1e293b;
    }
    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
      font-size: 15px;
    }
    .info-row:last-child { border-bottom: none; }

    /* Leadership Card Styling */
     /* Leadership Card Styling */
.leader-card {
  background: linear-gradient(135deg,#28a745,#60d394);
  color: #fff;
  text-align: center;
  padding: 25px;
  border-radius: 18px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.leader-header {
  display: flex;
  justify-content: space-around;
  align-items: center;
  margin-bottom: 15px;
}

.leader-box {
  flex: 1;
  text-align: center;
}

.leader-icon {
  font-size: 32px;
  margin-bottom: 6px;
  display: block;
}

.leader-label {
  font-size: 14px;
  opacity: 0.9;
  display: block;
}

.leader-value {
  font-size: 18px;
  font-weight: 600;
  margin-top: 4px;
}

.leader-next {
  font-size: 14px;
  opacity: 0.9;
  margin-bottom: 10px;
}


    /* Progress Bar */
    .progress {
      background: rgba(255,255,255,0.3);
      border-radius: 8px;
      overflow: hidden;
      height: 14px;
      margin-top: 12px;
    }
    .progress-bar {
      background: #fff;
      height: 100%;
      width: 0%;
      transition: width 0.4s ease;
    }

    /* Buttons */
    .btn {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      color: #fff;
      cursor: pointer;
      transition: 0.3s;
      font-size: 15px;
    }
    .btn-green { background: #28a745; }
    .btn-logout { background: #ef4444; }
    .btn:hover { opacity: 0.9; }

    /* Navbar */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 70px;
      background: #fff;
      display: flex;
      justify-content: space-around;
      align-items: center;
      border-top: 2px solid #28a745;
      z-index: 100;
    }
    .nav-item {
      flex: 1;
      text-align: center;
      font-size: 12px;
      color: #333;
      text-decoration: none;
      transition: 0.3s;
      position: relative;
      padding: 10px 0;
    }
    .nav-item i {
      font-size: 22px;
      display: block;
      margin-bottom: 3px;
      color: #28a745;
    }
    .nav-item:hover { color: #28a745; }
    .nav-item:hover i { color: #218838; }
    .nav-item:not(:last-child)::after {
      content: "";
      position: absolute;
      right: 0;
      top: 20%;
      bottom: 20%;
      width: 1px;
      background: #e0e0e0;
    }

    /* Helper Text */
    .helper {
      font-size: 13px;
      color: #666;
      margin-bottom: 15px;
      text-align: center;
    }

    /* Popup Modal */
    #popupOverlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    #popupBox {
      background: #fff;
      padding: 20px;
      border-radius: 14px;
      width: 90%;
      max-width: 350px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
      text-align: center;
      animation: zoomIn 0.2s ease;
    }
    #popupBox h3 { margin:0 0 12px; font-size:18px; color:#111; }
    #popupInput {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 15px;
    }
    @keyframes zoomIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .popup-actions {
      margin-top:15px;
      display:flex;
      gap:10px;
      justify-content:flex-end;
    }
    .popup-actions button {
      padding:8px 14px;
      border:none;
      border-radius:8px;
      color:#fff;
      cursor:pointer;
    }
    .popup-cancel { background:#999; }
    .popup-ok { background:#28a745; }


    /* Small Header */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0px 16px;
  background: #28a745; /* Trust green */
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 999;
}

.header .logo {
  font-size: 20px;
  font-weight: bold;
  color: #fff;
}

.header .title {
  font-size: 16px;
  font-weight: 600;
  color: #fff; /* plain white for clarity */
}

.header .notif {
  position: relative;
  background: rgba(255,255,255,0.15);
  border-radius: 50%;
  padding: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.header .notif i {
  font-size: 18px;
  color: #fff;
}

.header .notif .dot {
  position: absolute;
  top: 2px;
  right: 2px;
  width: 8px;
  height: 8px;
  background: red;
  border-radius: 50%;
}


  </style>
</head>
<body>
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>



<!-- Header -->
<header class="header">
 
  </div>
  <h1 class="title">TrustDollar <small>Account</small></h1>
  
</header>


  <div class="container">
  

  <!-- Leadership Level (Top Card) -->
<div class="card leader-card" id="leaderCard">
  <div class="leader-header">
    <div class="leader-box">
      <i class="bx bxs-user leader-icon" id="leaderIcon"></i>
      <span class="leader-label">Rank</span>
      <div class="leader-value" id="userRank">Newbie</div>
    </div>
    <div class="leader-box">
      <i class="bx bxs-group leader-icon"></i>
      <span class="leader-label">Total Team</span>
      <div class="leader-value" id="rankTeam">0</div>
    </div>
  </div>
  <p class="leader-next" id="nextGoal">Keep Growing üöÄ</p>
  <div class="progress"><div class="progress-bar" id="rankProgress"></div></div>
</div>

    <p class="helper">Manage your profile, wallet and security settings. Keep your account safe üîí</p>

    <!-- Profile Info -->
    <div class="card">
      <h2>Profile Information</h2>
      <div class="info-row"><span>Name</span><span id="userName">Loading...</span></div>
      <div class="info-row"><span>Email</span><span id="userEmail">Loading...</span></div>
      <div class="info-row"><span>Referral Code</span><span id="userRef">Loading...</span></div>
      <div class="info-row"><span>Joined</span><span id="userJoin">Loading...</span></div>
      <button class="btn btn-green" onclick="editProfile()">‚úèÔ∏è Edit Profile</button>
    </div>

    <!-- Wallet Info -->
    <div class="card">
      <h2>Wallet Summary</h2>
      <div class="info-row"><span>Total Deposit</span><span id="userDeposit">$0</span></div>
      <div class="info-row"><span>Current Balance</span><span id="userBalance">$0</span></div>
      <div class="info-row"><span>Total Earnings</span><span id="userEarnings">$0</span></div>
    </div>

    <!-- Referral Stats -->
    <div class="card">
      <h2>My Team</h2>
      <div class="info-row"><span>Level 1</span><span id="teamLv1">0</span></div>
      <div class="info-row"><span>Level 2</span><span id="teamLv2">0</span></div>
      <div class="info-row"><span>Level 3</span><span id="teamLv3">0</span></div>
      <div class="info-row"><strong>Total Team</strong><strong id="teamTotal">0</strong></div>
    </div>

    <!-- Security -->
    <div class="card">
      <h2>Security Settings</h2>
      <p class="helper">Update your password and email to keep your account safe.</p>
      <button class="btn btn-green" onclick="changePassword()">üîë Change Password</button>
      <button class="btn btn-green" onclick="changeEmail()">üìß Change Email</button>
    </div>

    <!-- Logout -->
    <button class="btn btn-logout" onclick="logout()">üö™ Logout</button>
  </div>

  <!-- Navbar -->
  <div class="bottom-nav">
    <a href="Dashboard.html" class="nav-item"><i class='bx bx-home'></i><span>Home</span></a>
    <a href="invest.html" class="nav-item"><i class='bx bx-wallet'></i><span>Invest</span></a>
    <a href="promotion.html" class="nav-item"><i class='bx bx-gift'></i><span>Refer</span></a>
    <a href="account.html" class="nav-item"><i class='bx bx-user'></i><span>Account</span></a>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signOut, updatePassword, updateEmail } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
    authDomain: "btcinvest-c0e25.firebaseapp.com",
    projectId: "btcinvest-c0e25",
    storageBucket: "btcinvest-c0e25.firebasestorage.app",
    messagingSenderId: "204937458487",
    appId: "1:204937458487:web:cc27ece1249999279f60b2",
    measurementId: "G-HG0Q8ZHT6G"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // Rank Logic with Icon
  function getRank(total) {
    if (total >= 1000) return { rank: "üíé Diamond Leader", next: "Max Level Achieved üéâ", goal: 1000, icon: "bxs-diamond" };
    if (total >= 500) return { rank: "üèÜ Gold Leader", next: "1000 Members for Diamond", goal: 1000, icon: "bxs-trophy" };
    if (total >= 200) return { rank: "ü•à Silver Leader", next: "500 Members for Gold", goal: 500, icon: "bxs-medal" };
    if (total >= 50)  return { rank: "ü•â Bronze Leader", next: "200 Members for Silver", goal: 200, icon: "bxs-medal" };
    if (total >= 10)  return { rank: "üå± Starter", next: "50 Members for Bronze", goal: 50, icon: "bx-leaf" };
    return { rank: "üë§ Newbie", next: "10 Members for Starter", goal: 10, icon: "bxs-user" };
  }

  // Load user data
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const userDoc = await getDoc(doc(db, "users", user.uid));
      if (userDoc.exists()) {
        const data = userDoc.data();

        document.getElementById("userName").textContent = data.name || "Unnamed";
        document.getElementById("userEmail").textContent = data.email || user.email;
        document.getElementById("userRef").textContent = data.referralCode || "N/A";
        document.getElementById("userJoin").textContent = data.createdAt ? new Date(data.createdAt).toLocaleDateString() : "N/A";

        document.getElementById("userDeposit").textContent = "$" + (data.lifetimeDeposit || 0);
        document.getElementById("userBalance").textContent = "$" + (data.balance || 0);
        document.getElementById("userEarnings").textContent = "$" + (data.totalEarnings || 0);

        const lv1 = await getDocs(query(collection(db, "users"), where("referredBy", "==", data.referralCode)));
        const lv2 = await getDocs(query(collection(db, "users"), where("upline2", "==", user.uid)));
        const lv3 = await getDocs(query(collection(db, "users"), where("upline3", "==", user.uid)));

        const totalTeam = lv1.size + lv2.size + lv3.size;
        document.getElementById("teamLv1").textContent = lv1.size;
        document.getElementById("teamLv2").textContent = lv2.size;
        document.getElementById("teamLv3").textContent = lv3.size;
        document.getElementById("teamTotal").textContent = totalTeam;

        // Rank Update
        const { rank, next, goal, icon } = getRank(totalTeam);
        document.getElementById("userRank").textContent = rank;
        document.getElementById("rankTeam").textContent = totalTeam;
        document.getElementById("nextGoal").textContent = next;
        document.getElementById("leaderIcon").className = "bx " + icon + " leader-icon";

        // Progress bar update
        let progress = Math.min((totalTeam / goal) * 100, 100);
        document.getElementById("rankProgress").style.width = progress + "%";
      }
    } else {
      window.location.href = "login.html";
    }
  });

  // Logout
  window.logout = async function() {
    await signOut(auth);
    window.location.href = "login.html";
  }

  // Edit actions
  window.changePassword = function() { alert("üîë Change password feature"); }
  window.changeEmail = function() { alert("üìß Change email feature"); }
  window.editProfile = function() { alert("‚úèÔ∏è Edit profile feature"); }
</script>
</body>
</html>
