<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Feedback ‚Äî TrustDollar</title>

<!-- Google Font + Icons -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

<style>
:root {
  --green:#00c853;
  --green-dark:#009e49;
  --bg:#f0f3f8;
  --card:#fff;
  --muted:#757a80;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Poppins', sans-serif;
  background: var(--bg);
  color: #222;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  position: relative;
  z-index: 0;
}

/* ===== Header ===== */
.header {
  background: linear-gradient(145deg, var(--green), var(--green-dark));
  color: #fff;
  padding: 14px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 5; /* fixed, lower than popup but not covering input */
  box-shadow: 0 3px 10px rgba(0,0,0,0.15);
}
.header h1 { margin: 0; font-size: 18px; letter-spacing: 0.5px; }
.header div { display: flex; align-items: center; }

/* ===== Container ===== */
.container {
  flex: 1;
  max-width: 720px;
  width: 92%;
  margin: 25px auto;
  position: relative;
  z-index: 1;
}

/* ===== Feedback Box ===== */
.feedback-box {
  background: var(--card);
  border-radius: 5px;
  box-shadow: 0 6px 25px rgba(0,0,0,0.08);
  padding: 22px;
  transition: transform 0.2s ease;
}
.feedback-box:hover { transform: translateY(-3px); }
.feedback-box h2 { font-size: 20px; color: var(--green-dark); margin-bottom: 10px; }

label { display: block; margin-top: 12px; font-weight: 600; font-size: 14px; }
input, textarea {
  width: 100%;
  border: 1px solid #dce3ea;
  border-radius: 5px;
  padding: 10px 12px;
  font-size: 14px;
  margin-top: 6px;
  background: #f9fbfd;
  transition: 0.3s;
  position: relative;
  z-index: 2; /* ensure inputs always above others */
}
input:focus, textarea:focus {
  border-color: var(--green);
  outline: none;
  background: #fff;
}
textarea {
  resize: vertical;
  min-height: 100px;
}

/* ===== Button ===== */
button {
  background: linear-gradient(145deg, var(--green), var(--green-dark));
  color: #fff;
  border: none;
  padding: 12px 20px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: 600;
  margin-top: 18px;
  width: 100%;
  font-size: 15px;
  transition: 0.3s ease;
  z-index: 2;
  position: relative;
}
button:hover { opacity: 0.9; transform: scale(1.01); }

/* ===== History ===== */
.history {
  margin-top: 30px;
  background: var(--card);
  border-radius: 5px;
  box-shadow: 0 6px 25px rgba(0,0,0,0.08);
  padding: 20px;
}
.history h2 { font-size: 18px; color: var(--green-dark); margin-bottom: 12px; }

.feedback-item {
  border-bottom: 1px solid #eee;
  padding: 12px 0;
}
.feedback-item:last-child { border-bottom: none; }

.feedback-user {
  font-weight: 600;
  color: var(--green-dark);
  font-size: 14px;
}
.feedback-email {
  font-size: 13px;
  color: #666;
  margin-bottom: 6px;
}
.feedback-msg {
  color: #444;
  margin-bottom: 6px;
  font-weight: 500;
}
.feedback-reply {
  background: #e9f8ef;
  padding: 10px 12px;
  border-radius: 5px;
  font-size: 14px;
  margin-top: 6px;
  color: #0b572c;
}
.feedback-date {
  font-size: 12px;
  color: #888;
  margin-top: 4px;
}

/* ===== Center Popup ===== */
.popup-success {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.9);
  background: linear-gradient(145deg, #00c853, #00bfa5);
  color: #fff;
  padding: 20px 32px;
  border-radius: 5px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.25);
  font-size: 18px;
  font-weight: 600;
  opacity: 0;
  transition: all 0.4s ease;
  z-index: 9999;
  pointer-events: none; /* this fixes input typing issue */
}
.popup-success.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
}

/* ===== Responsive ===== */
@media (max-width: 480px) {
  .feedback-box, .history { padding: 16px; }
  button { font-size: 14px; }
}
</style>
</head>
<body>

  <!-- ===== Header ===== -->
  <div class="header">
    <div style="gap:10px;cursor:pointer" onclick="location.href='account.html'">
      <i class='bx bx-left-arrow-alt' style="font-size:20px"></i>
      <span>Back</span>
    </div>
    <h1>Feedback</h1>
    <div></div>
  </div>

  <!-- ===== Feedback Section ===== -->
  <div class="container">
    <div class="feedback-box">
      <h2>üí¨ Send Feedback</h2>

      <label>Your Name</label>
      <input type="text" id="userName" placeholder="Enter your name">

      <label>Your Email</label>
      <input type="email" id="userEmail" placeholder="Enter your Gmail ID">

      <label>Your Message</label>
      <textarea id="userMsg" rows="4" placeholder="Type your feedback..."></textarea>

      <button id="sendBtn">Send Feedback</button>
    </div>

    <div class="history" id="historyBox" style="display:none">
      <h2>üïì Your Feedback History</h2>
      <div id="feedbackList"></div>
    </div>
  </div>

  <!-- ‚úÖ Center Popup -->
  <div id="popupSuccess" class="popup-success">
    üéâ Your feedback sent successfully!
  </div>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getFirestore, collection, addDoc, doc, serverTimestamp,
    query, orderBy, onSnapshot
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  // --- Firebase Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
    authDomain: "btcinvest-c0e25.firebaseapp.com",
    projectId: "btcinvest-c0e25",
    storageBucket: "btcinvest-c0e25.firebasestorage.app",
    messagingSenderId: "204937458487",
    appId: "1:204937458487:web:cc27ece1249999279f60b2"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const userNameInput = document.getElementById("userName");
  const userEmailInput = document.getElementById("userEmail");
  const userMsgInput = document.getElementById("userMsg");
  const sendBtn = document.getElementById("sendBtn");
  const feedbackList = document.getElementById("feedbackList");
  const historyBox = document.getElementById("historyBox");
  const popupSuccess = document.getElementById("popupSuccess");

  let currentUser = null;

  // ‚úÖ Check user login
  onAuthStateChanged(auth, (user) => {
    if(!user){
      location.href = "login.html";
      return;
    }
    currentUser = user;
    userEmailInput.value = user.email || "";
    loadFeedbacks(user.uid);
  });

  // ‚úâÔ∏è Send feedback
  sendBtn.addEventListener("click", async () => {
    const name = userNameInput.value.trim();
    const email = userEmailInput.value.trim().toLowerCase();
    const message = userMsgInput.value.trim();
    if(!name || !email || !message){
      alert("Please fill all fields before sending feedback.");
      return;
    }

    try {
      const feedbackRef = collection(db, "users", currentUser.uid, "feedbacks");
      await addDoc(feedbackRef, {
        name,
        email,
        message,
        createdAt: serverTimestamp(),
        reply: ""
      });
      userMsgInput.value = "";
      showSuccessPopup();
    } catch (err){
      console.error(err);
      alert("Error sending feedback. Try again.");
    }
  });

  // üîÑ Load feedback history
  function loadFeedbacks(uid){
    const feedbackRef = collection(db, "users", uid, "feedbacks");
    const q = query(feedbackRef, orderBy("createdAt", "desc"));
    onSnapshot(q, (snapshot) => {
      feedbackList.innerHTML = "";
      if(snapshot.empty){
        historyBox.style.display = "none";
        return;
      }
      historyBox.style.display = "block";
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const item = document.createElement("div");
        item.className = "feedback-item";
        item.innerHTML = `
          <div class="feedback-user">üë§ ${data.name || "(No Name)"}</div>
          <div class="feedback-email">üìß ${data.email || "unknown"}</div>
          <div class="feedback-msg">üí¨ ${data.message}</div>
          ${data.reply ? `<div class="feedback-reply">üó®Ô∏è Admin Reply: ${data.reply}</div>` : ""}
          <div class="feedback-date">${formatDate(data.createdAt)}</div>
        `;
        feedbackList.appendChild(item);
      });
    });
  }

  // üü¢ Success popup animation
  function showSuccessPopup(){
    popupSuccess.classList.add("show");
    setTimeout(()=> popupSuccess.classList.remove("show"), 2500);
  }

  function formatDate(ts){
    if(!ts) return "";
    try{ return new Date(ts.seconds * 1000).toLocaleString(); }
    catch{ return ""; }
  }
  </script>
  <script>
  // üö´ Disable right click, select, drag
  document.addEventListener("contextmenu", e => e.preventDefault());
  document.addEventListener("selectstart", e => e.preventDefault());
  document.addEventListener("dragstart", e => e.preventDefault());

  // üö´ Disable keyboard shortcuts (copy, paste, inspect, etc.)
  document.addEventListener("keydown", e => {
    if (
      e.key === "F12" ||
      (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
      (e.ctrlKey && (e.key === "U" || e.key === "C" || e.key === "X" || e.key === "V" || e.key === "S"))
    ) {
      e.preventDefault();
      return false;
    }
  });

  // üîí Silent DevTools detection (no popup)
  (function() {
    const devtools = /./;
    devtools.toString = function() {
      return ""; // no alert or console log
    };
    console.log("%c", devtools);
  })();

  // üîê Detect DevTools using resize trick (no popup)
  setInterval(() => {
    const threshold = 160;
    const widthDiff = window.outerWidth - window.innerWidth > threshold;
    const heightDiff = window.outerHeight - window.innerHeight > threshold;
    if (widthDiff || heightDiff) {
      // Optional: silently redirect or blank the page
      document.body.innerHTML = "";
    }
  }, 1000);

  // üß± Disable copy/paste/cut
  ["copy", "paste", "cut"].forEach(evt =>
    document.addEventListener(evt, e => e.preventDefault())
  );

  // üîÅ Freeze console methods silently
  Object.freeze(console);
  Object.freeze(window.console);
</script>
</body>
</html>
