<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta 
  name="viewport" 
  content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
/>

<title>TrustDollar â€” Secure Login</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css">
<style>

body {
  font-family: "Poppins", sans-serif;
  background: linear-gradient(180deg, #f0fdf4, #e6f9ed);
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  min-height: 100vh;
  margin: 0;
  padding: 20px 10px 100px; /* bottom nav ke liye space */
  overflow-x: hidden; /* horizontal scrollbar hatao */
  overflow-y: auto;   /* vertical scroll allow karo */
}

/* Smooth scrolling + clean scrollbar fix */
html, body {
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

/* Hide scrollbar (Chrome, Edge, Safari) */
body::-webkit-scrollbar {
  width: 0px;
  background: transparent; /* invisible scrollbar track */
}


.login-box {
  width: 100%;
  max-width: 400px;
  background: #fff;
  border-radius: 5px;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
  overflow: hidden;
}

/* Tabs */
.tab-header {
  display: flex;
  background: #f9fafb;
  border-bottom: 2px solid #e5e7eb;
}

.tab {
  flex: 1;
  text-align: center;
  padding: 14px 0;
  cursor: pointer;
  font-weight: 600;
  color: #555;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  transition: background 0.3s, color 0.3s;
}

.tab i {
  color: #16a34a;
}

.tab.active {
  color: #16a34a;
  background: #ecfdf5;
}

/* FIX âœ…: Prevent movement on click by reserving underline space */
.tab::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%) scaleX(0);
  width: 60%;
  height: 3px;
  background: #16a34a;
  border-radius: 5px;
  transition: transform 0.3s ease;
}

.tab.active::after {
  transform: translateX(-50%) scaleX(1);
}

/* Form */
.form {
  padding: 24px 26px 30px;
}
.input-group {
  margin-bottom: 18px;
  position: relative;
}
.input-group label {
  font-size: 14px;
  color: #333;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 6px;
}
.input-group input,
.input-group select {
  width: 100%;
  padding: 12px 40px 12px 12px;
  border-radius: 5px;
  border: 1.5px solid #ccc;
  font-size: 15px;
  outline: none;
  transition: 0.3s;
  box-sizing: border-box;
}
.input-group input:focus,
.input-group select:focus {
  border-color: #16a34a;
  box-shadow: 0 0 8px rgba(22, 163, 74, 0.25);
}

/* Country + phone */
.phone-row {
  display: flex;
  gap: 8px;
  align-items: center;
}
.phone-row select {
  width: 90px;
  padding: 12px 8px;
  border-radius: 5px;
  border: 1.5px solid #ccc;
  font-size: 14px;
  color: #333;
  background: #fff;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%2316a34a' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5H7z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 14px;
}

/* Eye icon */
.eye-icon {
  position: absolute;
  right: 12px;
  top: 38px;
  color: #888;
  font-size: 18px;
  cursor: pointer;
  transition: 0.3s;
}
.eye-icon:hover {
  color: #16a34a;
}

.actions {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
  font-size: 13px;
  color: #444;
}
.actions input {
  accent-color: #16a34a;
}

button {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 5px;
  background: linear-gradient(135deg, #16a34a, #22c55e);
  color: #fff;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  transition: 0.3s;
}
button:hover {
  background: linear-gradient(135deg, #15803d, #16a34a);
}
.register-btn {
  margin-top: 10px;
  background: none;
  border: 2px solid #16a34a;
  color: #16a34a;
  font-weight: 600;
}
.register-btn:hover {
  background: #16a34a;
  color: #fff;
}

.form-section {
  display: none;
}
.form-section.active {
  display: block;
}

/* Popup */
.popup-overlay {
  position: fixed;
  inset: 0;
  display: none;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(6px);
  background: rgba(0, 0, 0, 0.35);
  z-index: 2000;
}
.popup {
  background: #fff;
  padding: 26px 34px;
  border-radius: 5px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
  text-align: center;
  font-size: 16px;
  font-weight: 600;
  color: #333;
  transform: scale(0.85);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.25, 1, 0.3, 1);
}
.popup.show {
  opacity: 1;
  transform: scale(1);
}
.popup.success {
  border-left: 6px solid #28a745;
}
.popup.error {
  border-left: 6px solid #dc3545;
}

/* Responsive */
@media (max-width: 480px) {
  .login-box {
    margin: 0 10px;
  }
  .tab {
    font-size: 15px;
    padding: 12px 0;
  }
  .phone-row select {
    width: 80px;
  }
}


/* âœ… Validation feedback */
.valid-msg {
  font-size: 13px;
  margin-top: 4px;
  font-weight: 500;
}
.valid-msg.error {
  color: #dc2626; /* red */
}
.valid-msg.success {
  color: #16a34a; /* green */
}
.input-group input.invalid {
  border-color: #dc2626;
  box-shadow: 0 0 5px rgba(220,38,38,0.2);
}
.input-group input.valid {
  border-color: #16a34a;
  box-shadow: 0 0 5px rgba(22,163,74,0.2);
}

input.valid {
  border: 2px solid green;
  outline: none;
}

input.invalid {
  border: 2px solid red;
  outline: none;
}

/* Warning fade-in animation */
@keyframes fadeInWarning {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}

div[style*="Security Notice"] {
  animation: fadeInWarning 0.6s ease-out;
}




/* ğŸ Gift Card Styling */
.gift-card {
  text-align: center;
 
  border-radius: 5px;
  background: #ffffff;
  box-shadow: 0 6px 20px rgba(0,0,0,0.08);
  margin-top: 20px;
  transition: all 0.4s ease;
  transform-style: preserve-3d;
  perspective: 800px;
}

.gift-card:hover {
  transform: translateY(-6px) scale(1.02);
  box-shadow: 0 10px 25px rgba(0,0,0,0.12);
}

/* Title styling */
.gift-title {
  font-size: 18px;
  font-weight: 700;
  color: #333;
  margin-bottom: 12px;
  letter-spacing: 0.3px;
}
.gift-title .brand {
  background: linear-gradient(90deg, #4CAF50, #2c7);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Image box */
.gift-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 5px;
  overflow: hidden;
  background: linear-gradient(180deg, #f6fff9, #eef5ff);
  padding: 8px;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);
  transition: all 0.3s ease;
}

.gift-card:hover .gift-wrapper {
  background: linear-gradient(180deg, #e8fff1, #e6f0ff);
}

/* GIF Image */
.gift-image {
  width: 100%;
  max-width: 300px;
  border-radius: 5px;
  transform: scale(1);
  transition: all 0.6s ease;
}

.gift-card:hover .gift-image {
  transform: scale(1.05) rotateX(6deg);
}

/* Responsive */
@media (max-width: 480px) {
  .gift-image {
    max-width: 250px;
  }
  .gift-title {
    font-size: 16px;
  }
}


.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  width: 100%;
  text-align: center;
  padding: 10px;
  font-size: 18px;
  font-weight: bold;
  background: #ffffff00;
  color: #21d82b;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  z-index: 1000;
}

/* âœ… Add body top padding for fixed header space */
body {
  padding-top: 40px; /* add below your other body styles */
}


h2 {
  margin-top: 40px; /* ğŸŸ¢ Add some breathing space on top */
  margin-bottom: 20px; /* space between header & login box */
  text-align: center;
  color: #16a34a;
  font-weight: 700;
}
@media (min-width: 768px) {
  h2 {
    margin-top: 60px;
    margin-bottom: 30px;
  }
}

.spinner {
  width: 16px;
  height: 16px;
  border: 2px solid #ccc;
  border-top: 2px solid #16a34a;
  border-radius: 50%;
  display: inline-block;
  animation: spin 0.8s linear infinite;
  margin-left: 6px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}


</style>
</head>
<body>
 <div class="header">ğ’ğğœğ®ğ«ğ ğ˜ğ¨ğ®ğ« ğ…ğ®ğ§ğğ¬ ğ°ğ¢ğ­ğ¡ ğ’ğšğŸğ</div>
<div class="popup-overlay" id="popupOverlay">
  <div id="popup" class="popup"></div>
</div>

<div class="login-box">
  <div class="tab-header">
    <div class="tab active" id="emailTab"><i class="fas fa-envelope"></i> Email</div>
       <div class="tab" id="phoneTab"><i class="fas fa-phone"></i> Phone</div>
        <div class="tab" id="userTab"><i class="fas fa-user"></i> Username</div>
  </div>

  <div class="form">
    <!-- ğŸ“ Phone -->
    <div class="form-section" id="phoneForm">

      <div class="input-group">
        <label><i class="fas fa-phone"></i> Phone Number</label>
        <div class="phone-row">
          
          <input type="tel" id="login-identifier" placeholder="Please enter phone number" />
          <span id="idStatus" class="status-icon"></span>
        </div>
      </div>

      <div class="input-group">
        <label><i class="fas fa-lock"></i> Password</label>
        <input type="password" id="login-password" placeholder="Password" />
        <i class="fa-regular fa-eye eye-icon" id="toggle-password"></i>
        <span id="passStatus" class="status-icon"></span>
      </div>

      <div class="actions">
        <label><input type="checkbox" /> Remember password</label>
        <a href="#" id="forgot-btn" style="color:#16a34a;text-decoration:none;font-weight:600;">Forgot?</a>
      </div>

      <button id="loginBtn">Login</button>
      <button class="register-btn">Register</button>
    </div>

   <!-- ğŸ“§ Email -->
<div class="form-section active" id="emailForm">

  <div class="input-group">
    <label><i class="fas fa-envelope"></i> Email</label>
    <input type="email" id="email-login" placeholder="Please enter email address" />
  </div>
  <div class="input-group">
    <label><i class="fas fa-lock"></i> Password</label>
    <input type="password" id="email-password" placeholder="Password" />
    <i class="fa-regular fa-eye eye-icon" id="toggle-email-pass"></i>
  </div>

  <div class="actions">
    <label><input type="checkbox" id="remember-email" /> Remember password</label>
    <a href="#" id="forgot-email-btn" style="color:#16a34a;text-decoration:none;font-weight:600;">Forgot?</a>
  </div>

  <button id="emailLoginBtn">Login</button>
  <button class="register-btn">Register</button>
</div>

    <!-- ğŸ‘¤ Username -->
<div class="form-section" id="userForm">
  <div class="input-group">
    <label><i class="fas fa-user"></i> Username</label>
    <input type="text" id="user-login" placeholder="Enter your username" />
  </div>
  <div class="input-group">
    <label><i class="fas fa-lock"></i> Password</label>
    <input type="password" id="user-password" placeholder="Password" />
    <i class="fa-regular fa-eye eye-icon" id="toggle-user-pass"></i>
  </div>

  <div class="actions">
    <label><input type="checkbox" id="remember-user" /> Remember password</label>
    <a href="#" id="forgot-user-btn" style="color:#16a34a;text-decoration:none;font-weight:600;">Forgot?</a>
  </div>

  <button id="userLoginBtn">Login</button>
  <button class="register-btn">Register</button>
</div>


    <!-- ğŸ Gift Animation Card -->
<div class="card gift-card">
 
  <div class="gift-wrapper">
    <img 
      src="https://miro.medium.com/v2/resize:fit:996/1*V1hv3LGgo1W4wE3Az0mAnw.gif" 
      alt="TrustDollar Gift Animation" 
      class="gift-image"
      loading="lazy"
    />


  </div>
   <div class="gift-title">Enjoy <span class="brand">Secure Access</span></div>

</div>
</div>


<!-- âœ… BTCInvest Auto Smart Bottom Navbar -->
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet">

<style>
:root {
  --nav-bg: #fff;
  --nav-text: #444;
  --nav-border: rgba(0, 0, 0, 0.08);
}

[data-theme="dark"] {
  --nav-bg: #0f0f0f;
  --nav-text: #ccc;
  --nav-border: rgba(255, 255, 255, 0.1);
}

/* ğŸ”¹ Navbar Base (height reduced) */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: var(--nav-bg);
  border-top: 1px solid var(--nav-border);
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 10px 0; /* ğŸ‘ˆ thinner padding */
  z-index: 9999;
  box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.05);
}

/* ğŸ”¹ Nav items (slimmer text + less spacing) */
.bottom-nav .nav-item {
  flex: 1;
  text-align: center;
  color: var(--nav-text);
  text-decoration: none;
  font-size: 10px; /* ğŸ‘ˆ smaller text */
  position: relative;
  padding: 4px 0; /* ğŸ‘ˆ less padding */
  transition: all 0.3s ease;
}

/* ğŸ”¹ Icon (reduced size + gap) */
.bottom-nav .nav-item i {
  font-size: 18px; /* ğŸ‘ˆ smaller icons (was 22px) */
  display: block;
  opacity: 0.75;
  margin-bottom: 2px; /* ğŸ‘ˆ smaller gap */
  transition: all 0.3s ease;
}

/* ğŸ”¹ Text */
.bottom-nav .nav-item span {
  opacity: 0.7;
  transition: all 0.3s ease;
}

/* ğŸ”¹ Divider lines */
.bottom-nav .nav-item:not(:last-child)::after {
  content: "";
  position: absolute;
  right: 0;
  top: 25%;
  width: 1px;
  height: 50%;
  background: var(--nav-border);
}

/* ğŸ”¹ Active State (icons glow thoda soft) */
.bottom-nav .nav-item.active i {
  transform: scale(1.1);
  opacity: 1;
  animation: bulbGlow 1.6s ease-in-out infinite alternate;
}
.bottom-nav .nav-item.active span {
  opacity: 1;
  font-weight: 600;
}

/* Active colors */
.bottom-nav .nav-item:nth-child(1).active i { color: #00c853; }
.bottom-nav .nav-item:nth-child(2).active i { color: #ffc107; }
.bottom-nav .nav-item:nth-child(3).active i { color: #ff3b30; }
.bottom-nav .nav-item:nth-child(4).active i { color: #00bcd4; }

@keyframes bulbGlow {
  from { filter: brightness(1); }
  to { filter: brightness(1.6); }
}

/* ğŸ”¹ Ripple (same) */
.ripple {
  position: absolute;
  border-radius: 50%;
  transform: scale(0);
  animation: ripple 0.6s linear;
  background: rgba(0, 200, 83, 0.15);
}
@keyframes ripple {
  to { transform: scale(3); opacity: 0; }
}

/* ğŸ”¹ Responsive tuning */
@media (max-width: 480px) {
  .bottom-nav .nav-item i {
    font-size: 17px;
  }
  .bottom-nav .nav-item span {
    font-size: 9.5px;
  }
}
</style>

<!-- âœ… HTML Navbar -->
<div class="bottom-nav" id="mainNav">
  <a href="index.html" class="nav-item">
    <i class="ri-home-5-fill"></i>
    <span>Home</span>
  </a>

  <a href="login.html" class="nav-item">
    <i class="ri-bar-chart-2-fill"></i>
    <span>Mining</span>
  </a>

  <a href="login.html" class="nav-item">
    <i class="ri-gift-fill"></i>
    <span>Promotion</span>
  </a>

  <a href="login.html" class="nav-item">
    <i class="ri-user-3-fill"></i>
    <span>Account</span>
  </a>
</div>

<script>
/* ğŸŒ— Auto theme detect */
function detectTheme() {
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  document.documentElement.setAttribute("data-theme", prefersDark ? "dark" : "light");
}
detectTheme();
window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", detectTheme);

/* ğŸ’¡ Auto highlight based on page URL */
const currentPage = window.location.pathname.split("/").pop().toLowerCase();
document.querySelectorAll(".bottom-nav .nav-item").forEach(item => {
  const href = item.getAttribute("href")?.toLowerCase();
  if (currentPage === href) item.classList.add("active");
});

/* ğŸŒŠ Ripple effect + manual highlight */
document.querySelectorAll(".bottom-nav .nav-item").forEach((item) => {
  item.addEventListener("click", (e) => {
    // highlight
    document.querySelector(".bottom-nav .nav-item.active")?.classList.remove("active");
    item.classList.add("active");

    // ripple
    const ripple = document.createElement("span");
    ripple.classList.add("ripple");
    const rect = item.getBoundingClientRect();
    ripple.style.left = `${e.clientX - rect.left}px`;
    ripple.style.top = `${e.clientY - rect.top}px`;
    item.appendChild(ripple);
    setTimeout(() => ripple.remove(), 500);
  });
});
</script>




<script>
const tabs = document.querySelectorAll(".tab");
const sections = {
  phoneTab: document.getElementById("phoneForm"),
  emailTab: document.getElementById("emailForm"),
  userTab: document.getElementById("userForm"),
};
tabs.forEach(tab => {
  tab.addEventListener("click", () => {
    tabs.forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    Object.values(sections).forEach(s => s.classList.remove("active"));
    sections[tab.id].classList.add("active");
  });
});
</script>


<!-- ğŸ”¥ Firebase Script -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
import { collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";


const firebaseConfig = {
  apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
  authDomain: "btcinvest-c0e25.firebaseapp.com",
  projectId: "btcinvest-c0e25",
  storageBucket: "btcinvest-c0e25.firebasestorage.app",
  messagingSenderId: "204937458487",
  appId: "1:204937458487:web:cc27ece1249999279f60b2",
  measurementId: "G-HG0Q8ZHT6G"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// âœ… Get User's Public IP
async function getUserIP() {
  try {
    const res = await fetch("https://api.ipify.org?format=json");
    const data = await res.json();
    return data.ip;
  } catch (e) {
    console.error("âŒ Unable to fetch IP:", e);
    return "Unknown";
  }
}


const popup = document.getElementById('popup');
const popupOverlay = document.getElementById('popupOverlay');
function showPopup(msg, type = 'success') {
  popup.textContent = msg;
  popup.className = "popup " + type + " show";
  popupOverlay.style.display = 'flex';
  setTimeout(() => {
    popupOverlay.style.display = 'none';
    popup.className = "popup";
  }, 2000);
}

document.getElementById("toggle-password").addEventListener("click", () => {
  const pass = document.getElementById("login-password");
  pass.type = pass.type === "password" ? "text" : "password";
});


// âœ… Final Unified Live Validation (Phone + Email + Username)

const idFields = {
  phone: document.getElementById("login-identifier"),
  email: document.getElementById("email-login"),
  user: document.getElementById("user-login")
};

const idStatuses = {
  phone: document.getElementById("idStatus"),
  email: document.createElement("span"),
  user: document.createElement("span")
};

// ğŸ”§ Utility: message div create karna
function attachValidationField(input) {
  const msg = document.createElement("div");
  msg.className = "valid-msg";
  input.parentNode.appendChild(msg);
  return msg;
}

// âœ… Add message areas
const phoneMsg = attachValidationField(idFields.phone);
const emailMsg = attachValidationField(idFields.email);
const userMsg = attachValidationField(idFields.user);

let checkTimer;

// âš™ï¸ Common function for all input fields
function setupValidation(input, type, msg, statusIcon) {
  input.addEventListener("input", () => {
    clearTimeout(checkTimer);
    let value = input.value.trim();
    let error = "";

    // ğŸ§  Validation rules
    if (!value) {
      msg.textContent = "";
      msg.className = "valid-msg";
      input.classList.remove("valid", "invalid");
      if (statusIcon) statusIcon.textContent = "";
      return;
    }

    if (type === "phone") {
      value = value.replace(/\D/g, "");
      input.value = value;
      if (value.length !== 10) error = "Enter 10-digit phone number.";
    } else if (type === "email") {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(value)) error = "Enter a valid email address.";
    } else if (type === "user") {
      if (value.length < 3) error = "Username must be at least 3 characters.";
    }

    // ğŸ”´ Show local error OR ğŸŸ¢ Looks good
    if (error) {
      msg.textContent = error;
      msg.className = "valid-msg error";
      input.classList.add("invalid");
      input.classList.remove("valid");
      if (statusIcon) statusIcon.textContent = "";
      return;
    } else {
      msg.textContent = "Looks good!";
      msg.className = "valid-msg success";
      input.classList.add("valid");
      input.classList.remove("invalid");
    }

    // ğŸ” Firestore existence check after short delay
    if (value.length >= 3) {
      if (statusIcon) statusIcon.innerHTML = '<span class="spinner"></span>';
      checkTimer = setTimeout(() => checkUserExist(value, statusIcon), 600);
    }
  });
}

// ğŸ”¥ Firebase: user existence check
async function checkUserExist(value, statusIcon) {
  if (!value.trim()) {
    if (statusIcon) statusIcon.textContent = "";
    return;
  }

  try {
    const ref = doc(db, "logins", value.trim().toLowerCase());
    const snap = await getDoc(ref);

    if (snap.exists()) {
      statusIcon.textContent = "âœ…";
      statusIcon.className = "status-icon green active";
    } else {
      statusIcon.textContent = "âŒ";
      statusIcon.className = "status-icon red active";
    }
  } catch (e) {
    console.error("Firestore check error:", e);
    statusIcon.textContent = "âŒ";
    statusIcon.className = "status-icon red active";
  }
}

// âœ… Apply unified validation
setupValidation(idFields.phone, "phone", phoneMsg, idStatuses.phone);
setupValidation(idFields.email, "email", emailMsg, idStatuses.email);
setupValidation(idFields.user, "user", userMsg, idStatuses.user);


/* ğŸ”´ Real-time Password Check */
const passInput = document.getElementById("login-password");
const passStatus = document.getElementById("passStatus");
const phoneInput = document.getElementById("login-identifier"); // âœ… add this line

passInput.addEventListener("input", async () => {
  const identifier = phoneInput.value.trim().toLowerCase(); // âœ… change here
  const password = passInput.value;
  if (!identifier || password.length < 6) {
    passStatus.innerHTML = "";
    return;
  }

  passStatus.innerHTML = '<span class="spinner"></span>';
  const ref = doc(db, "logins", identifier);
  const snap = await getDoc(ref);
  if (!snap.exists()) { passStatus.innerHTML = "âŒ"; passStatus.className = "status-icon red active"; return; }

  const email = snap.data().email;
  try {
    await signInWithEmailAndPassword(auth, email, password);
    passStatus.textContent = "âœ…";
    passStatus.className = "status-icon green active";
  } catch {
    passStatus.textContent = "âŒ";
    passStatus.className = "status-icon red active";
  }
});



/* ğŸ•’ Button Countdown Function */
function startButtonCountdown(button, secondsLeft) {
  button.disabled = true;
  button.classList.add("locked");
  const originalHTML = button.innerHTML;

  function updateCountdown() {
    const minutes = Math.floor(secondsLeft / 60);
    const seconds = secondsLeft % 60;
    button.innerHTML = `<span>ğŸ”’ Locked (${minutes}:${seconds.toString().padStart(2, "0")})</span>`;
    secondsLeft--;

    if (secondsLeft < 0) {
      clearInterval(timer);
      button.disabled = false;
      button.classList.remove("locked");
      button.innerHTML = "Login";
      showPopup("ğŸ”“ Account unlocked. Try again.", "success");
    }
  }

  updateCountdown();
  const timer = setInterval(updateCountdown, 1000);
}


/* ğŸ” Forgot Password â€“ works for phone OR email */
document.getElementById("forgot-btn").addEventListener("click", async () => {
  const identifier = document.getElementById("login-identifier").value.trim().toLowerCase();


  if (!identifier) return showPopup("Enter phone number or email", "error");

  let emailToSend = identifier;

  // ğŸ” Agar user phone ya username daale to email Firestore se nikal le
  if (!identifier.includes("@")) {
    try {
      const ref = doc(db, "logins", identifier);
      const snap = await getDoc(ref);
      if (!snap.exists()) return showPopup("Account not found", "error");
      emailToSend = snap.data().email;
    } catch (err) {
      console.error(err);
      return showPopup("Error verifying account", "error");
    }
  }

  try {
    await sendPasswordResetEmail(auth, emailToSend);
    showPopup("Password reset link sent to your email.", "success");
  } catch (e) {
    console.error(e);
    showPopup("Error sending reset link.", "error");
  }
});


// ğŸ§  Email tab: toggle password visibility
document.getElementById("toggle-email-pass").addEventListener("click", () => {
  const pass = document.getElementById("email-password");
  pass.type = pass.type === "password" ? "text" : "password";
});

// ğŸ§  Email tab: forgot password
document.getElementById("forgot-email-btn").addEventListener("click", async () => {
  const email = document.getElementById("email-login").value.trim();
  if (!email.includes("@")) return showPopup("Enter valid email address", "error");
  try {
    await sendPasswordResetEmail(auth, email);
    showPopup("Password reset link sent to your email.", "success");
  } catch (e) {
    showPopup("Error sending reset link.", "error");
  }
});

// ğŸ§  Email tab: remember password feature
const emailField = document.getElementById("email-login");
const passwordField = document.getElementById("email-password");
const rememberBox = document.getElementById("remember-email");

// âœ… Load saved credentials on page load
window.addEventListener("DOMContentLoaded", () => {
  const savedEmail = localStorage.getItem("savedEmail");
  const savedPass = localStorage.getItem("savedPass");
  if (savedEmail && savedPass) {
    emailField.value = savedEmail;
    passwordField.value = savedPass;
    rememberBox.checked = true;
  }
});

// ğŸ‘¤ USERNAME TAB: toggle password visibility
document.getElementById("toggle-user-pass").addEventListener("click", () => {
  const pass = document.getElementById("user-password");
  pass.type = pass.type === "password" ? "text" : "password";
});

// ğŸ‘¤ USERNAME TAB: forgot password (via stored email in Firestore)
document.getElementById("forgot-user-btn").addEventListener("click", async () => {
  const username = document.getElementById("user-login").value.trim().toLowerCase();
  if (!username) return showPopup("Enter your username", "error");

  try {
    // username ke basis pe email nikal lo (Firestore se)
    const ref = doc(db, "logins", username);
    const snap = await getDoc(ref);
    if (!snap.exists()) return showPopup("User not found", "error");

    const email = snap.data().email;
    await sendPasswordResetEmail(auth, email);
    showPopup("Password reset link sent to your email.", "success");
  } catch (e) {
    console.error(e);
    showPopup("Error sending reset link.", "error");
  }
});

// ğŸ‘¤ USERNAME TAB: remember password feature
const userField = document.getElementById("user-login");
const userPassField = document.getElementById("user-password");
const rememberUserBox = document.getElementById("remember-user");

// âœ… Load saved username credentials
window.addEventListener("DOMContentLoaded", () => {

  const savedUser = localStorage.getItem("savedUser");
  const savedUserPass = localStorage.getItem("savedUserPass");
  if (savedUser && savedUserPass) {
    userField.value = savedUser;
    userPassField.value = savedUserPass;
    rememberUserBox.checked = true;
  }
});
/* ================= ğŸ”¥ UNIVERSAL LOGIN FUNCTION ================= */
async function universalLogin(identifier, password, loginBtn) {
  if (!identifier || !password) return showPopup("Please enter login details", "error");

  loginBtn.disabled = true;
  loginBtn.innerHTML = `<span class="spinner" style="margin-right:8px;"></span> Logging in...`;
  loginBtn.style.opacity = "0.8";

  try {
    let email = "";
    const dbIdentifier = identifier.trim().toLowerCase();

    // ğŸ” Identify email from input type (phone / username / direct email)
    if (dbIdentifier.includes("@")) {
      email = dbIdentifier;
    } else {
      const ref = doc(db, "logins", dbIdentifier);
      const snap = await getDoc(ref);
      if (!snap.exists()) {
        showPopup("Account not found", "error");
        return;
      }
      email = snap.data().email;
    }

    const userRef = doc(db, "users", email);
    const userSnap = await getDoc(userRef);
    const userData = userSnap.exists() ? userSnap.data() : {};
    const now = Date.now();
    const MAX_FAILED = 3;
    const LOCK_MINUTES = 15;

    // â›” Lock check
    const lockUntil = Number(userData.lockUntil || 0);
    if (lockUntil && now < lockUntil) {
      const remainingSeconds = Math.ceil((lockUntil - now) / 1000);
      startButtonCountdown(loginBtn, remainingSeconds);
      return;
    }

// âœ… Try Login
await signInWithEmailAndPassword(auth, email, password);

// âœ… Get current user IP
const userIP = await getUserIP();

// âœ… Find the user's Firestore document using email

const usersRef = collection(db, "users");
const q = query(usersRef, where("email", "==", email));
const snap = await getDocs(q);

if (!snap.empty) {
  const userDoc = snap.docs[0];
  const userData = userDoc.data();

  // âœ… Prepare update object
  const updates = {
    failedAttempts: 0,
    lockUntil: 0,
    lastLogin: new Date().toISOString()
  };

  // âœ… Agar IP missing hai ya Unknown hai, to add karo
  if (!userData.ipAddress || userData.ipAddress === "Unknown") {
    updates.ipAddress = userIP;
    console.log("âœ… IP updated successfully:", userIP);
  } else {
    console.log("â„¹ï¸ IP already exists:", userData.ipAddress);
  }

  // âœ… Firestore me ek hi updateDoc call se sab update
  await updateDoc(userDoc.ref, updates);

} else {
  console.warn("âš ï¸ No user found with email:", email);
}

// âœ… Success popup aur redirect
showPopup("âœ… Login successful!", "success");
setTimeout(() => (window.location.href = "Dashboard.html"), 1500);



  } catch (error) {
    console.error("Login error:", error);

    let email = "";
    const dbIdentifier = identifier.trim().toLowerCase();

    if (dbIdentifier.includes("@")) {
      email = dbIdentifier;
    } else {
      const ref = doc(db, "logins", dbIdentifier);
      const snap = await getDoc(ref);
      if (!snap.exists()) return showPopup("User not found", "error");
      email = snap.data().email;
    }

    const userRef = doc(db, "users", email);
    const userSnap = await getDoc(userRef);
    const userData = userSnap.exists() ? userSnap.data() : {};
    let newAttempts = (userData.failedAttempts || 0) + 1;
    const updates = { failedAttempts: newAttempts };

    const MAX_FAILED = 3;
    const LOCK_MINUTES = 15;

    if (newAttempts >= MAX_FAILED) {
      updates.lockUntil = Number(Date.now() + LOCK_MINUTES * 60 * 1000);
      showPopup(`âŒ Too many attempts! Locked for ${LOCK_MINUTES} minutes.`, "error");
      startButtonCountdown(loginBtn, LOCK_MINUTES * 60);
    } else if (newAttempts === MAX_FAILED - 1) {
      showPopup(`âš ï¸ One more wrong attempt will lock your account!`, "error");
    } else {
      showPopup("Incorrect password.", "error");
    }

    await setDoc(userRef, updates, { merge: true });

  } finally {
    loginBtn.disabled = false;
    loginBtn.innerHTML = "Login";
    loginBtn.style.opacity = "1";
  }
}

/* ================= âš™ï¸ BUTTON EVENTS ================= */

// ğŸ“± PHONE LOGIN
document.getElementById("loginBtn").addEventListener("click", () => {
  const identifier = document.getElementById("login-identifier").value;
  const password = document.getElementById("login-password").value;
  const loginBtn = document.getElementById("loginBtn");
  universalLogin(identifier, password, loginBtn);
});

// ğŸ“§ EMAIL LOGIN
document.getElementById("emailLoginBtn").addEventListener("click", () => {
  const identifier = document.getElementById("email-login").value;
  const password = document.getElementById("email-password").value;
  const loginBtn = document.getElementById("emailLoginBtn");
  universalLogin(identifier, password, loginBtn);
});

// ğŸ‘¤ USERNAME LOGIN
document.getElementById("userLoginBtn").addEventListener("click", () => {
  const identifier = document.getElementById("user-login").value;
  const password = document.getElementById("user-password").value;
  const loginBtn = document.getElementById("userLoginBtn");
  universalLogin(identifier, password, loginBtn);
});



document.querySelectorAll('.register-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    window.location.href = "register.html";
  });
});

</script>
<script>
  // ğŸš« Disable right click, select, drag
  document.addEventListener("contextmenu", e => e.preventDefault());
  document.addEventListener("selectstart", e => e.preventDefault());
  document.addEventListener("dragstart", e => e.preventDefault());

  // ğŸš« Disable keyboard shortcuts (copy, paste, inspect, etc.)
  document.addEventListener("keydown", e => {
    if (
      e.key === "F12" ||
      (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
      (e.ctrlKey && (e.key === "U" || e.key === "C" || e.key === "X" || e.key === "V" || e.key === "S"))
    ) {
      e.preventDefault();
      return false;
    }
  });

  // ğŸ”’ Silent DevTools detection (no popup)
  (function() {
    const devtools = /./;
    devtools.toString = function() {
      return ""; // no alert or console log
    };
    console.log("%c", devtools);
  })();

  // ğŸ” Detect DevTools using resize trick (no popup)
  setInterval(() => {
    const threshold = 160;
    const widthDiff = window.outerWidth - window.innerWidth > threshold;
    const heightDiff = window.outerHeight - window.innerHeight > threshold;
    if (widthDiff || heightDiff) {
      // Optional: silently redirect or blank the page
      document.body.innerHTML = "";
    }
  }, 1000);

  // ğŸ§± Disable copy/paste/cut
  ["copy", "paste", "cut"].forEach(evt =>
    document.addEventListener(evt, e => e.preventDefault())
  );

  // ğŸ” Freeze console methods silently
  Object.freeze(console);
  Object.freeze(window.console);
</script>
</body>
</html>


