<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Full Mining History</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<style>
body {
  background:#f5f7fa;
  font-family: 'Segoe UI', sans-serif;
  padding:20px;
  max-width:450px;
  margin:auto;
}

h2 {
  text-align:center;
  color:#28a745;
  margin-bottom:20px;
}

.history-card {
  background:#fff;
  border:1px solid #e2e2e2;
  padding:14px;
  border-radius:10px;
  margin-bottom:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
}

.amount { font-size:15px; font-weight:600; color:#111; }
.profit { color:#28a745; font-weight:600; margin-top:6px; }
.time { color:#666; font-size:12px; margin-top:4px; }
</style>
</head>

<body>

<h2>Full Mining History</h2>
<div id="fullMiningList"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
  authDomain: "btcinvest-c0e25.firebaseapp.com",
  projectId: "btcinvest-c0e25",
  storageBucket: "btcinvest-c0e25.appspot.com",
  messagingSenderId: "204937458487",
  appId: "1:204937458487:web:cc27ece1249999279f60b2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const list = document.getElementById("fullMiningList");

onAuthStateChanged(auth, (user) => {
  if (!user) return location.href="auth.html";

  const q = query(
    collection(db, "users", user.uid, "miningHistory"),
    orderBy("time", "desc")
  );

  onSnapshot(q, (snap) => {
    list.innerHTML = "";

    if (snap.empty) {
      list.innerHTML = "<p>No mining history found.</p>";
      return;
    }

    snap.forEach((d) => {
      const data = d.data();
      const date = new Date(data.time).toLocaleString();

      const div = document.createElement("div");
      div.className = "history-card";
      div.innerHTML = `
        <div class="amount">‚õèÔ∏è Amount: $${data.amount.toFixed(2)}</div>
        <div class="profit">Profit: +$${data.earned.toFixed(4)}</div>
        <div class="time">üìÖ ${date}</div>
      `;
      list.appendChild(div);
    });
  });
});
</script>
</body>
</html>
