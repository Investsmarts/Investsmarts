<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" 
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Deposit</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <!-- ‚úÖ BTCInvest Auto Smart Bottom Navbar -->
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet">

  <style>
    html, body {
  width: 100%;
  max-width: 100%;
  overflow-x: hidden !important;
}

    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding-bottom: 100px;
      color: #333;
    }

/* üî• Dashboard Container */
.dashboard {
  max-width: 420px;
  margin: 20px auto;
  padding: 15px;
}

/* üî• Info Card */
.info-card {
  background: #fff;
  border-radius: 5px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  text-align: left;
}
.info-card h3 {
  margin-bottom: 12px;
  color: #ff00d9;
}
.info-card .row {
  display: flex;
  justify-content: space-between;
  margin: 8px 0;
}
.info-card .row span.label {
  font-weight: 500;
}
.info-card .row span.value {
  font-weight: bold;
  color: #444;
}

/* ‚úÖ Popup etc (same as before) */
.popup-overlay {
  position: fixed;
  inset: 0;                 /* üî• top right bottom left = 0 */
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 2000;

  padding-bottom: 80px;     /* ‚úÖ navbar se upar rahe */
}

/* ‚úÖ Popup box center me chhota rahe */
.popup {
  background: #fff;
  border-radius: 5px;
  padding: 20px;
  width: 90%;
  max-width: 360px;

  max-height: calc(100dvh - 120px);   /* üî• REAL viewport height */
  min-height: fit-content;            /* üî• content ko force dikhao */

  overflow-y: auto;
  overflow-x: hidden;

  text-align: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);

  display: flex;
  flex-direction: column;
  align-items: center;
  box-sizing: border-box;
}


@keyframes fadeIn {
  from {opacity: 0; transform: scale(0.9);}
  to {opacity: 1; transform: scale(1);}
}

.qr-code {
  margin: 15px auto;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 5px;
  background: #fafafa;

  display: flex;              /* ‚úÖ center fix */
  justify-content: center;
  align-items: center;

  max-width: 100%;
  overflow: hidden;
}

/* üî• QR canvas MUST be square */
.qr-code canvas {
  width: 160px !important;
  height: 160px !important;
  max-width: 100%;
}
@media (max-width: 360px) {
  .qr-code canvas {
    width: 140px !important;
    height: 140px !important;
  }
}


.address-box {
  background: #f5f7fa;
  padding: 8px 10px;
  border-radius: 5px;
  font-size: 13px;
  margin: 8px 0;
  width: 100%;
  text-align: center;

  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.amount-input {
  width: 100%;
  padding: 10px;
  margin-top: 12px;
  border: 1px solid #ccc;
  border-radius: 5px;
  font-size: 15px;
  outline: none;
  text-align: center;
}

.copy-btn {
  background: #28a745;
  color: #fff;
  padding: 10px;
  border: none;
  border-radius: 10px;
  margin-top: 12px;
  cursor: pointer;
  font-weight: bold;
  width: 100%;
  font-size: 15px;
}

.action-buttons {
  display: flex;
  gap: 10px;
  margin-top: 12px;
  width: 100%;
}
.action-buttons button {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  color: #fff;
  font-size: 15px;
}
.close-btn { background: #dc3545; }
.paid-btn { background: #007bff; }


/* History */
.history-section {margin-top:30px;}
.history-card {background:#fff;border-radius:5px;padding:15px;margin-bottom:15px;box-shadow:0 4px 12px rgba(0,0,0,0.08);font-size:14px;}
.history-card-header {display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.badge {background:#28a745;color:#fff;padding:3px 10px;border-radius:6px;font-weight:bold;font-size:13px;}
.status.complete {color:green;font-weight:bold;}
.status.pending {color:#ff8800;font-weight:bold;}
.status.canceled {color:red;font-weight:bold;}
.status.paid {color:#007bff;font-weight:bold;}
.history-card-row {display:flex;justify-content:space-between;margin:6px 0;}
.history-card-row span.label {font-weight:600;color:#444;}
.history-card-row span.value {font-weight:bold;color:#ff8800;}
.history-card-row small {color:#666;}

/* Popup alerts */
.thankyou-popup,.error-popup {position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);padding:12px 20px;border-radius:10px;font-weight:bold;box-shadow:0 6px 20px rgba(0,0,0,0.3);z-index:3000;display:none;animation:fadeInOut 1.5s ease forwards;}


/* üîÑ 3D Verifying Payment Popup */
.verify-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.9);
  background: linear-gradient(135deg, #1b5e20, #2ecc71);
  color: #fff;
  padding: 30px 45px;
  border-radius: 18px;
  border: 3px solid #0f3d14;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4),
              inset 0 3px 8px rgba(255,255,255,0.15),
              inset 0 -4px 10px rgba(0,0,0,0.25);
  text-align: center;
  display: none;
  z-index: 3000;
  perspective: 1000px;
  animation: popupIn 0.4s ease forwards;
}

/* Title Text */
.verify-popup p {
  margin-top: 14px;
  font-size: 17px;
  font-weight: 600;
  letter-spacing: 0.5px;
}

/* ‚úÖ 3D Rotating Progress Ring */
.verify-ring {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  border: 6px solid rgba(255,255,255,0.2);
  border-top-color: #fff;
  animation: spin 1s linear infinite;
  margin: 0 auto 10px;
  box-shadow: 0 0 15px rgba(255,255,255,0.3),
              inset 0 0 10px rgba(255,255,255,0.1);
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes popupIn {
  0% {opacity: 0; transform: translate(-50%, -50%) scale(0.6) rotateX(40deg);}
  60% {opacity: 1; transform: translate(-50%, -50%) scale(1.05) rotateX(0);}
  100% {transform: translate(-50%, -50%) scale(1) rotateX(0);}
}

/* üí´ Outer glow effect */
.verify-popup::after {
  content: "";
  position: absolute;
  inset: -4px;
  border-radius: 20px;
  border: 2px solid rgba(255,255,255,0.25);
  box-shadow: 0 0 12px rgba(255,255,255,0.25),
              0 0 30px rgba(40,167,69,0.6);
  animation: borderGlow 2s infinite alternate ease-in-out;
}

@keyframes borderGlow {
  0% { box-shadow: 0 0 15px rgba(40,167,69,0.4), 0 0 25px rgba(32,201,151,0.3); }
  100% { box-shadow: 0 0 25px rgba(40,167,69,0.8), 0 0 50px rgba(32,201,151,0.6); }
}

/* ‚úÖ Verified Message Transition */
.verify-popup.done .verify-ring {
  border-color: #fff;
  border-top-color: #fff;
  animation: none;
  position: relative;
}
.verify-popup.done .verify-ring::after {
  content: "‚úî";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -52%);
  font-size: 32px;
  font-weight: bold;
  color: #fff;
}



/* Refresh Button */



/* Glow dot under active item */
.nav-item.active::after {
  content: "";
  position: absolute;
  bottom: -3px;
  left: 50%;
  transform: translateX(-50%);
  width: 6px;
  height: 6px;
  background: #00c853;
  border-radius: 5px;
  box-shadow: 0 0 8px rgba(0, 200, 83, 0.4);
}

/* Responsive fix */
@media(max-width:600px){
  .bottom-nav {
    border-radius: 5px;
    padding: 8px 0;
  }
  .nav-item i {
    font-size: 20px;
  }
}
.btn-deposit {
  background: #28a745;   /* Green */
  color: #fff;
  padding: 12px 20px;
  font-size: 16px;
  font-weight: bold;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  transition: 0.3s;
  width: 100%;           /* ‚úÖ card ke hisaab se fit */
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;    
}
.btn-deposit:hover {
  background: #218838;   /* Darker Green on hover */
}

/* ‚úÖ Balance Card */
.balance-card {
  background: linear-gradient(135deg, #28a745, #20c997);
  border-radius: 5px;
  padding: 20px;
  color: #fff;
  display: flex;
  align-items: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  margin-bottom: 20px;
}
.balance-icon {
  font-size: 48px;
  margin-right: 15px;
}
.balance-info h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
}
.balance-info .amount {
  font-size: 26px;
  font-weight: bold;
  margin: 5px 0;
}
.balance-info small {
  font-size: 14px;
  opacity: 0.9;
}

/* White card style for heading + refresh */
.history-header-box {
  background: #fff;
  border-radius: 5px;
  padding: 12px 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  display: flex;
  justify-content: space-between;
  justify-content: space-between; /* left-right alignment */
  align-items: center;
  margin-bottom: 20px;
  border: 1.5px solid #c3e6cb; 
}

/* Heading text */
.history-header-box .title {
  color: #28a745;   /* green heading */
  font-size: 18px;
  font-weight: 600;
}

/* Refresh button */
.refresh-btn {
  background: #17a2b8;
  color: #fff;
  padding: 8px 14px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  font-size: 14px;
}
.refresh-btn:hover {
  background: #138496;
}
 /*  button */
.deposit-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 15px;
  gap: 10px;
  margin: 20px 0;  
}

.action-btn {
  flex: 1;
  background: #fff;
  border-radius: 5px;
  padding: 12px;
  text-align: center;
  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
  cursor: pointer;
  transition: 0.3s;
}

.action-btn i {
  font-size: 22px;
  color: #28a745;  /* green icon */
  display: block;
  margin-bottom: 5px;
}

.action-btn span {
  font-size: 14px;
  font-weight: 500;
  color: #333;
}

.action-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 12px rgba(0,0,0,0.12);
}
/*animition card*/
.instruction-card {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  background: #fff;
  border: 1.5px solid #28a745;  /* green border */
  border-radius: 5px;
  padding: 12px 16px;
  margin: 15px 0;
  font-size: 14px;
  font-weight: 500;
  color: #28a745;
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  animation: slideIn 0.5s ease;
}

/* Icon Style */
.instruction-card i {
  font-size: 20px;
  color: #28a745;
  animation: pulse 1.5s infinite; /* glowing animation */
}

/* Text */
.instruction-card span {
  flex: 1;
}

/* Slide-in Animation */
@keyframes slideIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Pulse Animation for Icon */
@keyframes pulse {
  0% { transform: scale(1); opacity: 0.8; }
  50% { transform: scale(1.2); opacity: 1; }
  100% { transform: scale(1); opacity: 0.8; }
}
.info-text-box {
  border: 1.8px solid #28a745;   /* Green border */
  background: #f9fffa;           /* Halka green background */
  color: #28a745;                /* Green text */
  padding: 12px 14px;
  border-radius: 5px;
  font-size: 14px;
  font-weight: 500;
  margin: 12px 0 18px 0;         /* Gap top & bottom */
  text-align: center;            /* Center align */
  line-height: 1.5;

}

:root {
  --nav-bg: #fff;
  --nav-text: #444;
  --nav-border: rgba(0, 0, 0, 0.08);
}

[data-theme="dark"] {
  --nav-bg: #0f0f0f;
  --nav-text: #ccc;
  --nav-border: rgba(255, 255, 255, 0.1);
}

/* üîπ Navbar Base (height reduced) */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: var(--nav-bg);
  border-top: 1px solid var(--nav-border);
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 10px 0; /* üëà thinner padding */
  z-index: 9999;
  box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.05);
}

/* üîπ Nav items (slimmer text + less spacing) */
.bottom-nav .nav-item {
  flex: 1;
  text-align: center;
  color: var(--nav-text);
  text-decoration: none;
  font-size: 10px; /* üëà smaller text */
  position: relative;
  padding: 4px 0; /* üëà less padding */
  transition: all 0.3s ease;
}

/* üîπ Icon (reduced size + gap) */
.bottom-nav .nav-item i {
  font-size: 18px; /* üëà smaller icons (was 22px) */
  display: block;
  opacity: 0.75;
  margin-bottom: 2px; /* üëà smaller gap */
  transition: all 0.3s ease;
}

/* üîπ Text */
.bottom-nav .nav-item span {
  opacity: 0.7;
  transition: all 0.3s ease;
}

/* üîπ Divider lines */
.bottom-nav .nav-item:not(:last-child)::after {
  content: "";
  position: absolute;
  right: 0;
  top: 25%;
  width: 1px;
  height: 50%;
  background: var(--nav-border);
}

/* üîπ Active State (icons glow thoda soft) */
.bottom-nav .nav-item.active i {
  transform: scale(1.1);
  opacity: 1;
  animation: bulbGlow 1.6s ease-in-out infinite alternate;
}
.bottom-nav .nav-item.active span {
  opacity: 1;
  font-weight: 600;
}

/* Active colors */
.bottom-nav .nav-item:nth-child(1).active i { color: #00c853; }
.bottom-nav .nav-item:nth-child(2).active i { color: #ffc107; }
.bottom-nav .nav-item:nth-child(3).active i { color: #ff3b30; }
.bottom-nav .nav-item:nth-child(4).active i { color: #00bcd4; }

@keyframes bulbGlow {
  from { filter: brightness(1); }
  to { filter: brightness(1.6); }
}

/* üîπ Ripple (same) */
.ripple {
  position: absolute;
  border-radius: 50%;
  transform: scale(0);
  animation: ripple 0.6s linear;
  background: rgba(0, 200, 83, 0.15);
}
@keyframes ripple {
  to { transform: scale(3); opacity: 0; }
}

/* üîπ Responsive tuning */
@media (max-width: 480px) {
  .bottom-nav .nav-item i {
    font-size: 17px;
  }
  .bottom-nav .nav-item span {
    font-size: 9.5px;
  }
}

  .copy-success {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.9);
  background: #fff;
  padding: 22px 26px;
  border-radius: 14px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.25);
  text-align: center;
  z-index: 5000;
  display: none;
  animation: popIn 0.3s ease forwards;
}

.copy-success p {
  margin: 10px 0 0;
  font-weight: 600;
  color: #2e7d32;
  font-size: 15px;
}

.tick-circle {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  background: #2ecc71;
  color: #fff;
  font-size: 28px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: auto;
}

@keyframes popIn {
  from { opacity: 0; transform: translate(-50%, -50%) scale(0.7); }
  to   { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}


/* üîî Amount Attention Animation */
@keyframes shakeBulb {
  0% { transform: translateX(0); }
  20% { transform: translateX(-6px); }
  40% { transform: translateX(6px); }
  60% { transform: translateX(-4px); }
  80% { transform: translateX(4px); }
  100% { transform: translateX(0); }
}

.amount-input.attention {
  border: 2px solid #ff3b30 !important;
  animation: shakeBulb 0.45s ease;
  box-shadow: 0 0 0 4px rgba(255,59,48,0.15);
}

/* üö® Amount Missing Popup */
.alert-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.9);
  background: #fff;
  padding: 22px 26px;
  border-radius: 16px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.3);
  text-align: center;
  z-index: 6000;
  display: none;
  animation: alertPop 0.25s ease forwards;
}

.alert-popup p {
  margin: 10px 0 0;
  font-size: 15px;
  font-weight: 600;
  color: #d32f2f;
}

.alert-icon {
  font-size: 32px;
}

@keyframes alertPop {
  from {
    opacity: 0;
    transform: translate(-50%, -55%) scale(0.7);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

/* üîî Shake animation (bulb style) */
@keyframes shakeBulb {
  0% { transform: translateX(0); }
  20% { transform: translateX(-6px); }
  40% { transform: translateX(6px); }
  60% { transform: translateX(-4px); }
  80% { transform: translateX(4px); }
  100% { transform: translateX(0); }
}

.amount-input.attention {
  border: 2px solid #d32f2f !important;
  animation: shakeBulb 0.45s ease;
  box-shadow: 0 0 0 4px rgba(211,47,47,0.18);
}


</style>
</head>
<body>
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

 <div class="dashboard">
    <!-- ‚úÖ Total Deposit Card -->
    <div class="balance-card">
      <div class="balance-icon">
        <i class='bx bxs-dollar-circle'></i>
      </div>
      <div class="balance-info">
        <h3>Total Deposit (USDT)</h3>
        <p class="amount">$<span id="totalDeposit">0.00</span></p>
        <small id="userLevel">My Level: No Level</small>
      </div>
    </div>

    <!-- Animated Instruction Card -->
<div class="instruction-card" id="instructionCard">
  <i class='bx bx-info-circle'></i>
  <span>Send the exact amount you have entered</span>
</div>


<!-- ‚úÖ icone Deposit Card -->
 <div class="deposit-actions">
  <div class="action-btn" onclick="openPopup()">
    <i class='bx bx-credit-card'></i>
    <span>Deposit</span>
  </div>
  <div class="action-btn" onclick="scrollToHistory()">
    <i class='bx bx-list-ul'></i>
    <span>History</span>
  </div>
  <div class="action-btn" onclick="scanFeature()">
    <i class='bx bx-scan'></i>
    <span>Scan</span>
  </div>
</div>

<script>
function scrollToHistory() {
  document.querySelector('.history-section').scrollIntoView({ behavior: 'smooth' });
}

function scanFeature() {
  alert('QR Scan feature coming soon!');
}
</script>

 <!-- Deposit Info -->
<div class="info-card">
  <h3>Deposit Section</h3>

  <!-- ‚úÖ Green Info Box -->
  <div class="info-text-box">
    Click below to get your <b>BEP20 deposit address</b> with QR code.
  </div>

  <button class="btn-deposit" onclick="openPopup()">
    <i class='bx bx-qr'></i> Get Deposit Address
  </button>
  </div>

<!-- History -->
<div class="history-section">
  <div class="history-header-box">
    <span class="title">Deposit History</span>
    <button class="refresh-btn" onclick="manualRefresh()">üîÑ Refresh</button>
  </div>
  <div id="historyList">
    <p style="text-align:center; color:#666;">Loading...</p>
  </div>
 </div>
</div>
  
  <div class="copy-success" id="copySuccess">
  <div class="tick-circle">‚úî</div>
  <p>Address copied successfully</p>
</div>

  <!-- ‚úÖ Popup -->
   <div class="popup-overlay" id="popupOverlay">
    <div class="popup">
      <h2>Deposit Funds</h2>
      <input type="number" id="depositAmount" class="amount-input" placeholder="Enter amount to deposit">
      <div id="amountInstruction" class="amount-instruction"></div>
      <div id="qrcode" class="qr-code"></div>

       <div class="address-box" id="depositAddress"></div>



      <button class="copy-btn" onclick="copyAddress()">Copy Address</button>
      <div class="action-buttons">
        <button class="close-btn" onclick="cancelDeposit()">Cancel</button>
        <button class="paid-btn" onclick="markPaid()">I Have Paid</button>
      </div>
    </div>
   </div>

<div class="verify-popup" id="verifyPopup">
  <div class="verify-ring"></div>
  <p id="verifyText">Verifying your payment<br>Please wait patiently...</p>
</div>

  <div class="error-popup" id="errorPopup">Enter valid amount</div>

<div class="alert-popup" id="amountAlert">
  <div class="alert-icon">‚ö†Ô∏è</div>
  <p>Please enter amount first</p>
</div>

<audio id="alertSound" preload="auto">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.mp3" type="audio/mpeg">
</audio>




<!-- ‚úÖ HTML Navbar -->
<div class="bottom-nav" id="mainNav">
  <a href="Dashboard.html" class="nav-item">
    <i class="ri-home-5-fill"></i>
    <span>Home</span>
  </a>

  <a href="mining.html" class="nav-item">
    <i class="ri-bar-chart-2-fill"></i>
    <span>Mining</span>
  </a>

  <a href="promotion.html" class="nav-item">
    <i class="ri-gift-fill"></i>
    <span>Promotion</span>
  </a>

  <a href="account.html" class="nav-item">
    <i class="ri-user-3-fill"></i>
    <span>Account</span>
  </a>
</div>

<script>
/* üåó Auto theme detect */
function detectTheme() {
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  document.documentElement.setAttribute("data-theme", prefersDark ? "dark" : "light");
}
detectTheme();
window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", detectTheme);

/* üí° Auto highlight based on page URL */
const currentPage = window.location.pathname.split("/").pop().toLowerCase();
document.querySelectorAll(".bottom-nav .nav-item").forEach(item => {
  const href = item.getAttribute("href")?.toLowerCase();
  if (currentPage === href) item.classList.add("active");
});

/* üåä Ripple effect + manual highlight */
document.querySelectorAll(".bottom-nav .nav-item").forEach((item) => {
  item.addEventListener("click", (e) => {
    // highlight
    document.querySelector(".bottom-nav .nav-item.active")?.classList.remove("active");
    item.classList.add("active");

    // ripple
    const ripple = document.createElement("span");
    ripple.classList.add("ripple");
    const rect = item.getBoundingClientRect();
    ripple.style.left = `${e.clientX - rect.left}px`;
    ripple.style.top = `${e.clientY - rect.top}px`;
    item.appendChild(ripple);
    setTimeout(() => ripple.remove(), 500);
  });
});
</script>




  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <!-- ‚úÖ Firebase + Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, getDoc, serverTimestamp, query, orderBy, doc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";


    const firebaseConfig = {
      apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
      authDomain: "btcinvest-c0e25.firebaseapp.com",
      projectId: "btcinvest-c0e25",
      storageBucket: "btcinvest-c0e25.appspot.com",
      messagingSenderId: "204937458487",
      appId: "1:204937458487:web:cc27ece1249999279f60b2",
      measurementId: "G-HG0Q8ZHT6G"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const popupOverlay = document.getElementById("popupOverlay");
    const depositAddressEl = document.getElementById("depositAddress");
    const qrCodeEl = document.getElementById("qrcode");
    const historyList = document.getElementById("historyList");
    const thankyouPopup = document.getElementById("thankyouPopup");
    const errorPopup = document.getElementById("errorPopup");
    const instructionEl = document.getElementById("amountInstruction");

    function generateOrderId() {
      const randomNum = Math.floor(1000000000 + Math.random() * 9000000000);
      return "DPBHGR" + randomNum + "G";
    }

    const depositAddresses = [
      "0x6cf5f8F9564205C6AB3dE1694F54374e70dD135A",
      "0x9ad288c9835Cfe30141677444A0A637a434Cd9bC",
      "0x9d6Dc16a1E5aC1CC3b4e7F500f4BdB51D8fBc301",
      "0x1E807c2AeC3165C37A8b47034839654033bD8cf2"
      ];

    let currentDepositAddress = "";
    let currentUserId = null;
    let currentDepositId = null;

    function showError(msg) {
      errorPopup.textContent = msg;
      errorPopup.style.display = "block";
      setTimeout(() => { errorPopup.style.display = "none"; }, 1500);
    }

    // ‚úÖ QR Code ko update karne ka function
    function updateQRCode() {
      const amountInput = document.getElementById("depositAmount");
      const amount = parseFloat(amountInput.value) || 0;
      let qrText = `${currentDepositAddress}`;


      if (amount > 0) {
        if (amount < 200) {
      // ‚ùå Agar 200 se kam hai ‚Üí red border + error
          amountInput.style.border = "2px solid red";
      qrCodeEl.innerHTML = ""; // QR mat banao
      return;
    } else {
      // ‚úÖ Agar 200 ya zyada hai ‚Üí green border + QR with amount
      amountInput.style.border = "2px solid green";
      qrText += `?value=${amount}`;
    }
  } else {
    // Default border grey
    amountInput.style.border = "1px solid #ccc";
  }

  qrCodeEl.innerHTML = ""; // purana QR clear karo
  new QRCode(qrCodeEl, {text: qrText, width: 160,height: 160});

}


window.openPopup = function() {
  localStorage.setItem("deposit_popup_open", "yes");
  popupOverlay.style.display = "flex";
  const amountInput = document.getElementById("depositAmount");
  amountInput.value = "";
  amountInput.disabled = false;
  amountInput.style.border = "1px solid #ccc"; // reset border
  instructionEl.style.display = "none";

  const savedAmount = localStorage.getItem("deposit_amount");
if (savedAmount) {
  amountInput.value = savedAmount;
  updateQRCode(); // QR bhi restore
}

// üëá YE ADD KARO
amountInput.oninput = () => {
  localStorage.setItem("deposit_amount", amountInput.value);
  updateQRCode();
};

  // ‚úÖ Random deposit address set karo
  currentDepositAddress = depositAddresses[Math.floor(Math.random() * depositAddresses.length)];
  depositAddressEl.textContent = currentDepositAddress;

  // ‚úÖ Default QR (sirf address)
  updateQRCode();


  // ‚ùå Yahan ab koi entry Firestore me create nahi hogi
  currentDepositId = null; // reset kar do, jab tak user pay na kare
};

// ‚ùå Cancel: kuch bhi Firebase me save mat karo

window.cancelDeposit = function() {
  popupOverlay.style.display = "none";
  qrCodeEl.innerHTML = "";
  currentDepositId = null; // clear current deposit id
  
  localStorage.removeItem("deposit_popup_open");
  localStorage.removeItem("deposit_amount");

};

// ‚úÖ Copy address as usual
window.copyAddress = function () {
  const amountInput = document.getElementById("depositAmount");
  const amount = parseFloat(amountInput.value);

  // ‚ùå Amount missing
  if (!amount || amount <= 0) {
    const popup = document.getElementById("amountAlert");
    const sound = document.getElementById("alertSound");

    // üîî play google beep
    sound.currentTime = 0;
    sound.play().catch(()=>{});

    // üîÅ shake input
    amountInput.classList.remove("attention");
    void amountInput.offsetWidth; // reflow
    amountInput.classList.add("attention");

    // üö® show popup
    popup.style.display = "block";

    setTimeout(() => {
      popup.style.display = "none";
      amountInput.classList.remove("attention");
    }, 1800);

    // üëÄ focus input
    amountInput.focus();

    return; // ‚ùå STOP COPY
  }

  // ‚úÖ Amount present ‚Üí copy
  navigator.clipboard.writeText(currentDepositAddress);

  const box = document.getElementById("copySuccess");
  box.style.display = "block";

  setTimeout(() => {
    box.style.display = "none";
  }, 1800);
};


// ‚úÖ Entry tabhi create karo jab user "I Have Paid" dabaye
window.markPaid = async function () {
  const amountInput = document.getElementById("depositAmount");
  const amount = parseFloat(amountInput.value) || 0;
  
  localStorage.removeItem("deposit_popup_open");
  localStorage.removeItem("deposit_amount");

 

  if (amount <= 0) {
    showError("Enter valid amount");
    return;
  }
  if (amount < 200) {
    showError("Minimum is $200");
    amountInput.style.border = "2px solid red";
    return;
  }
    // ‚úÖ Instead of thankyouPopup, call verifying popup
  showVerificationPopup();

  amountInput.disabled = true;
  instructionEl.style.display = "block";
  instructionEl.textContent = `Send the exact amount you entered: $${amount}`;

  popupOverlay.style.display = "none";
  qrCodeEl.innerHTML = "";

  if (currentUserId) {
    const orderId = generateOrderId();

    const ref = await addDoc(collection(db, "users", currentUserId, "deposits"), {
      amount: amount,
      address: currentDepositAddress,
      date: serverTimestamp(),
      status: "I Have Paid",
      orderId: orderId
    });

    currentDepositId = ref.id;
    watchDepositStatus(currentUserId, currentDepositId);
    loadDepositHistory(currentUserId);
  }
} // ‚Üê ye closing bracket zaroor lagani hai yahaan

// üëá iske baad likh showVerificationPopup() function
function showVerificationPopup() {
  const popup = document.getElementById("verifyPopup");
  const text = document.getElementById("verifyText");

  popup.style.display = "block";
  popup.classList.remove("done");
  text.innerHTML = "Verifying your payment<br>Please wait patiently...";

  setTimeout(() => {
    popup.classList.add("done");
    text.textContent = "Payment crediting soon...";
  }, 4000);

  setTimeout(() => {
    popup.style.display = "none";
  }, 8000);
}

    // ‚úÖ Referral Commission + Wallet Reward Logic (Fixed Double Reward Issue)
   const rewardLock = {}; // global lock to stop duplicate triggers

   async function giveReferralCommission(userId, depositAmount, depositId) {
  try {
    // üß† Lock check - agar ye depositId already process ho raha hai, skip karo
    if (rewardLock[depositId]) {
      console.log(`‚ö†Ô∏è Skipping duplicate trigger for ${depositId}`);
      return;
    }
    rewardLock[depositId] = true; // lock set

    const userRef = doc(db, "users", userId);
    const userSnap = await getDoc(userRef);
    if (!userSnap.exists()) return;

    const userData = userSnap.data();

    // ‚úÖ Uplines fetch
    const uplines = [
      userData.upline1 || null,
      userData.upline2 || null,
      userData.upline3 || null,
    ].filter(Boolean);

    console.log("üß© Uplines found for", userId, "‚Üí", uplines);

    // ‚úÖ Commission percentage (3%, 2%, 1%)
    const commissionRates = [0.03, 0.02, 0.01];

    for (let level = 0; level < uplines.length; level++) {
      const refUID = uplines[level];
      if (!refUID) continue;

      const refUserRef = doc(db, "users", refUID);
      const refUserSnap = await getDoc(refUserRef);
      if (!refUserSnap.exists()) continue;

      const refData = refUserSnap.data();
      const refLifetime = parseFloat(refData.lifetimeDeposit || 0);

      // üß† Qualification check: upline must have lifetime >= user deposit
      if (refLifetime < depositAmount) {
    console.log(
    `‚ö†Ô∏è Level ${level + 1}: Upline ${refUID} not qualified (lifetimeDeposit=${refLifetime}, required=${depositAmount})`
   );

   // üß© Get depositor's name for better message
const depositorRef = doc(db, "users", userId);
const depositorSnap = await getDoc(depositorRef);
const depositorName = depositorSnap.exists() && depositorSnap.data().name
  ? depositorSnap.data().name
  : userId; // fallback to UID if no name

// üì® Create notification with actual name
await addDoc(collection(db, "users", refUID, "rewardNotifications"), {
  fromUser: userId,
  fromName: depositorName, // ‚úÖ Added
  depositAmount: depositAmount,
  requiredDeposit: depositAmount,
  currentDeposit: refLifetime,
  message: `You missed a referral reward from ${depositorName} because your lifetime deposit ($${refLifetime}) is lower than their deposit ($${depositAmount}).`,
  level: level + 1,
  date: serverTimestamp(),
  status: "pending"
});

   continue; // skip reward
  }


      const commission = depositAmount * commissionRates[level];
      const commissionFixed = parseFloat(commission.toFixed(2));

      // ‚úÖ Check agar ye depositId se reward already diya gaya hai
      const commSnap = await getDocs(collection(db, "users", refUID, "commissions"));
      const alreadyGiven = commSnap.docs.some(
        (d) => d.data().fromUser === userId && d.data().depositId === depositId
      );
      if (alreadyGiven) {
        console.log(`‚ö†Ô∏è Level ${level + 1}: Commission already given for ${depositId}`);
        continue;
      }

      // ‚úÖ Add commission record (proof)
      await addDoc(collection(db, "users", refUID, "commissions"), {
        fromUser: userId,
        depositId: depositId,
        level: level + 1,
        amount: commissionFixed,
        date: serverTimestamp(),
        note: `Level ${level + 1} reward from ${userId}'s first deposit (qualified)`,
      });

      // ‚úÖ Wallet update
      const newWallet = parseFloat(refData.walletBalance || 0) + commissionFixed;
      const newLifetime = parseFloat(refData.lifetimeReferralIncome || 0) + commissionFixed;

      await updateDoc(refUserRef, {
        walletBalance: newWallet,
        lifetimeReferralIncome: newLifetime,
      });

      console.log(`‚úÖ Level ${level + 1}: $${commissionFixed} given to ${refUID}`);
    }

    console.log(`üéØ Referral reward successfully processed for ${depositId}`);

  } catch (err) {
    console.error("‚ùå Error in giveReferralCommission:", err);
  } finally {
    delete rewardLock[depositId]; // unlock after done
  }
 }




   // ‚úÖ Watch deposit status and give commission only on first approved deposit
function watchDepositStatus(userId, depositId) {
  const depositRef = doc(db, "users", userId, "deposits", depositId);

  onSnapshot(depositRef, async (snap) => {
    const data = snap.data();
    if (!data) return;

    const status = (data.status || "").toLowerCase();

    // üîí already processed ‚Üí stop immediately
    if (data.rewardGiven) return;

    // ‚úÖ Trigger only when deposit is approved/completed
    if (["completed", "approved", "success", "done"].includes(status)) {

      try {
        const amount = parseFloat(data.amount || 0);
        if (amount < 200) return;

        // üß† Fetch all deposits of this user
        const depositsRef = collection(db, "users", userId, "deposits");
        const allDeposits = await getDocs(depositsRef);

        // üîç Check if user has any previous completed deposits
        const completedBefore = allDeposits.docs.some(
          (d) =>
            d.id !== depositId &&
            ["completed", "approved", "done", "success"].includes(
              (d.data().status || "").toLowerCase()
            )
        );

        if (completedBefore) {
          console.log("‚ö†Ô∏è Not first deposit. No referral commission.");
          return;
        }

        // üîê VERY IMPORTANT ‚Üí lock first
        await updateDoc(depositRef, { rewardGiven: true });

        // ‚úÖ Now give commission
        await giveReferralCommission(userId, amount, depositId);

        console.log("üéâ Referral commission given successfully");
      } catch (err) {
        console.error("‚ùå Error in watchDepositStatus:", err);
      }
    }
  });
}


// ‚úÖ Prevent duplicate listeners in same session
const activeWatchers = {};

async function watchAllDeposits(userId) {
  const depositsRef = collection(db, "users", userId, "deposits");

  onSnapshot(depositsRef, (snapshot) => {
    snapshot.docs.forEach(docSnap => {
      const depositId = docSnap.id;
      if (!activeWatchers[depositId])  {

        activeWatchers[depositId] = true;
        watchDepositStatus(userId, depositId);
      }
    });
  });
}


  window.manualRefresh = function() {
  if (currentUserId) loadDepositHistory(currentUserId);
  };

  // ‚úÖ Real-time Deposit History Loader
  function loadDepositHistory(userId) {
  const depositsRef = collection(db, "users", userId, "deposits");
  const q = query(depositsRef, orderBy("date", "desc"));

   historyList.innerHTML = "<p style='text-align:center; color:#666;'>Loading...</p>";

   // Real-time listener for history updates
    onSnapshot(q, (querySnapshot) => {
    if (querySnapshot.empty) {
      historyList.innerHTML = "<p style='text-align:center; color:#666;'>No deposits yet.</p>";
      return;
    }

    historyList.innerHTML = ""; // Clear old list

    querySnapshot.forEach((docSnap) => {
      const data = docSnap.data();
      const dateStr = data.date ? new Date(data.date.seconds * 1000).toLocaleString() : "-";
      const statusClass = (data.status || "Pending").toLowerCase();

      historyList.innerHTML += `
        <div class="history-card">
          <div class="history-card-header">
            <span class="badge">Deposit</span>
            <span class="status ${statusClass}">${data.status || "Pending"}</span>
          </div>
          <div class="history-card-row"><span class="label">Balance</span><span class="value">$${data.amount || 0}</span></div>
          <div class="history-card-row"><span class="label">Type</span><span>BEP20</span></div>
          <div class="history-card-row"><span class="label">Time</span><small>${dateStr}</small></div>
          <div class="history-card-row">
            <span class="label">ID</span>
            <span><small id="order-${docSnap.id}">${data.orderId || docSnap.id}</small>
            <button onclick="copyOrderId('${data.orderId || docSnap.id}')">Copy</button></span>
          </div>
        </div>`;
    });
  }, (error) => {
    console.error("‚ùå Error loading history:", error);
    historyList.innerHTML = "<p style='text-align:center; color:red;'>Error loading history</p>";
  });
 }


onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html";
  } else {
    currentUserId = user.uid;
    loadDepositHistory(user.uid);
    watchTotalDeposit(user.uid);
    watchAllDeposits(user.uid);

    // ‚úÖ RESTORE POPUP AFTER AUTH
    const popupOpen = localStorage.getItem("deposit_popup_open");
    const savedAmount = localStorage.getItem("deposit_amount");

    if (popupOpen === "yes") {
      openPopup();

      if (savedAmount) {
        const amountInput = document.getElementById("depositAmount");
        amountInput.value = savedAmount;
        updateQRCode();
      }
    }
  }
});


window.copyOrderId = function(orderId) {
  navigator.clipboard.writeText(orderId);
  showError("Order ID copied!");
};
      // ‚úÖ Navbar Highlight Logic
document.querySelectorAll(".wave-nav a").forEach(link => {
  if (link.href === window.location.href) {
    link.classList.add("active");
  } else {
    link.classList.remove("active");
  }
});

// ‚úÖ Real-time Total + Lifetime Deposit + Level Updater
function watchTotalDeposit(userId) {
  const depositsRef = collection(db, "users", userId, "deposits");
  const userRef = doc(db, "users", userId);

  onSnapshot(depositsRef, async (snapshot) => {
    let total = 0;

    snapshot.forEach((docSnap) => {
      const data = docSnap.data();
      const status = (data.status || "").toLowerCase();

      // ‚úÖ Count only completed / approved / success deposits
      if (
        (status === "completed" || status === "approved" || status === "success") &&
        data.amount
      ) {
        total += parseFloat(data.amount);
      }
    });

    // üß† Update UI live
    document.getElementById("totalDeposit").textContent = total.toFixed(2);

    // üß† Fetch existing lifetimeDeposit
    const userSnap = await getDoc(userRef);
    const userData = userSnap.exists() ? userSnap.data() : {};
    const currentLifetime = parseFloat(userData.lifetimeDeposit || 0);

    // üîÑ Update lifetimeDeposit only if it increased
    const updatedLifetime = Math.max(currentLifetime, total);

    // üèÖ Determine Level
    let level = "No Level";
    if (updatedLifetime >= 1000) level = "Gold";
    else if (updatedLifetime >= 500) level = "Silver";
    else if (updatedLifetime >= 200) level = "Bronze";

    // üß© Firestore Update
    await updateDoc(userRef, {
      totalDeposit: total,
      lifetimeDeposit: updatedLifetime,
      userLevel: level,
    });

    // üß† Update level in UI
    document.getElementById("userLevel").textContent = `My Level: ${level}`;

    // ‚úÖ (optional) If you have a lifetimeDeposit span in HTML:
    const lifeEl = document.getElementById("lifetimeDeposit");
    if (lifeEl) lifeEl.textContent = updatedLifetime.toFixed(2);

    console.log(
      `‚úÖ Live Update: Total=$${total}, Lifetime=$${updatedLifetime}, Level=${level}`
    );
  });
}

</script>

</body>
</html>
