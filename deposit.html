<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deposit</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding-bottom: 100px;
      color: #333;
    }

/* üî• Dashboard Container */
.dashboard {
  max-width: 420px;
  margin: 20px auto;
  padding: 20px;
}

/* üî• Info Card */
.info-card {
  background: #fff;
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  text-align: left;
}
.info-card h3 {
  margin-bottom: 12px;
  color: #ff00d9;
}
.info-card .row {
  display: flex;
  justify-content: space-between;
  margin: 8px 0;
}
.info-card .row span.label {
  font-weight: 500;
}
.info-card .row span.value {
  font-weight: bold;
  color: #444;
}

/* ‚úÖ Popup etc (same as before) */
.popup-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

/* ‚úÖ Popup box center me chhota rahe */
.popup {
  background: #fff;
  border-radius: 16px;
  padding: 20px;
  width: 90%;
  max-width: 360px;        /* ‚úÖ max width fixed */
  height: auto;            /* ‚úÖ content ke hisaab se height */
  max-height: none;        /* ‚ùå pura screen na le */
  overflow: visible;       /* ‚ùå scroll hata diya */
  text-align: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  animation: fadeIn 0.25s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
}

@keyframes fadeIn {
  from {opacity: 0; transform: scale(0.9);}
  to {opacity: 1; transform: scale(1);}
}

.qr-code {
  margin: 15px auto;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 12px;
  background: #fafafa;
}
.qr-code canvas {
  width: 160px !important;
  height: 160px !important;
}

.address-box {
  background: #f5f7fa;
  padding: 12px;
  border-radius: 12px;
  font-size: 14px;
  word-break: break-all;
  margin: 10px 0;
  width: 100%;
  text-align: center;
}

.amount-input {
  width: 100%;
  padding: 10px;
  margin-top: 12px;
  border: 1px solid #ccc;
  border-radius: 10px;
  font-size: 15px;
  outline: none;
  text-align: center;
}

.copy-btn {
  background: #28a745;
  color: #fff;
  padding: 10px;
  border: none;
  border-radius: 10px;
  margin-top: 12px;
  cursor: pointer;
  font-weight: bold;
  width: 100%;
  font-size: 15px;
}

.action-buttons {
  display: flex;
  gap: 10px;
  margin-top: 12px;
  width: 100%;
}
.action-buttons button {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: bold;
  color: #fff;
  font-size: 15px;
}
.close-btn { background: #dc3545; }
.paid-btn { background: #007bff; }

/* ‚úÖ Mobile optimization */
@media (max-width: 480px) {
  .popup {
    width: 95%;
    max-width: 260px;
    padding: 25px;
  }
  .qr-code canvas {
    width: 140px !important;
    height: 140px !important;
  }
}
/* History */
.history-section {margin-top:30px;}
.history-card {background:#fff;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 4px 12px rgba(0,0,0,0.08);font-size:14px;}
.history-card-header {display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.badge {background:#28a745;color:#fff;padding:3px 10px;border-radius:6px;font-weight:bold;font-size:13px;}
.status.complete {color:green;font-weight:bold;}
.status.pending {color:#ff8800;font-weight:bold;}
.status.canceled {color:red;font-weight:bold;}
.status.paid {color:#007bff;font-weight:bold;}
.history-card-row {display:flex;justify-content:space-between;margin:6px 0;}
.history-card-row span.label {font-weight:600;color:#444;}
.history-card-row span.value {font-weight:bold;color:#ff8800;}
.history-card-row small {color:#666;}

/* Popup alerts */
.thankyou-popup,.error-popup {position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);padding:12px 20px;border-radius:10px;font-weight:bold;box-shadow:0 6px 20px rgba(0,0,0,0.3);z-index:3000;display:none;animation:fadeInOut 1.5s ease forwards;}
.thankyou-popup {background:#28a745;color:#fff;}
.error-popup {background:#dc3545;color:#fff;}
@keyframes fadeInOut {0%{opacity:0;transform:translate(-50%,-50%) scale(0.9);}20%{opacity:1;transform:translate(-50%,-50%) scale(1);}80%{opacity:1;}100%{opacity:0;transform:translate(-50%,-50%) scale(0.9);}}

/* Refresh Button */


/* Bottom Nav */
.bottom-nav {position:fixed;bottom:0;left:0;width:100%;height:70px;background:#fff;display:flex;justify-content:space-around;align-items:center;border-top:2px solid #28a745;z-index:100;}
.nav-item {flex:1;text-align:center;font-size:12px;color:#333;text-decoration:none;transition:0.3s;position:relative;padding:10px 0;}
.nav-item i {font-size:22px;display:block;margin-bottom:3px;color:#28a745;}
.nav-item:hover {color:#28a745;}
.nav-item:hover i {color:#218838;}
.nav-item:not(:last-child)::after {content:"";position:absolute;right:0;top:20%;bottom:20%;width:1px;background:#e0e0e0;}


.btn-deposit {
  background: #28a745;   /* Green */
  color: #fff;
  padding: 12px 20px;
  font-size: 16px;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  transition: 0.3s;
  width: 100%;           /* ‚úÖ card ke hisaab se fit */
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;    
}
.btn-deposit:hover {
  background: #218838;   /* Darker Green on hover */
}

/* ‚úÖ Balance Card */
.balance-card {
  background: linear-gradient(135deg, #28a745, #20c997);
  border-radius: 16px;
  padding: 20px;
  color: #fff;
  display: flex;
  align-items: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  margin-bottom: 20px;
}
.balance-icon {
  font-size: 48px;
  margin-right: 15px;
}
.balance-info h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
}
.balance-info .amount {
  font-size: 26px;
  font-weight: bold;
  margin: 5px 0;
}
.balance-info small {
  font-size: 14px;
  opacity: 0.9;
}

/* White card style for heading + refresh */
.history-header-box {
  background: #fff;
  border-radius: 12px;
  padding: 12px 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  display: flex;
  justify-content: space-between;
  justify-content: space-between; /* left-right alignment */
  align-items: center;
  margin-bottom: 20px;
  border: 1.5px solid #c3e6cb; 
}

/* Heading text */
.history-header-box .title {
  color: #28a745;   /* green heading */
  font-size: 18px;
  font-weight: 600;
}

/* Refresh button */
.refresh-btn {
  background: #17a2b8;
  color: #fff;
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  font-size: 14px;
}
.refresh-btn:hover {
  background: #138496;
}
 /*  button */
.deposit-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 15px;
  gap: 10px;
  margin: 20px 0;  
}

.action-btn {
  flex: 1;
  background: #fff;
  border-radius: 12px;
  padding: 12px;
  text-align: center;
  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
  cursor: pointer;
  transition: 0.3s;
}

.action-btn i {
  font-size: 22px;
  color: #28a745;  /* green icon */
  display: block;
  margin-bottom: 5px;
}

.action-btn span {
  font-size: 14px;
  font-weight: 500;
  color: #333;
}

.action-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 12px rgba(0,0,0,0.12);
}
/*animition card*/
.instruction-card {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  background: #fff;
  border: 1.5px solid #28a745;  /* green border */
  border-radius: 12px;
  padding: 12px 16px;
  margin: 15px 0;
  font-size: 14px;
  font-weight: 500;
  color: #28a745;
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  animation: slideIn 0.5s ease;
}

/* Icon Style */
.instruction-card i {
  font-size: 20px;
  color: #28a745;
  animation: pulse 1.5s infinite; /* glowing animation */
}

/* Text */
.instruction-card span {
  flex: 1;
}

/* Slide-in Animation */
@keyframes slideIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Pulse Animation for Icon */
@keyframes pulse {
  0% { transform: scale(1); opacity: 0.8; }
  50% { transform: scale(1.2); opacity: 1; }
  100% { transform: scale(1); opacity: 0.8; }
}
.info-text-box {
  border: 1.8px solid #28a745;   /* Green border */
  background: #f9fffa;           /* Halka green background */
  color: #28a745;                /* Green text */
  padding: 12px 14px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 500;
  margin: 12px 0 18px 0;         /* Gap top & bottom */
  text-align: center;            /* Center align */
  line-height: 1.5;
}
</style>
</head>
<body>
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

 <div class="dashboard">
    <!-- ‚úÖ Total Deposit Card -->
    <div class="balance-card">
      <div class="balance-icon">
        <i class='bx bxs-dollar-circle'></i>
      </div>
      <div class="balance-info">
        <h3>Total Deposit (USDT)</h3>
        <p class="amount">$<span id="totalDeposit">0.00</span></p>
        <small id="userLevel">My Level: No Level</small>
      </div>
    </div>

    <!-- Animated Instruction Card -->
<div class="instruction-card" id="instructionCard">
  <i class='bx bx-info-circle'></i>
  <span>Send the exact amount you have entered</span>
</div>


<!-- ‚úÖ icone Deposit Card -->
 <div class="deposit-actions">
  <div class="action-btn" onclick="openPopup()">
    <i class='bx bx-credit-card'></i>
    <span>Deposit</span>
  </div>
  <div class="action-btn" onclick="scrollToHistory()">
    <i class='bx bx-list-ul'></i>
    <span>History</span>
  </div>
  <div class="action-btn" onclick="scanFeature()">
    <i class='bx bx-scan'></i>
    <span>Scan</span>
  </div>
</div>

<script>
function scrollToHistory() {
  document.querySelector('.history-section').scrollIntoView({ behavior: 'smooth' });
}

function scanFeature() {
  alert('QR Scan feature coming soon!');
}
</script>

 <!-- Deposit Info -->
<div class="info-card">
  <h3>Deposit Section</h3>

  <!-- ‚úÖ Green Info Box -->
  <div class="info-text-box">
    Click below to get your <b>BEP20 deposit address</b> with QR code.
  </div>

  <button class="btn-deposit" onclick="openPopup()">
    <i class='bx bx-qr'></i> Get Deposit Address
  </button>
</div>


<!-- History -->
<!-- History -->
<div class="history-section">
  <div class="history-header-box">
    <span class="title">Deposit History</span>
    <button class="refresh-btn" onclick="manualRefresh()">üîÑ Refresh</button>
  </div>
  <div id="historyList">
    <p style="text-align:center; color:#666;">Loading...</p>
  </div>
</div>

  </div>

  <!-- ‚úÖ Popup -->
  <div class="popup-overlay" id="popupOverlay">
    <div class="popup">
      <h2>Deposit Funds</h2>
      <input type="number" id="depositAmount" class="amount-input" placeholder="Enter amount to deposit">
      <div id="amountInstruction" class="amount-instruction"></div>
      <div id="qrcode" class="qr-code"></div>
      <div class="address-box" id="depositAddress"></div>
      <button class="copy-btn" onclick="copyAddress()">Copy Address</button>
      <div class="action-buttons">
        <button class="close-btn" onclick="cancelDeposit()">Cancel</button>
        <button class="paid-btn" onclick="markPaid()">I Have Paid</button>
      </div>
    </div>
  </div>

  <div class="thankyou-popup" id="thankyouPopup">Thank you for paying</div>
  <div class="error-popup" id="errorPopup">Enter valid amount</div>

  <div class="bottom-nav">
    <a href="Dashboard.html" class="nav-item"><i class='bx bx-home'></i><span>Home</span></a>
    <a href="mining.html" class="nav-item"><i class='bx bx-wallet'></i><span>Invest</span></a>
    <a href="promotion.html" class="nav-item"><i class='bx bx-gift'></i><span>Refer</span></a>
    <a href="account.html" class="nav-item"><i class='bx bx-user'></i><span>Account</span></a>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <!-- ‚úÖ Firebase + Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, getDoc, serverTimestamp, query, orderBy, doc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";


    const firebaseConfig = {
      apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
      authDomain: "btcinvest-c0e25.firebaseapp.com",
      projectId: "btcinvest-c0e25",
      storageBucket: "btcinvest-c0e25.firebasestorage.app",
      messagingSenderId: "204937458487",
      appId: "1:204937458487:web:cc27ece1249999279f60b2",
      measurementId: "G-HG0Q8ZHT6G"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const popupOverlay = document.getElementById("popupOverlay");
    const depositAddressEl = document.getElementById("depositAddress");
    const qrCodeEl = document.getElementById("qrcode");
    const historyList = document.getElementById("historyList");
    const thankyouPopup = document.getElementById("thankyouPopup");
    const errorPopup = document.getElementById("errorPopup");
    const instructionEl = document.getElementById("amountInstruction");

    function generateOrderId() {
      const randomNum = Math.floor(1000000000 + Math.random() * 9000000000);
      return "DPBHGR" + randomNum + "G";
    }

    const depositAddresses = [
      "0x6cf5f8F9564205C6AB3dE1694F54374e70dD135A",
      "0x9ad288c9835Cfe30141677444A0A637a434Cd9bC",
      "0x9d6Dc16a1E5aC1CC3b4e7F500f4BdB51D8fBc301",
      "0x1E807c2AeC3165C37A8b47034839654033bD8cf2"
      ];

    let currentDepositAddress = "";
    let currentUserId = null;
    let currentDepositId = null;

    function showError(msg) {
      errorPopup.textContent = msg;
      errorPopup.style.display = "block";
      setTimeout(() => { errorPopup.style.display = "none"; }, 1500);
    }

// ‚úÖ QR Code ko update karne ka function
    function updateQRCode() {
      const amountInput = document.getElementById("depositAmount");
      const amount = parseFloat(amountInput.value) || 0;
      let qrText = `${currentDepositAddress}`;


      if (amount > 0) {
        if (amount < 200) {
      // ‚ùå Agar 200 se kam hai ‚Üí red border + error
          amountInput.style.border = "2px solid red";
      qrCodeEl.innerHTML = ""; // QR mat banao
      return;
    } else {
      // ‚úÖ Agar 200 ya zyada hai ‚Üí green border + QR with amount
      amountInput.style.border = "2px solid green";
      qrText += `?value=${amount}`;
    }
  } else {
    // Default border grey
    amountInput.style.border = "1px solid #ccc";
  }

  qrCodeEl.innerHTML = ""; // purana QR clear karo
  new QRCode(qrCodeEl, { text: qrText, width: 180, height: 180 });
}

window.openPopup = async function() {
  popupOverlay.style.display = "flex";
  const amountInput = document.getElementById("depositAmount");
  amountInput.value = "";
  amountInput.disabled = false;
  amountInput.style.border = "1px solid #ccc"; // reset border
  instructionEl.style.display = "none";

  // ‚úÖ Address pehle set karo
  currentDepositAddress = depositAddresses[Math.floor(Math.random() * depositAddresses.length)];
  depositAddressEl.textContent = currentDepositAddress;

  // ‚úÖ Default QR (sirf address)
  updateQRCode();

  // ‚úÖ Jab bhi user type kare ‚Üí QR update
  amountInput.addEventListener("input", updateQRCode);

  if (currentUserId) {
    const orderId = generateOrderId();
    const ref = await addDoc(collection(db, "users", currentUserId, "deposits"), {
      amount: 0,
      address: currentDepositAddress,
      date: serverTimestamp(),
      status: "Pending",
      orderId: orderId
    });
    currentDepositId = ref.id;
    loadDepositHistory(currentUserId);
    watchDepositStatus(currentUserId, currentDepositId);

  }
};

window.cancelDeposit = async function() {
  popupOverlay.style.display = "none";
  qrCodeEl.innerHTML = "";
  if (currentUserId && currentDepositId) {
    const ref = doc(db, "users", currentUserId, "deposits", currentDepositId);
    await updateDoc(ref, { status: "Canceled" });
    loadDepositHistory(currentUserId);
  }
};

window.copyAddress = function() {
  navigator.clipboard.writeText(currentDepositAddress);
  showError("Address copied!");
};

window.markPaid = async function () {
  const amountInput = document.getElementById("depositAmount");
  const amount = parseFloat(amountInput.value) || 0;
  if (amount <= 0) {
    showError("Enter valid amount");
    return;
  }
  if (amount < 200) {
    showError("Minimum is $200");
    amountInput.style.border = "2px solid red";
    return;
  }

  amountInput.disabled = true;
  instructionEl.style.display = "block";
  instructionEl.textContent = `Send the exact amount you entered: $${amount}`;

  popupOverlay.style.display = "none";
  qrCodeEl.innerHTML = "";

  if (currentUserId && currentDepositId) {
    const ref = doc(db, "users", currentUserId, "deposits", currentDepositId);
    await updateDoc(ref, { status: "I Have Paid", amount: amount });

    // ‚úÖ Trigger status watcher (reward chalega jab admin complete karega)
    watchDepositStatus(currentUserId, currentDepositId);

    loadDepositHistory(currentUserId);
  }

  thankyouPopup.style.display = "block";
  setTimeout(() => {
    thankyouPopup.style.display = "none";
  }, 2000);
};

// ‚úÖ Referral Commission + Wallet Reward Logic (UID Based)
async function giveReferralCommission(userId, depositAmount) {
  try {
    const userRef = doc(db, "users", userId);
    const userSnap = await getDoc(userRef);
    if (!userSnap.exists()) return;

    const userData = userSnap.data();

    // ‚úÖ Upline chain (UIDs)
    const uplines = [userData.upline1, userData.upline2, userData.upline3].filter(Boolean);

    // ‚úÖ Step 1: Check if this is user's FIRST successful deposit
    const depositsSnap = await getDocs(collection(db, "users", userId, "deposits"));
    const successful = depositsSnap.docs.filter(d => {
      const s = (d.data().status || "").toLowerCase();
      return s === "completed" || s === "success";
    });

    if (successful.length > 1) return; // ‚ùå Not first deposit

    // ‚úÖ Step 2: 3-Level Commission
    const commissionRates = [0.03, 0.02, 0.01]; // 3%, 2%, 1%

    for (let level = 0; level < uplines.length; level++) {
      const refUID = uplines[level];
      if (!refUID) continue;

      const refUserRef = doc(db, "users", refUID);
      const refUserSnap = await getDoc(refUserRef);
      if (!refUserSnap.exists()) continue;

      const refData = refUserSnap.data();
      const commission = depositAmount * commissionRates[level];

      // ‚úÖ Add record in referrer's commission history
      await addDoc(collection(db, "users", refUID, "commissions"), {
        fromUser: userId,
        level: level + 1,
        amount: commission.toFixed(2),
        date: serverTimestamp(),
        note: `Level ${level + 1} reward from ${userId}'s first deposit`,
      });

      // ‚úÖ Add reward to referrer's wallet and total lifetime income
      const currentWallet = parseFloat(refData.walletBalance || 0);
      const newWallet = currentWallet + commission;

      const totalReferral = parseFloat(refData.lifetimeReferralIncome || 0);
      const newTotalReferral = totalReferral + commission;

      await updateDoc(refUserRef, {
        walletBalance: newWallet,
        lifetimeReferralIncome: newTotalReferral,
      });

      console.log(
        `‚úÖ Level ${level + 1} Reward: $${commission.toFixed(
          2
        )} added to ${refUID}'s wallet`
      );
    }
  } catch (e) {
    console.error("Commission reward error:", e);
  }
}

// ‚úÖ Listen for status change to "completed"
function watchDepositStatus(userId, depositId) {
  const depositRef = doc(db, "users", userId, "deposits", depositId);

  onSnapshot(depositRef, async (snap) => {
    const data = snap.data();
    if (!data) return;

    // Jab status "completed" ho jaye aur reward abhi tak na mila ho
    if (data.status === "completed" && !data.rewardGiven) {
      console.log("‚úÖ Deposit completed! Giving referral reward...");
      await giveReferralCommission(userId, data.amount);

      // Mark reward as given (so it runs only once)
      await updateDoc(depositRef, { rewardGiven: true });
    }
  });
}

window.manualRefresh = function() {
  if (currentUserId) loadDepositHistory(currentUserId);
};


async function loadDepositHistory(userId) {
  historyList.innerHTML = "<p style='text-align:center; color:#666;'>Loading...</p>";
  try {
    const q = query(collection(db, "users", userId, "deposits"), orderBy("date", "desc"));
    const querySnapshot = await getDocs(q);
    if (querySnapshot.empty) {
      historyList.innerHTML = "<p style='text-align:center; color:#666;'>No deposits yet.</p>";
      return;
    }
    historyList.innerHTML = "";
    querySnapshot.forEach(docSnap => {
      const data = docSnap.data();
      const dateStr = data.date ? new Date(data.date.seconds*1000).toLocaleString() : "-";
      const statusClass = (data.status || "Pending").toLowerCase();
      historyList.innerHTML += `
      <div class="history-card">
      <div class="history-card-header">
      <span class="badge">Deposit</span>
      <span class="status ${statusClass}">${data.status || "Pending"}</span>
      </div>
      <div class="history-card-row"><span class="label">Balance</span><span class="value">$${data.amount || 0}</span></div>
      <div class="history-card-row"><span class="label">Type</span><span>BEP20</span></div>
      <div class="history-card-row"><span class="label">Time</span><small>${dateStr}</small></div>
      <div class="history-card-row"><span class="label"> ID</span>
      <span><small id="order-${docSnap.id}">${data.orderId || docSnap.id}</small>
      <button onclick="copyOrderId('${data.orderId || docSnap.id}')">Copy</button></span>
      </div>
      </div>`;
    });
  } catch (err) {
    console.error("Error:", err);
    historyList.innerHTML = "<p style='text-align:center; color:red;'>Error loading history</p>";
  }
}

onAuthStateChanged(auth, (user) => {
  if (!user) window.location.href = "login.html";
  else { currentUserId = user.uid; loadDepositHistory(user.uid); 
  loadTotalDeposit(user.uid);}
});

window.copyOrderId = function(orderId) {
  navigator.clipboard.writeText(orderId);
  showError("Order ID copied!");
};
      // ‚úÖ Navbar Highlight Logic
document.querySelectorAll(".wave-nav a").forEach(link => {
  if (link.href === window.location.href) {
    link.classList.add("active");
  } else {
    link.classList.remove("active");
  }
});

  // ‚úÖ Total Deposit Calculation
async function loadTotalDeposit(userId) {
  try {
    const q = query(collection(db, "users", userId, "deposits"));
    const querySnapshot = await getDocs(q);

    let total = 0;
    querySnapshot.forEach(docSnap => {
      const data = docSnap.data();
      const status = (data.status || "").toLowerCase();

      // ‚úÖ sirf completed + success wale hi count karna
      if ((status === "completed" || status === "success") && data.amount) {
        total += parseFloat(data.amount);
      }
    });

    document.getElementById("totalDeposit").textContent = total.toFixed(2);

    // ‚úÖ level set karne ka logic
    if (total >= 1000) {
      document.getElementById("userLevel").textContent = "My Level: Gold";
    } else if (total >= 500) {
      document.getElementById("userLevel").textContent = "My Level: Silver";
    } else if (total >= 200) {
      document.getElementById("userLevel").textContent = "My Level: Bronze";
    } else {
      document.getElementById("userLevel").textContent = "My Level: No Level";
    }

  } catch (err) {
    console.error("Error loading total:", err);
  }
}

// ‚úÖ Auto Refresh Logic (har 3 second me balance update hoga)
setInterval(() => {
  if (currentUserId) {
    loadTotalDeposit(currentUserId);

    // ‚úÖ Popup show
    thankyouPopup.textContent = "Auto Refreshed!";
    thankyouPopup.style.display = "block";
    setTimeout(() => {
      thankyouPopup.style.display = "none";
    }, 1100);
  }
}, 5000); // 3000ms = 3 seconds

// Example: Show card when user clicks "I Have Paid"
function showInstruction() {
  document.getElementById("instructionCard").style.display = "flex";
  setTimeout(() => {
    document.getElementById("instructionCard").style.display = "none";
  }, 4000); // hide after 4 sec
}



</script>
</body>
</html>

