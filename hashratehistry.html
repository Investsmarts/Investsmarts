<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TrustDollar ‚Äî Hashrate Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
<style>
:root {
  --green: #16a34a;
  --green-dark: #15803d;
  --text: #0f172a;
  --light: #f9fafb;
}

body {
  font-family: "Poppins", sans-serif;
  background: var(--light);
  color: var(--text);
  margin: 0;
  padding: 20px;
  overflow-y: auto;
  min-height: 100vh;
  display: flex;              /* ‚úÖ Use flex for center alignment */
  justify-content: center;    /* ‚úÖ Horizontally center */
  align-items: flex-start;    /* ‚úÖ Keep content from top (not middle) */
}

.card {
  width: 100%;
  max-width: 900px;
  background: #fff;
  border-radius: 5px;
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
  padding: 10px;
  margin-bottom: 100px;       /* ‚úÖ Space for bottom-nav */
  box-sizing: border-box;
}


/* ‚úÖ Bottom nav ke upar space fix */

html, body {
  overflow-x: hidden; /* ‚úÖ remove side scroll line */
}

@media (max-width: 768px) {
  body {
    padding: 12px;
  }
}



/* ‚úÖ Responsive 2x2 Grid Layout (Same) */
.balance-section {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 14px;
  margin-bottom: 25px;
}

/* ü§ç White Premium Balance Box */
.balance-box {
  background: #ffffff;
  color: #0f172a;
  border-radius: 5px;
  padding: 18px 14px;
  text-align: center;

  /* Soft premium shadow */
  box-shadow:
    0 4px 12px rgba(0, 0, 0, 0.06),
    0 1px 3px rgba(0, 0, 0, 0.04);

  border: 1px solid #f1f5f9;
  transition: all 0.25s ease;
}

/* üå¨Ô∏è Soft hover */
.balance-box:hover {
  transform: translateY(-2px);
  box-shadow:
    0 10px 22px rgba(0, 0, 0, 0.08),
    0 4px 6px rgba(0, 0, 0, 0.05);
}

/* üí∞ Amount */
.balance-box p {
  margin: 0;
  font-size: 22px;
  font-weight: 700;
  color: #020617; /* almost black */
  letter-spacing: 0.3px;
}

/* üè∑Ô∏è Label text (soft black) */
.balance-box h3 {
  margin-top: 6px;
  font-size: 13px;
  font-weight: 500;
  color: #64748b; /* soft gray */
  letter-spacing: 0.4px;
}

/* üì± Mobile tuning */
@media (max-width: 480px) {
  .balance-section {
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
  }

  .balance-box p {
      color: #16a34a;
  }

  .balance-box h3 {
    font-size: 12.5px;
  }
}


/* üåü Soft Premium Card Design (Final Version with Dates) */
.plan-card {
  background: #ffffff;
  border-radius: 5px;
  padding: 24px;
  margin-top: 22px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
  border: 1px solid #f1f5f9;
  text-align: center;
  transition: all 0.3s ease;
}

.plan-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

/* ü™ô Image / Animation Section */
.plan-animation {
  width: 120px;
  height: 120px;
  margin: 0 auto 16px;
  border-radius: 5px;
  overflow: hidden;
  background: #f9fafb;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
}

.plan-animation img,
.plan-animation video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* üî∏ Plan Title */
.plan-title {
  font-weight: 700;
  font-size: 18px;
  color: #0f172a;
  margin-bottom: 10px;
}

/* üü¢ Status Badge */
.status-badge {
  display: inline-block;
  background: #e0edff;
  color: #2563eb;
  padding: 6px 14px;
  border-radius: 5px;
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 16px;
}

/* üîπ Data Table Style */
.plan-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 15px;
  margin-bottom: 8px;
}

.plan-table tr {
  border-bottom: 1px solid #f1f5f9;
}

.plan-table td {
  padding: 10px 0;
  color: #475569;
  text-align: left;
  font-weight: 500;
}

.plan-table td:last-child {
  text-align: right;
  font-weight: 600;
  color: #111827;
}

/* ‚è≥ Countdown */
.countdown {
  font-size: 18px;
  font-weight: 700;
  color: #dc2626;
  margin-top: 10px;
  margin-bottom: 12px;
  letter-spacing: 0.5px;
}

/* üí∞ Collect Button */
.collect-btn {
  background: linear-gradient(135deg, #22c55e, #16a34a);
  color: white;
  border: none;
  border-radius: 5px;
  padding: 12px 0;
  width: 100%;
  font-weight: 600;
  font-size: 15px;
  margin-top: 14px;
  cursor: pointer;
  transition: 0.25s ease;
}

.collect-btn:hover:enabled {
  transform: scale(1.03);
  background: #15803d;
}

.collect-btn:disabled {
  background: #d1d5db;
  color: #6b7280;
  cursor: not-allowed;
}

/* üì± Responsive */
@media (max-width: 768px) {
  .plan-card {
    padding: 18px;
  }

  .plan-animation {
    width: 100px;
    height: 100px;
  }

  .plan-table td {
    font-size: 14px;
  }
}





/* üí∞ Live Mining Animation Effect */
@keyframes pulseGlow {
  0% { text-shadow: 0 0 2px #22c55e, 0 0 4px #22c55e; }
  50% { text-shadow: 0 0 10px #22c55e, 0 0 20px #16a34a; }
  100% { text-shadow: 0 0 2px #22c55e, 0 0 4px #22c55e; }
}

#earnedProfit {
  color: #065f46;
  font-weight: 700;
  transition: all 0.3s ease;
  animation: pulseGlow 2s infinite ease-in-out;
}

/* üåü Animation / Video Section ‚Äî Premium Style */
.plan-animation {
  width: 220px;                     /* üî∏ Size of video box */
  height: 220px;
  margin: 10px auto 20px;           /* Centered with spacing */
  border-radius: 5px;              /* Rounded corners */
  overflow: hidden;                 /* Hide overflow edges */
  border: 2px solid #e5e7eb;        /* Light border for white theme */
 
  background: #f9fafb;              /* Light gray background */
  position: relative;               /* For optional glow animation */
  transition: all 0.3s ease;        /* Smooth hover animation */
}

.plan-animation:hover {
  transform: scale(1.03);
  box-shadow: 0 10px 28px rgba(0, 0, 0, 0.18);
}

/* üéûÔ∏è Video inside the animation box */
.plan-animation video {
  width: 100%;
  height: 100%;
  object-fit: cover;                /* Video perfectly fits inside */
  border-radius: 5px;
  display: block;
}

/* ‚ú® Optional: Glow pulse effect (premium feel) */
@keyframes videoGlow {
  0% { box-shadow: 0 0 8px rgba(34, 197, 94, 0.4); }
  50% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.7); }
  100% { box-shadow: 0 0 8px rgba(34, 197, 94, 0.4); }
}

.plan-animation.glow {
  animation: videoGlow 2.5s infinite ease-in-out;
}

/* ü§ç App Header */
.app-header {
  background: #ffffff;
  border-radius: 5px;
  padding: 14px 16px;
  margin-bottom: 18px;

  display: flex;
  align-items: center;
  justify-content: space-between;

  border: 1px solid #f1f5f9;
  box-shadow:
    0 4px 12px rgba(0, 0, 0, 0.05);
}

/* Left text */
.header-left h2 {
  margin: 0;
  font-size: 18px;
  font-weight: 700;
  color: #020617;
}

.header-left p {
  margin: 2px 0 0;
  font-size: 13px;
  color: #64748b;
}

/* Right icon */
.header-right i {
  font-size: 20px;
  color: #16a34a;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.header-right i:hover {
  transform: scale(1.15);
}

/* üì± Mobile */
@media (max-width: 480px) {
  .header-left h2 {
    font-size: 16px;
  }

  .header-left p {
    font-size: 12px;
  }
}
/* Typing text style */
.typing-text {
  margin-top: 4px;
  font-size: 13px;
  color: #64748b;
  min-height: 18px; /* layout jump avoid */
  letter-spacing: 0.3px;
}

/* Blinking cursor */
.typing-text::after {
  content: "|";
  margin-left: 3px;
  animation: blink 1s infinite;
  color: #16a34a;
}

@keyframes blink {
  0%, 50%, 100% { opacity: 1; }
  25%, 75% { opacity: 0; }
}

</style>
</head>

<body>

<div class="card">
  <!-- ‚úÖ App Header -->
  <div class="app-header">
    <div class="header-left">
      <h2>Dashboard</h2>
      <p class="typing-text">
        <span id="typing"></span>
      </p>
    </div>

    <div class="header-right">
      <i class="bx bx-bell"></i>
    </div>
 </div>


<div class="balance-section">
  <div class="balance-box">
    <p id="walletBalance">$0.00</p>
     <h3>Available Balance</h3> 
     </div>

  <div class="balance-box">
    <p id="lockedBalance">$0.00</p>
    <h3>Locked Funds</h3>
  </div>

 <div class="balance-box">
  <p id="totalIncome">$0.00</p>
  <h3>Total Earnings</h3>

</div>

  <div class="balance-box">
    <p id="totalReferralIncome">$0.00</p>
<h3>Referral Rewards</h3>
  </div>
</div>

<div class="balance-box">
  <p id="hashIncome">$0.00</p>
  <h3>Hash Income</h3>
</div>


    <!-- ‚úÖ Active Plan Section -->
    <div id="planSection" style="margin-top:15px;">
      <p class="loader">Loading active plan...</p>
    </div>

    <!-- ‚úÖ Referral History INSIDE the card -->
    <div style="margin-top:25px;">
      <h3 style="color:#065f46;">Referral History</h3>
      <div id="referralHistoryBox"
           style="background:#ecfdf5; border:1px solid #bbf7d0; border-radius:12px; padding:15px;">
        <p style="text-align:center; color:#777;">Loading your referral history...</p>
      </div>
    </div>

   <!-- ‚úÖ Collect / Earning History -->
<div style="margin-top:25px;">
  <h3 style="color:#065f46;">Earning History</h3>

  <div id="collectHistoryBox"
    style="background:#f8fafc;border:1px solid #e5e7eb;
           border-radius:12px;padding:15px;">
    <p style="text-align:center;color:#999;">
      Loading your earning history...
    </p>
  </div>
</div>

<!-- ‚úÖ Notification Sound (Fixed, works everywhere) -->
<audio id="bellSound"
  src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"
  preload="auto"></audio>
</div>


<!-- ‚úÖ BTCInvest Auto Smart Bottom Navbar -->
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet">

<style>
:root {
  --nav-bg: #fff;
  --nav-text: #444;
  --nav-border: rgba(0, 0, 0, 0.08);
}

[data-theme="dark"] {
  --nav-bg: #0f0f0f;
  --nav-text: #ccc;
  --nav-border: rgba(255, 255, 255, 0.1);
}

/* üîπ Navbar Base (height reduced) */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: var(--nav-bg);
  border-top: 1px solid var(--nav-border);
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 10px 0; /* üëà thinner padding */
  z-index: 9999;
  box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.05);
}

/* üîπ Nav items (slimmer text + less spacing) */
.bottom-nav .nav-item {
  flex: 1;
  text-align: center;
  color: var(--nav-text);
  text-decoration: none;
  font-size: 10px; /* üëà smaller text */
  position: relative;
  padding: 4px 0; /* üëà less padding */
  transition: all 0.3s ease;
}

/* üîπ Icon (reduced size + gap) */
.bottom-nav .nav-item i {
  font-size: 18px; /* üëà smaller icons (was 22px) */
  display: block;
  opacity: 0.75;
  margin-bottom: 2px; /* üëà smaller gap */
  transition: all 0.3s ease;
}

/* üîπ Text */
.bottom-nav .nav-item span {
  opacity: 0.7;
  transition: all 0.3s ease;
}

/* üîπ Divider lines */
.bottom-nav .nav-item:not(:last-child)::after {
  content: "";
  position: absolute;
  right: 0;
  top: 25%;
  width: 1px;
  height: 50%;
  background: var(--nav-border);
}

/* üîπ Active State (icons glow thoda soft) */
.bottom-nav .nav-item.active i {
  transform: scale(1.1);
  opacity: 1;
  animation: bulbGlow 1.6s ease-in-out infinite alternate;
}
.bottom-nav .nav-item.active span {
  opacity: 1;
  font-weight: 600;
}

/* Active colors */
.bottom-nav .nav-item:nth-child(1).active i { color: #00c853; }
.bottom-nav .nav-item:nth-child(2).active i { color: #ffc107; }
.bottom-nav .nav-item:nth-child(3).active i { color: #ff3b30; }
.bottom-nav .nav-item:nth-child(4).active i { color: #00bcd4; }

@keyframes bulbGlow {
  from { filter: brightness(1); }
  to { filter: brightness(1.6); }
}

/* üîπ Ripple (same) */
.ripple {
  position: absolute;
  border-radius: 50%;
  transform: scale(0);
  animation: ripple 0.6s linear;
  background: rgba(0, 200, 83, 0.15);
}
@keyframes ripple {
  to { transform: scale(3); opacity: 0; }
}

/* üîπ Responsive tuning */
@media (max-width: 480px) {
  .bottom-nav .nav-item i {
    font-size: 17px;
  }
  .bottom-nav .nav-item span {
    font-size: 9.5px;
  }
}
</style>

<!-- ‚úÖ HTML Navbar -->
<div class="bottom-nav" id="mainNav">
  <a href="Dashboard.html" class="nav-item">
    <i class="ri-home-5-fill"></i>
    <span>Home</span>
  </a>

  <a href="mining.html" class="nav-item">
    <i class="ri-bar-chart-2-fill"></i>
    <span>Mining</span>
  </a>

  <a href="promotion.html" class="nav-item">
    <i class="ri-gift-fill"></i>
    <span>Promotion</span>
  </a>

  <a href="account.html" class="nav-item">
    <i class="ri-user-3-fill"></i>
    <span>Account</span>
  </a>
</div>

<script>
/* üåó Auto theme detect */
function detectTheme() {
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  document.documentElement.setAttribute("data-theme", prefersDark ? "dark" : "light");
}
detectTheme();
window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", detectTheme);

/* üí° Auto highlight based on page URL */
const currentPage = window.location.pathname.split("/").pop().toLowerCase();
document.querySelectorAll(".bottom-nav .nav-item").forEach(item => {
  const href = item.getAttribute("href")?.toLowerCase();
  if (currentPage === href) item.classList.add("active");
});

/* üåä Ripple effect + manual highlight */
document.querySelectorAll(".bottom-nav .nav-item").forEach((item) => {
  item.addEventListener("click", (e) => {
    // highlight
    document.querySelector(".bottom-nav .nav-item.active")?.classList.remove("active");
    item.classList.add("active");

    // ripple
    const ripple = document.createElement("span");
    ripple.classList.add("ripple");
    const rect = item.getBoundingClientRect();
    ripple.style.left = `${e.clientX - rect.left}px`;
    ripple.style.top = `${e.clientY - rect.top}px`;
    item.appendChild(ripple);
    setTimeout(() => ripple.remove(), 500);
  });
});
</script>




<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import {
  getFirestore, doc, getDoc, updateDoc, collection, query, where,
  addDoc, serverTimestamp, orderBy, onSnapshot, increment
} from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";

/* üî• Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
  authDomain: "btcinvest-c0e25.firebaseapp.com",
  projectId: "btcinvest-c0e25",
  storageBucket: "btcinvest-c0e25.firebasestorage.app",
  messagingSenderId: "204937458487",
  appId: "1:204937458487:web:cc27ece1249999279f60b2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const bell = document.getElementById("bellSound");

let countdownInterval = null;

/* üîî Toast */
function showToast(msg) {
  const t = document.createElement("div");
  t.innerText = msg;
  t.style.cssText = `
    position:fixed;bottom:90px;left:50%;transform:translateX(-50%);
    background:rgba(0,0,0,.8);color:#fff;padding:10px 18px;
    border-radius:14px;font-size:14px;z-index:9999;
  `;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 2000);
}

/* üß† Auth */
onAuthStateChanged(auth, (user) => {
  if (!user) return;

  const userRef = doc(db, "users", user.uid);

  /* üîÅ LIVE USER DATA */
  onSnapshot(userRef, (snap) => {
    if (!snap.exists()) return;
    const u = snap.data();
    walletBalance.textContent = `$${(u.walletBalance || 0).toFixed(2)}`;
    lockedBalance.textContent = `$${(u.lockedBalance || 0).toFixed(2)}`;
    totalIncome.textContent = `$${(u.totalIncome || 0).toFixed(2)}`;
    hashIncome.textContent = `$${(u.hashIncome || 0).toFixed(2)}`;
  });

// üî• LOAD ACTIVE PLAN
const planQ = query(
  collection(db, "buyhashrate"),
  where("uid", "==", user.uid),
  where("status", "==", "Active"),
  orderBy("startTime", "desc")
);

onSnapshot(planQ, async (snap) => {
  if (snap.empty) {
    document.getElementById("planSection").innerHTML =
      `<p style="text-align:center;color:#999;">No active plan found</p>`;
    return;
  }

  // Latest active plan
  const planDoc = snap.docs[0];
  const planData = planDoc.data();
  planData.id = planDoc.id;

  renderPlan(planData, userRef);
});


// ‚úÖ LIVE COLLECT HISTORY
const historyQ = query(
  collection(db, "users", user.uid, "collectHistory"),
  orderBy("date", "desc")
);

/* ‚úÖ LIVE COLLECT HISTORY */
const collectHistoryBox = document.getElementById("collectHistoryBox");
collectHistoryBox.innerHTML = `<p style="text-align:center;color:#999;">Loading earnings...</p>`;

onSnapshot(historyQ, (res) => {
  const box = collectHistoryBox;

  if (res.empty) {
    box.innerHTML = `<p style="text-align:center;color:#999;font-weight:500;">No earnings collected yet.</p>`;
    return;
  }

  let html = `
    <table style="width:100%;font-size:13px;">
      <tr>
        <th>Plan</th>
        <th>Amount</th>
        <th>Date</th>
      </tr>
  `;

  res.forEach(d => {
    const h = d.data();
    html += `
      <tr>
        <td>${h.planName}</td>
        <td style="color:#16a34a;font-weight:600;">+$${h.amount.toFixed(2)}</td>
        <td>${h.date?.toDate()?.toLocaleDateString()}</td>
      </tr>
    `;
  });

  html += `</table>`;
  box.innerHTML = html;
});

/* üë• LIVE REFERRAL HISTORY */
const referralBox = document.getElementById("referralHistoryBox");
referralBox.innerHTML = `<p style="text-align:center;color:#999;">Loading referral history...</p>`;

onSnapshot(refQ, (res) => {
  const box = referralBox;
  let total = 0;

  if (res.empty) {
    totalReferralIncome.textContent = "$0.00";
    box.innerHTML = `<p style="text-align:center;color:#999;font-weight:500;">No referral income yet.</p>`;
    return;
  }

  let html = `<table style="width:100%;font-size:13px;">
    <tr><th>From</th><th>Lvl</th><th>Amt</th><th>Date</th></tr>`;

  res.forEach(d => {
    const r = d.data();
    total += r.amount || 0;
    html += `<tr>
      <td>${r.fromUser}</td>
      <td>${r.level}</td>
      <td style="color:#16a34a;font-weight:600;">$${r.amount.toFixed(2)}</td>
      <td>${r.timestamp?.toDate()?.toLocaleDateString()}</td>
    </tr>`;
  });

  html += `</table>`;
  totalReferralIncome.textContent = `$${total.toFixed(2)}`;
  box.innerHTML = html;
});
});
/* üé® Render Plan */
function renderPlan(plan, userRef) {
  const start = plan.startTime?.toDate()?.toLocaleDateString() || "N/A";
  const end = plan.endTime?.toDate()?.toLocaleDateString() || "N/A";

  planSection.innerHTML = `
  <div class="plan-card">
    <div class="plan-animation">
      <video autoplay loop muted playsinline style="width:100%;height:100%;object-fit:cover">
        <source src="./images/trust.mp4">
      </video>
    </div>

    <div class="plan-title">${plan.planName}</div>
    <span class="status-badge">${plan.status}</span>

    <table class="plan-table">
      <tr><td>Investment</td><td>$${plan.planCost}</td></tr>
      <tr><td>Accrued</td>  <td><span class="earnedProfit">$${(plan.earnedProfit||0).toFixed(2)}</span></td></tr>
      <tr><td>Remaining Days</td><td>${plan.remainingDays}</td></tr>
      <tr><td>Start</td><td>${start}</td></tr>
      <tr><td>End</td><td>${end}</td></tr>
    </table>

    <div class="countdown" id="countdown">--:--:--</div>
    <button id="collectBtn" class="collect-btn" disabled>Collect</button>
  </div>`;

  startCountdown(
    plan.nextPayout?.toDate()?.getTime(),
    collectBtn,
    countdown,
    plan,
    userRef
  );
}

/* ‚è± Countdown */
function startCountdown(target, btn, display, plan, userRef) {
  clearInterval(countdownInterval);
  let earned = plan.earnedProfit || 0;
  const perSec = ((plan.planCost * plan.dailyProfitPercent) / 100) / 86400;

  countdownInterval = setInterval(() => {
    const diff = target - Date.now();
    if (diff <= 0) {
      display.textContent = "Ready!";
      btn.disabled = false;
      bell.play().catch(()=>{});

      btn.onclick = () => collectProfit(plan, userRef);
      clearInterval(countdownInterval);
      return;
    }

    const h = Math.floor(diff / 3600000);
    const m = Math.floor(diff % 3600000 / 60000);
    const s = Math.floor(diff % 60000 / 1000);
    display.textContent = `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;

earned += perSec;

const earnedEl = document.querySelector(".earnedProfit");
if (earnedEl) {
  earnedEl.textContent = `$${earned.toFixed(4)}`;
}

  }, 1000);
}

/* üí∞ Collect */
async function collectProfit(plan, userRef) {
  document.getElementById("collectBtn").disabled = true;

  const total = (plan.planCost * plan.dailyProfitPercent) / 100;
  const self = total * 0.7;

  await updateDoc(userRef, {
    walletBalance: increment(self),
    totalIncome: increment(self),
    hashIncome: increment(self)
  });

  // ‚úÖ SAVE COLLECT HISTORY
await addDoc(
  collection(db, "users", auth.currentUser.uid, "collectHistory"),
  {
    planName: plan.planName,
    planCost: plan.planCost,
    amount: self,
    date: serverTimestamp()
  }
);


  await distributeReferralIncome((await getDoc(userRef)).data(), total, plan.planCost);

  await updateDoc(doc(db, "buyhashrate", plan.id), {
    earnedProfit: increment(total),
    remainingDays: plan.remainingDays - 1,
    nextPayout: new Date(Date.now() + 86400000),
    updatedAt: serverTimestamp()
  });

  showToast(`‚úÖ Collected $${self.toFixed(2)}`);
}

/* üë• Referral */
async function distributeReferralIncome(user, total, planCost) {
  const levels = [
    { id: user.upline1, p: 0.17, l: 1 },
    { id: user.upline2, p: 0.08, l: 2 },
    { id: user.upline3, p: 0.05, l: 3 }
  ];

  for (const u of levels) {
    if (!u.id) continue;
    const ref = doc(db, "users", u.id);
    const s = await getDoc(ref);
    if (!s.exists() || (s.data().lifetimeDeposit||0) < planCost) continue;

    const amt = total * u.p;
    await updateDoc(ref, {
      walletBalance: increment(amt),
      lifetimeReferralIncome: increment(amt),
      totalIncome: increment(amt)
    });

    await addDoc(collection(db, "users", u.id, "buyhashrefarl"), {
      fromUser: user.username || "Unknown",
      amount: amt,
      level: u.l,
      timestamp: serverTimestamp()
    });
  }
}
</script>
<script>
const typingTexts = [
  "Welcome back üëã",
  "Buy hashrate plans and start  instantly",
  "Choose a plan that fits your budget",
  "Your mining runs automatically every day",
  "Daily profits are added to your wallet",
  "Collect earnings with one tap",
  "Invite friends and earn referral rewards",
  "Track all earnings in real time"
];

const typingEl = document.getElementById("typing");

let textIndex = 0;
let charIndex = 0;
let deleting = false;

function runTyping() {
  const current = typingTexts[textIndex];

  if (!deleting) {
    typingEl.textContent = current.slice(0, charIndex++);
    if (charIndex > current.length) {
      setTimeout(() => deleting = true, 1200);
    }
  } else {
    typingEl.textContent = current.slice(0, charIndex--);
    if (charIndex < 0) {
      deleting = false;
      textIndex = (textIndex + 1) % typingTexts.length;
      charIndex = 0;
    }
  }
}

setInterval(runTyping, 80);
</script>

</body>
</html>
