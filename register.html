<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta 
  name="viewport" 
  content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>

  <title>User Register / Trustdollar</title>
  <style>
    body {
      font-family: Arial, sans-serif;
     
      margin: 0;
      padding: 0;
    }

     .header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;

  height: 48px;                 /* fixed height */
  display: flex;                /* üî• real center */
  align-items: center;          /* vertical center */
  justify-content: center;      /* horizontal center */

  padding: 0 12px;              /* side padding only */
  font-size: 18px;
  font-weight: 600;
  background: #fff;
  color: #272121;
  z-index: 1000;

  text-align: center;
}

    .wrapper {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      width: 100%;
      margin-top: 70px; 
      
      box-sizing: border-box;
    }

    .container {
      background: #fff;
      padding: 25px 20px;
      border-radius: 5px;
     
      width: 100%;
      max-width: 400px;
      text-align: center;
    }

 h2 {
  font-size: 22px;
  font-weight: 600;
  color: #1f2937;
}

    /* Floating input group */
    .input-group {
      position: relative;
      margin: 18px 0;
      width: 100%;
    }

    .input-group input {
      width: 100%;
      padding: 14px 12px;
      font-size: 15px;
      border: 1.5px solid #ccc;
      border-radius: 5px;
      outline: none;
      box-sizing: border-box;
      background: #fff;
      transition: 0.3s;
    }

    .input-group label {
      position: absolute;
      left: 14px;
      top: 14px;
      font-size: 15px;
      color: #888;
      pointer-events: none;
      transition: all 0.3s ease;
      background: #fff;
      padding: 0 4px;
    }

    .input-group input:focus {
      border-color: #4CAF50;
     
    }

    .input-group input:focus + label,
    .input-group input:not(:placeholder-shown) + label {
      top: -8px;
      font-size: 12px;
      color: #4CAF50;
      font-weight: 600;
    }

    /* Password eye icon */
    .password-container i {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 16px;
      color: #444;
    }

    button {
      width: 100%; 
      padding: 12px; 
      margin-top: 15px;
      border: none; 
      border-radius: 5px;
      background: linear-gradient(90deg,#4CAF50,#2c7);
      color: white;
      font-size: 16px; 
      font-weight: bold;
      cursor: pointer; 
      transition: 0.3s;
    }

    button:hover { background:#3a9440; }

    .login-box {
      margin-top: 16px; 
      padding: 10px;
      border: 1px solid #ddd; 
      border-radius: 5px;
      background: #f9f9f9; 
      font-size: 14px; 
      color: #333;
    }
    .login-box a { color: #0066ff; font-weight: bold; text-decoration: none; }
    .login-box a:hover { text-decoration: underline; }

   .popup {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  background: #fff;
  padding: 14px 26px;
  border-radius: 5px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
  font-size: 16px;
  font-weight: 600;
  z-index: 2000;
  display: none;
  opacity: 0;
  transition: opacity 0.4s ease-in-out;
}
.popup.success { border-left: 5px solid #4CAF50; color: #2e7d32; }
.popup.error { border-left: 5px solid #f44336; color: #d32f2f; }

    /* ‚úÖ Mobile Responsive */
    @media (max-width: 480px) {
      .container {
        padding: 20px 15px;
        border-radius: 5px;
      }
      h2 { font-size: 20px; }
      .input-group input { font-size: 14px; padding: 12px 10px; }
      .input-group label { font-size: 14px; }
      button { font-size: 15px; padding: 10px; }
    }
    .password-container i {
  transition: 0.2s ease;
}
.password-container i:hover {
  color: #4CAF50;
  transform: translateY(-50%) scale(1.2);
}


/* üå´Ô∏è Soft background blur */
#processingOverlay {
  position: fixed;
  inset: 0;
  background: rgba(255,255,255,0.55);
  backdrop-filter: blur(4px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 6000;
}

/* üì¶ Center box */
.loader-box {
  background: #fff;
  padding: 26px 34px;
  border-radius: 14px;
  text-align: center;
  box-shadow: 0 8px 25px rgba(0,0,0,0.12);
}

/* üîÑ Round loader */
.round-loader {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  border: 4px solid #e5e7eb;
  border-top: 4px solid #4CAF50;
  animation: spin 1s linear infinite;
  margin: 0 auto 14px;
}

.loader-text {
  font-size: 15px;
  font-weight: 600;
  color: #374151;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* üéâ Success Overlay */
#successOverlay {
  position: fixed;
  inset: 0;
  background: linear-gradient(
    180deg,
    #e9f9f0 0%,
    #ffffff 60%
  );
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 8000;
}

/* üì¶ Center box */
.success-box {
  text-align: center;
}

/* üé• Video styling */
#successVideo {
  width: 220px;
  max-width: 80vw;
  border-radius: 16px;
}

/* ‚úÖ Text */
.success-text {
  margin-top: 14px;
  font-size: 18px;
  font-weight: 700;
  color: #2e7d32;
}
.sub-header{
  position: fixed;
  top: 48px;
  left: 0;
  width: 100%;
  background: #fcfdfc;
  border-bottom: 1px solid #eef2f7;
  padding: 6px 10px;
  font-size: 12.5px;
  font-weight: 400; /* üëà light weight */
  color: #6b7280;   /* üëà soft gray */
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 7px;
  z-index: 999;
  letter-spacing: 0.2px;
}

/* üü¢ Soft live dot */
.live-dot{
  width: 7px;
  height: 7px;
  background: #22c55e;
  border-radius: 50%;
  animation: pulse 1.6s ease-in-out infinite;
  opacity: 0.7;
}

@keyframes pulse{
  0%{opacity:.7}
  50%{opacity:.25}
  100%{opacity:.7}
}

/* ‚úçÔ∏è Typing text smooth */
#typingText{
  white-space: nowrap;
  overflow: hidden;
  transition: opacity .3s ease;
}

.login-box{
  font-size: 13px;
  color: #6b7280;
}

.login-box a{
  color: #2563eb;
  font-weight: 500;
}
.input-group input{
  font-size:16px;
}


  </style>
</head>
<body>

<script>
  // Clean URL without reloading page
  if (window.location.pathname.includes("register.html")) {
    window.history.replaceState(
      null,
      "",
      "/auth/registrater#register"
    );
  }
</script>



<!-- üîÑ Processing Overlay -->
<div id="processingOverlay">
  <div class="loader-box">
    <div class="round-loader"></div>
    <div class="loader-text">Checking your details...</div>
  </div>
</div>

<!-- üéâ Success Video Overlay -->
<div id="successOverlay">
  <div class="success-box">

    <!-- üé• Success Animation -->
    <video 
      id="successVideo"
      src="promotion/success.mp4"
      autoplay
      muted
      playsinline
    ></video>

    <!-- ‚úÖ Text -->
    <div class="success-text">
      Registration Successful
    </div>

  </div>
</div>

  <div class="header">ùêíùêûùêúùêÆùê´ùêû ùêòùê®ùêÆùê´ ùêÖùêÆùêßùêùùê¨ ùê∞ùê¢ùê≠ùê° ùêíùêöùêüùêû</div>
  <!-- üîî Live Sub Header -->
<div class="sub-header">
  <span class="live-dot"></span>
  <span id="typingText"></span>
</div>


  <div class="wrapper">
    <div class="container">

     <h2>
  Create an Account with 
  <span id="trustColor">TrustDollar</span>
</h2>


      
      <form id="registerForm" onsubmit="return false;">
      <!-- Name -->
      <div class="input-group">
        <input type="text" id="name" placeholder=" " required>
      <label for="name">Full legal name (as per Aadhaar records)</label>
      </div>

      <!-- Email -->
      <div class="input-group">
        <input type="text" id="register-email" placeholder=" " required>
<label for="register-email">Email address (used for account access)</label>
      </div>

      <!-- Username -->
      <div class="input-group">
        <input type="text" id="username" placeholder=" " required>
        <label for="username">Unique username for your account</label>

      </div>

     <!-- Mobile -->
<div class="input-group">
  <input
    type="text"
    id="mobile"
    placeholder=" "
    required
    maxlength="10"
    inputmode="numeric"
    autocomplete="off"
  >
<label for="mobile">Registered mobile number</label>
</div>

    <!-- Aadhaar -->
<div class="input-group">
  <input
    type="text"
    id="aadhaar"
    placeholder=" "
    required
    maxlength="12"
    inputmode="numeric"
    autocomplete="off"
  >
    <label for="aadhaar">Aadhaar number (12-digit verification)</label>
   </div>

      <!-- Cheque -->
      <div class="input-group">
        <input type="text" id="cheque" placeholder=" ">
        <label for="cheque">Upline reference number (optional)</label>
      </div>

      <!-- Password -->
      <div class="input-group password-container">
        <input type="password" id="password" placeholder=" " required>
        <label for="password">Create a secure password</label>
        <i id="toggle-password">üëÅÔ∏è</i>
      </div>

      <!-- Confirm Password -->
      <div class="input-group password-container">
        <input type="password" id="confirm-password" placeholder=" " required>
        <label for="confirm-password">Re-enter password for confirmation</label>
        <i id="toggle-confirm-password">üëÅÔ∏è</i>
      </div>

      <!-- Referral -->
      <div class="input-group">
        <input type="text" id="referral" placeholder=" ">
        <label for="referral">Referral code (if applicable)</label>

      </div>

      <button id="registerBtn" type="button">Create Account</button>


   </form>

         <div class="login-box">
  Existing users can securely access their account
  <br>
  <a href="login.html">Proceed to Login</a>
</div>



      <!-- ‚úÖ Popup element -->
      <div id="popup" class="popup"></div>
    </div>
  </div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { getFirestore, collection, doc, setDoc, getDocs, query, where, addDoc, orderBy, limit } 
    from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDEQYPJFxQv8yFHptrTqoLHOn2L0PpgVhc",
    authDomain: "btcinvest-c0e25.firebaseapp.com",
    projectId: "btcinvest-c0e25",
    storageBucket: "btcinvest-c0e25.firebasestorage.app",
    messagingSenderId: "204937458487",
    appId: "1:204937458487:web:cc27ece1249999279f60b2",
    measurementId: "G-HG0Q8ZHT6G"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const popup = document.getElementById("popup");

  // ‚úÖ Get User's Public IP
async function getUserIP() {
  try {
    const res = await fetch("https://api.ipify.org?format=json");
    const data = await res.json();
    return data.ip; // IP mil gaya
  } catch (e) {
    console.error("‚ùå Unable to fetch IP:", e);
    return "Unknown"; // agar kuch error ho
  }
}


function showPopup(msg, type = "success") {
  popup.textContent = msg;
  popup.className = `popup ${type}`;
  popup.style.display = "block";
  popup.style.opacity = "0"; // start invisible

  // ‚ö° Force next paint, then fade in
  requestAnimationFrame(() => {
    popup.style.opacity = "1"; // fade-in
  });

  // üßä Auto-hide smoothly
  setTimeout(() => {
    popup.style.opacity = "0"; // fade-out
    setTimeout(() => {
      popup.style.display = "none";
    }, 400);
  }, 2500);
}


  function validateEmailFormat(email){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }

  // normalize email: lowercase, trim, for gmail remove dots and +tag
  function normalizeEmail(email) {
    if(!email) return "";
    email = email.trim().toLowerCase();
    const parts = email.split("@");
    if(parts.length !== 2) return email;
    let [local, domain] = parts;
    // remove trailing/leading dots in local
    local = local.replace(/^\.+|\.+$/g, "");
    // gmail / googlemail canonicalization
    if(domain === "gmail.com" || domain === "googlemail.com") {
      // remove everything after + and remove dots
      local = local.split("+")[0].replace(/\./g, "");
      domain = "gmail.com";
    } else {
      // for other providers, remove +tag but keep dots (optional)
      local = local.split("+")[0];
    }
    return `${local}@${domain}`;
  }

  // normalize simple text (name/username)
  function normalizeText(txt) {
    if(!txt) return "";
    // lowercase, trim, collapse multiple spaces
    return txt.trim().toLowerCase().replace(/\s+/g, " ");
  }

  // Levenshtein distance (for fuzzy)
  function levenshtein(a, b) {
    if(a === b) return 0;
    const al = a.length, bl = b.length;
    if(al === 0) return bl;
    if(bl === 0) return al;
    const v0 = new Array(bl + 1);
    const v1 = new Array(bl + 1);
    for (let i = 0; i <= bl; i++) v0[i] = i;
    for (let i = 0; i < al; i++) {
      v1[0] = i + 1;
      for (let j = 0; j < bl; j++) {
        const cost = a[i] === b[j] ? 0 : 1;
        v1[j + 1] = Math.min(v1[j] + 1, v0[j + 1] + 1, v0[j] + cost);
      }
      for (let k = 0; k <= bl; k++) v0[k] = v1[k];
    }
    return v1[bl];
  }

  // fuzzy check: query by prefix (first 3-4 chars) and compare levenshtein
  async function fuzzyCheck(field, normalizedValue) {
    if(!normalizedValue) return null;
    const prefix = normalizedValue.slice(0, 4); // first 4 chars
    if(prefix.length === 0) return null;
    const usersRef = collection(db, "users");
    // Firestore range query for prefix (field >= prefix and field <= prefix + '\uf8ff')
    // Note: ensure the field is stored normalized in Firestore (lowercase)
    const start = prefix;
    const end = prefix + '\uf8ff';
    const q = query(usersRef, where(field, ">=", start), where(field, "<=", end), limit(20));
    const snap = await getDocs(q);
    if(snap.empty) return null;
    let closest = null;
    snap.forEach(d => {
      const data = d.data();
      const val = (data[field] || "").toString().toLowerCase();
      const dist = levenshtein(val, normalizedValue);
      if(closest === null || dist < closest.dist) closest = { dist, val, id: d.id, data };
    });
    return closest; // object or null
  }


 document.getElementById("registerBtn").addEventListener("click", async () => {
  const btn = document.getElementById("registerBtn");

  // ‚úÖ INSTANT visual response
  btn.disabled = true;
  btn.textContent = "Processing...";

    let name = document.getElementById("name").value;
    let regEmail = document.getElementById("register-email").value;
    let username = document.getElementById("username").value;
    const mobile = document.getElementById("mobile").value.trim();
    const aadhaar = document.getElementById("aadhaar").value.trim();
    const cheque = document.getElementById("cheque").value.trim();
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirm-password").value;
    const referral = document.getElementById("referral").value.trim();

    try {
      // basic presence checks
      if(!name || !regEmail || !username || !mobile || !aadhaar || !password || !confirmPassword)
        throw new Error("Please complete all required fields");

      // normalize
      const normEmail = normalizeEmail(regEmail);
      const normUsername = normalizeText(username);
      const normName = normalizeText(name);

      // validations
      if(!validateEmailFormat(regEmail)) throw new Error("Invalid Email format");

    if (password !== confirmPassword) {showPopup("‚ùå Passwords do not match!", "error");throw new Error("stop-flow"); // stop further execution
     }

      if(password.length < 6) throw new Error("Password must be at least 6 chars");
      if(!/^\d{10}$/.test(mobile)) throw new Error("Mobile must be 10 digits");
      if(!/^\d{12}$/.test(aadhaar)) throw new Error("Aadhaar must be 12 digits");
      if(cheque !== "" && !/^\d{6,20}$/.test(cheque)) throw new Error("Cheque must be 6-20 digits");

      const usersRef = collection(db, "users");

      // 1) Exact duplicate checks (normalized)
      const exactChecks = [
        { field: "email", value: normEmail, msg: "Email already registered" },
        { field: "mobile", value: mobile, msg: "Mobile already registered" },
        { field: "username", value: normUsername, msg: "Username already taken" },
        { field: "aadhaar", value: aadhaar, msg: "Aadhaar already registered" }
      ];

      for(const c of exactChecks) {
        const q = query(usersRef, where(c.field, "==", c.value));
        const snap = await getDocs(q);
        if(!snap.empty) throw new Error(c.msg);
      }

      // 2) Fuzzy checks for name & username (catch typos like chaitanya/chaitnaya)
      // name fuzzy
      const nameCandidate = await fuzzyCheck("name", normName);
      if(nameCandidate && nameCandidate.dist <= 2) { // threshold: 2 edits
        throw new Error("Similar name already registered: " + nameCandidate.val);
      }
      // username fuzzy
      const usernameCandidate = await fuzzyCheck("username", normUsername);
      if(usernameCandidate && usernameCandidate.dist <= 1) { // stricter for username
        throw new Error("Similar username already exists: " + usernameCandidate.val);


      }
     
// ‚úÖ All validations passed ‚Äî now show processing overlay
document.getElementById("processingOverlay").style.display = "flex";

// üöÄ ADVANCED POLISH (OPTIONAL BUT PRO)
const loaderText = document.querySelector(".loader-text");

loaderText.textContent = "Checking your details...";

setTimeout(() => {
  loaderText.textContent = "Creating your account...";
}, 700);

setTimeout(() => {
  loaderText.textContent = "Finalizing setup...";
}, 1400);


// ‚úÖ Create user (Auth)
const userCredential = await createUserWithEmailAndPassword(auth, normEmail, password);
const user = userCredential.user;

// ‚úÖ Wait for token refresh before Firestore write (important!)
await user.getIdToken(true);

const finalReferral = "REF" + Math.floor(Math.random() * 900000 + 100000);

// ‚úÖ Pehle user ka IP le lo
const userIP = await getUserIP();

// ‚úÖ Pehle object banao
let userDocData = {
  name: normName,
  email: normEmail,
  username: normUsername,
  mobile,
  aadhaar,
  chequeNumber: cheque !== "" ? cheque : null,
  referralCode: finalReferral,
  referredBy: referral !== "" ? referral : null,
  walletBalance: 0,
  lifetimeReferralIncome: 0,
  totalInvested: 0,
  upline1: null,
  upline2: null,
  upline3: null,
  ipAddress: userIP,   // üëà added line
  createdAt: new Date().toISOString()
};

// ‚úÖ Agar referral diya gaya hai to uplines nikal lo
if(referral){
  const q = query(collection(db, "users"), where("referralCode", "==", referral));
  const snap = await getDocs(q);
  if(!snap.empty){
    const refUser = snap.docs[0].data();
    const refUserId = snap.docs[0].id;
    userDocData.upline1 = refUserId;

    if(refUser.referredBy){
      const q2 = query(collection(db, "users"), where("referralCode", "==", refUser.referredBy));
      const snap2 = await getDocs(q2);
      if(!snap2.empty){
        const refUser2 = snap2.docs[0].data();
        const refUser2Id = snap2.docs[0].id;
        userDocData.upline2 = refUser2Id;

        if(refUser2.referredBy){
          const q3 = query(collection(db, "users"), where("referralCode", "==", refUser2.referredBy));
          const snap3 = await getDocs(q3);
          if(!snap3.empty){
            const refUser3Id = snap3.docs[0].id;
            userDocData.upline3 = refUser3Id;
          }
        }
      }
    }
  }
}

// ‚úÖ Wait for Firebase Auth token to refresh before Firestore write
await user.getIdToken(true); // üî• important line (fixes permission timing issue)
await new Promise(res => setTimeout(res, 1000)); // üî• token sync delay fix

// ‚úÖ Bas ek hi baar Firestore me save karo
await setDoc(doc(db, "users", user.uid), userDocData);


// ‚úÖ 3-way login lookup entries banao (email / username / mobile)
try {
  await setDoc(doc(db, "logins", normEmail), { email: normEmail });
  await setDoc(doc(db, "logins", normUsername), { email: normEmail });
  await setDoc(doc(db, "logins", mobile), { email: normEmail });
  console.log(" Login lookup entries created for:", normEmail);
} catch (e) {
  console.error(" Failed to create login lookup:", e);
}

// üî• Loader band
document.getElementById("processingOverlay").style.display = "none";

// üéâ Show success overlay
const successOverlay = document.getElementById("successOverlay");
const video = document.getElementById("successVideo");

// üîÑ Restart video every time
video.currentTime = 0;
video.play();

successOverlay.style.display = "flex";

// ‚è≥ Video duration ke baad redirect
setTimeout(() => {
  window.location.href = "Dashboard.html";
}, 3000); // video length ke hisaab se adjust


} catch (err) {
  console.error("‚ùå Register error:", err.message);

  if (err.message === "stop-flow") return; // stop duplicate popup

  let errorMsg = err.message.trim();

  // ‚úÖ Custom meaningful validation messages
  if (errorMsg.includes("Please complete all required fields")) {
    errorMsg = " Please fill out all required fields before continuing.";
  } 
  else if (errorMsg.includes("Invalid Email format")) {
    errorMsg = " Please enter a valid email address (example@gmail.com).";
  } 
  else if (errorMsg.includes("Passwords do not match")) {
    errorMsg = " Password and Confirm Password must match exactly.";
  } 
  else if (errorMsg.includes("Password must be at least 6 chars")) {
    errorMsg = " Password should be at least 6 characters long.";
  } 
  else if (errorMsg.includes("Mobile must be 10 digits")) {
    errorMsg = " Mobile number must be exactly 10 digits.";
  } 
  else if (errorMsg.includes("Aadhaar must be 12 digits")) {
    errorMsg = " Aadhaar number must be exactly 12 digits.";
  } 
  else if (errorMsg.includes("Cheque must be 6-20 digits")) {
    errorMsg = " Cheque number must be between 6 and 20 digits.";
  } 
  else if (errorMsg.startsWith("Similar name already registered:")) {
    errorMsg = " This name is already similar to (" + errorMsg.split(":")[1].trim() + "). Please use your full legal name.";
  } 
  else if (errorMsg.startsWith("Similar username already exists:")) {
    errorMsg = " This username looks similar to (" + errorMsg.split(":")[1].trim() + "). Try a unique one.";
  } 
  else if (errorMsg.includes("Email already registered")) {
    errorMsg = " This email is already registered. Please log in instead.";
  } 
  else if (errorMsg.includes("Mobile already registered")) {
    errorMsg = " This mobile number is already registered.";
  } 
  else if (errorMsg.includes("Username already taken")) {
    errorMsg = " This username is already taken. Try another one.";
  } 
  else if (errorMsg.includes("Aadhaar already registered")) {
    errorMsg = " This Aadhaar number is already registered.";
  } 
  else if (errorMsg.includes("auth/email-already-in-use")) {
    errorMsg = " This email is already registered. Please log in instead.";
  } 
  else if (errorMsg.includes("auth/invalid-email")) {
    errorMsg = "Invalid email address. Please check and try again.";
  } 
  else if (errorMsg.includes("auth/weak-password")) {
    errorMsg = " Password must be at least 6 characters long.";
  } 
  else if (errorMsg.includes("auth/network-request-failed")) {
    errorMsg = " Network issue ‚Äî please check your internet connection.";
  } 
  else if (errorMsg.includes("auth/too-many-requests")) {
    errorMsg = " Too many attempts. Please wait a few minutes.";
  } 
  else if (errorMsg.includes("auth/operation-not-allowed")) {
    errorMsg = " Registration temporarily disabled. Try again later.";
  } 
  else {
    // üî• Default case ‚Äî fallback with actual Firebase message (no ‚Äúsomething went wrong‚Äù)
    errorMsg = "‚ö†Ô∏è " + errorMsg;
  }

  // ‚úÖ Final popup show
  showPopup(errorMsg, "error");
} 
finally {
  btn.disabled = false;
  btn.textContent = "Create Account";

  document.getElementById("processingOverlay").style.display = "none";

}


  // Auto set referral if present in URL
  const urlParams = new URLSearchParams(window.location.search);
  const refFromLink = urlParams.get("ref");
  if(refFromLink){
    const referralInput = document.getElementById("referral");
    referralInput.value = refFromLink;
    referralInput.readOnly = true;
  }

  });
</script>



<script>
// ‚úÖ Jab bhi input focus ho, usko visible karo
  const inputs = document.querySelectorAll("input");
  inputs.forEach(input => {
    input.addEventListener("focus", () => {

      setTimeout(() => {
        input.scrollIntoView({ behavior: "smooth", block: "center" });
      }, 300);
    });
  });
</script>
<!-- üëÅÔ∏è Eye icon toggle (show/hide password) -->
<script>
  const togglePassword = document.getElementById("toggle-password");
  const toggleConfirmPassword = document.getElementById("toggle-confirm-password");
  const passwordInput = document.getElementById("password");
  const confirmPasswordInput = document.getElementById("confirm-password");

  togglePassword.addEventListener("click", () => {
    const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
    passwordInput.setAttribute("type", type);
    togglePassword.textContent = type === "password" ? "üëÅÔ∏è" : "üôà";
  });

  toggleConfirmPassword.addEventListener("click", () => {
    const type = confirmPasswordInput.getAttribute("type") === "password" ? "text" : "password";
    confirmPasswordInput.setAttribute("type", type);
    toggleConfirmPassword.textContent = type === "password" ? "üëÅÔ∏è" : "üôà";
  });
</script>

<script>
  const inputOrder = [
    "name",
    "register-email",
    "username",
    "mobile",
    "aadhaar",
    "cheque",
    "password",
    "confirm-password",
    "referral"
  ];

  const maxLengths = {
    mobile: 10,
    aadhaar: 12,
    cheque: 6
  };

  // ‚úÖ Tick icon CSS
  const style = document.createElement("style");
  style.innerHTML = `
    .tick {
      position: absolute;
      right: 35px;
      top: 50%;
      transform: translateY(-50%) scale(0.8);
      font-size: 18px;
      color: #4CAF50;
      opacity: 0;
      transition: opacity 0.25s ease, transform 0.25s ease;
    }
    .tick.show {
      opacity: 1;
      transform: translateY(-50%) scale(1.2);
    }
    .validation-msg {
      font-size: 13px;
      margin-top: 4px;
      text-align: left;
      font-weight: 500;
      transition: all 0.3s ease;
      opacity: 0.9;
    }
  `;
  document.head.appendChild(style);

  // ‚úÖ Add tick icon for each input
  inputOrder.forEach(id => {
    const parent = document.getElementById(id)?.parentElement;
    if (parent && !parent.querySelector(".tick")) {
      const tick = document.createElement("span");
      tick.classList.add("tick");
      tick.textContent = "‚úÖ";
      parent.appendChild(tick);
    }
  });

  // ‚úÖ Input logic
  inputOrder.forEach((id, index) => {
    const current = document.getElementById(id);
    const next = document.getElementById(inputOrder[index + 1]);
    if (!current || !next) return;
    const tick = current.parentElement.querySelector(".tick");

    // üß© Add validation message (only for aadhaar & cheque)
    let msg;
    if (id === "aadhaar" || id === "cheque") {
      msg = document.createElement("div");
      msg.classList.add("validation-msg");
      current.parentElement.appendChild(msg);
    }

    // üö´ Only digits allowed for Aadhaar & Cheque
    if (id === "aadhaar" || id === "cheque" || id === "mobile") {
      current.addEventListener("input", () => {
        current.value = current.value.replace(/\D/g, ""); // remove non-digits
      });
    }

    current.addEventListener("input", () => {
      const val = current.value.trim().toLowerCase();

      // üü¢ NAME field ‚Äî koi bhi naam likhe aur space lagaye to tick
      if (id === "name" && val.length >= 3 && current.value.endsWith(" ")) {
        tick.classList.add("show");
        setTimeout(() => {
          tick.classList.remove("show");
          next.focus();
        }, 300);
        return;
      }

      // üü¢ EMAIL field ‚Äî jaise hi gmail.com likhe to tick
      if (id === "register-email" && val.includes("@gmail.com")) {
        tick.classList.add("show");
        setTimeout(() => {
          tick.classList.remove("show");
          next.focus();
        }, 300);
        return;
      }

      // üü¢ USERNAME field ‚Äî jab 4+ characters likhe aur space dabaye to tick
      if (id === "username" && current.value.length >= 4 && current.value.endsWith(" ")) {
        tick.classList.add("show");
        setTimeout(() => {
          tick.classList.remove("show");
          next.focus();
        }, 300);
        return;
      }

      // üü¢ MOBILE / AADHAAR / CHEQUE ‚Äî fixed length hone par hi tick
      if (maxLengths[id] && current.value.length === maxLengths[id]) {
        tick.classList.add("show");
        setTimeout(() => {
          tick.classList.remove("show");
          next.focus();
        }, 300);
      } else if (current.value.length < (maxLengths[id] || 3)) {
        tick.classList.remove("show");
      }

      // üß© Live Validation for Aadhaar
      if (id === "aadhaar") {
        if (current.value.length === 12) {
          msg.textContent = "‚úÖ Valid Aadhaar number";
          msg.style.color = "#2e7d32";
        } else if (current.value.length > 0) {
          msg.textContent = "‚ùå Aadhaar must be 12 digits";
          msg.style.color = "#d32f2f";
        } else {
          msg.textContent = "";
        }
      }

      // üß© Live Validation for Cheque
      if (id === "cheque") {
        if (current.value.length === 6) {
          msg.textContent = "‚úÖ Valid Cheque number";
          msg.style.color = "#2e7d32";
        } else if (current.value.length > 0) {
          msg.textContent = "‚ùå Cheque number must be 6 digits";
          msg.style.color = "#d32f2f";
        } else {
          msg.textContent = "";
        }
      }
    });

    // üîÑ ENTER key se bhi move next
    current.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        tick.classList.add("show");
        setTimeout(() => {
          tick.classList.remove("show");
          next.focus();
        }, 200);
      }
    });
  });

  // üí´ Focus styling
  inputOrder.forEach(id => {
    const input = document.getElementById(id);
    input.addEventListener("focus", () => {
      input.style.borderColor = "#4CAF50";
      input.style.boxShadow = "0 0 5px rgba(76,175,80,0.3)";
    });
    input.addEventListener("blur", () => {
      input.style.borderColor = "#ccc";
      input.style.boxShadow = "none";
    });
  });
</script>
<script>
// ‚úÖ Auto-fill referral code only after DOM + Firebase loaded properly
window.addEventListener("load", () => {
  try {
    const urlParams = new URLSearchParams(window.location.search);
    const refFromLink = urlParams.get("ref");

    if (refFromLink && refFromLink.trim() !== "") {
      const referralInput = document.getElementById("referral");
      if (referralInput) {
        referralInput.value = refFromLink.trim();
        referralInput.readOnly = true;

        console.log("‚úÖ Referral detected from link:", refFromLink);
      } else {
        console.warn("‚ö†Ô∏è Referral input not found in DOM.");
      }
    } else {
      console.log("‚ÑπÔ∏è No referral found in URL");
    }
  } catch (err) {
    console.error("‚ùå Referral auto-fill error:", err.message);
  }
});

</script>
<script>
const emailInput = document.getElementById("register-email");

emailInput.addEventListener("blur", () => {
  if (emailInput.value.endsWith("@")) {
    emailInput.value += "gmail.com";
  }
});

</script>



<script>
document
  .getElementById("registerForm")
  .addEventListener("submit", e => e.preventDefault());

</script>
<script>
  // üîí Mobile & Aadhaar digit lock
function enforceDigitLimit(id, maxLength) {
  const input = document.getElementById(id);

  input.addEventListener("input", () => {
    // sirf digits allow
    input.value = input.value.replace(/\D/g, "");

    // max length lock
    if (input.value.length > maxLength) {
      input.value = input.value.slice(0, maxLength);
    }
  });

  // ‚ùå paste se bhi limit na toote
  input.addEventListener("paste", (e) => {
    e.preventDefault();
    const paste = (e.clipboardData || window.clipboardData)
      .getData("text")
      .replace(/\D/g, "")
      .slice(0, maxLength);

    input.value = paste;
  });
}

// üîê Apply locks
enforceDigitLimit("mobile", 10);
enforceDigitLimit("aadhaar", 12);

</script>
<script>
const texts = [
  "Secure account registration is active",
  "Real-time identity verification in progress",
  "Aadhaar and mobile validation enabled",
  "Encrypted data protection protocols applied",
  "Platform activity monitored continuously"
];

let index = 0;
let charIndex = 0;

// üåø Smooth & calm timings
const typingSpeed = 65;      // slow typing
const erasingSpeed = 35;    // soft erase
const holdAfterType = 1800; // text rukne ka time
const holdAfterErase = 400;

const typingEl = document.getElementById("typingText");

function typeText() {
  if (charIndex < texts[index].length) {
    typingEl.textContent += texts[index].charAt(charIndex);
    charIndex++;
    setTimeout(typeText, typingSpeed);
  } else {
    setTimeout(eraseText, holdAfterType);
  }
}

function eraseText() {
  if (charIndex > 0) {
    typingEl.textContent = texts[index].substring(0, charIndex - 1);
    charIndex--;
    setTimeout(eraseText, erasingSpeed);
  } else {
    index = (index + 1) % texts.length;
    setTimeout(typeText, holdAfterErase);
  }
}

// üöÄ Start
typeText();
</script>
<script>
const trustColors = [
  "#16a34a", // green (trust)
  "#2563eb", // blue (finance)
  "#9333ea", // purple (premium)
  "#f59e0b", // gold
  "#dc2626", // red
  "#0ea5e9", // sky blue
  "#22c55e"  // fresh green
];

let colorIndex = 0;
const trustEl = document.getElementById("trustColor");

setInterval(() => {
  trustEl.style.color = trustColors[colorIndex];
  
  colorIndex = (colorIndex + 1) % trustColors.length;
}, 1200); // smooth change
</script>
<script>
document.addEventListener("contextmenu", e => e.preventDefault());
document.addEventListener("selectstart", e => e.preventDefault());
document.addEventListener("dragstart", e => e.preventDefault());
["copy","paste","cut"].forEach(evt =>
  document.addEventListener(evt, e => e.preventDefault())
);

setInterval(() => console.clear(), 500);
</script>

</body>
</html>
